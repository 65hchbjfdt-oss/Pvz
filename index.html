<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ü–í–ó Pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

:root {
‚Äìbg: #06060f;
‚Äìaccent: #007AFF;
‚Äìpurple: #5E5CE6;
‚Äìgreen: #30D158;
‚Äìorange: #FF9F0A;
‚Äìred: #FF453A;
‚Äìtext: rgba(255,255,255,0.93);
‚Äìtext2: rgba(255,255,255,0.5);
‚Äìtext3: rgba(255,255,255,0.28);
‚Äìg1: rgba(255,255,255,0.11);
‚Äìg2: rgba(255,255,255,0.06);
‚Äìgb: rgba(255,255,255,0.18);
‚Äìblur: blur(28px) saturate(200%) brightness(1.1);
‚Äìblur2: blur(16px) saturate(160%);
‚Äìr: 20px;
‚Äìr2: 28px;
‚Äìsh: 0 8px 40px rgba(0,0,0,0.45), inset 0 1px 0 rgba(255,255,255,0.12);
‚Äìsh2: 0 20px 70px rgba(0,0,0,0.6);
}

html { height: 100%; }
body {
font-family: ‚ÄòNunito‚Äô, -apple-system, sans-serif;
background: var(‚Äìbg);
color: var(‚Äìtext);
min-height: 100dvh;
overflow-x: hidden;
position: relative;
}

/* ‚îÄ‚îÄ BACKGROUND ‚îÄ‚îÄ */
#bg {
position: fixed; inset: 0; z-index: 0; pointer-events: none; overflow: hidden;
}
.orb {
position: absolute; border-radius: 50%; filter: blur(80px); opacity: 0.55;
animation: drift linear infinite;
}
.o1 { width:500px; height:500px; top:-150px; left:-150px; background:radial-gradient(circle,#5E5CE6,transparent 70%); animation-duration:18s; }
.o2 { width:400px; height:400px; top:20%; right:-120px; background:radial-gradient(circle,#007AFF,transparent 70%); animation-duration:14s; animation-direction:reverse; }
.o3 { width:350px; height:350px; bottom:-100px; left:30%; background:radial-gradient(circle,#30D158,transparent 70%); animation-duration:20s; opacity:0.3; }
.o4 { width:280px; height:280px; top:50%; left:-80px; background:radial-gradient(circle,#FF9F0A,transparent 70%); animation-duration:16s; opacity:0.25; }

@keyframes drift {
0%   { transform: translate(0,0) scale(1); }
25%  { transform: translate(30px,-40px) scale(1.05); }
50%  { transform: translate(-20px,30px) scale(0.95); }
75%  { transform: translate(40px,10px) scale(1.03); }
100% { transform: translate(0,0) scale(1); }
}

/* ‚îÄ‚îÄ GLASS ‚îÄ‚îÄ */
.glass {
background: var(‚Äìg1);
backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìgb);
box-shadow: var(‚Äìsh);
}
.glass-sm {
background: var(‚Äìg2);
backdrop-filter: var(‚Äìblur2);
-webkit-backdrop-filter: var(‚Äìblur2);
border: 1px solid rgba(255,255,255,0.1);
}

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
#roleScreen, #app {
position: relative; z-index: 1;
}
#app { display: none; min-height: 100dvh; flex-direction: column; }
#app.on { display: flex; }

/* ‚îÄ‚îÄ ROLE SCREEN ‚îÄ‚îÄ */
#roleScreen {
display: flex; flex-direction: column; align-items: center;
justify-content: center; min-height: 100dvh; padding: 32px 20px; gap: 0;
}
.logo-wrap { margin-bottom: 20px; animation: popIn 0.6s cubic-bezier(.34,1.56,.64,1); }
.logo-icon {
width: 96px; height: 96px; border-radius: 28px; font-size: 52px;
display: flex; align-items: center; justify-content: center;
background: linear-gradient(135deg, rgba(94,92,230,0.7), rgba(0,122,255,0.6));
backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid rgba(255,255,255,0.25);
box-shadow: 0 0 60px rgba(94,92,230,0.4), var(‚Äìsh);
animation: glowPulse 3s ease-in-out infinite;
}
@keyframes glowPulse {
0%,100% { box-shadow: 0 0 40px rgba(94,92,230,0.35), var(‚Äìsh); }
50%      { box-shadow: 0 0 80px rgba(0,122,255,0.5), var(‚Äìsh); }
}
@keyframes popIn {
from { opacity:0; transform: scale(0.6) translateY(20px); }
to   { opacity:1; transform: scale(1) translateY(0); }
}
.role-title {
font-size: 38px; font-weight: 900; letter-spacing: -1.5px; text-align: center;
background: linear-gradient(135deg, #fff 20%, rgba(255,255,255,0.65));
-webkit-background-clip: text; -webkit-text-fill-color: transparent;
background-clip: text; margin-bottom: 8px;
animation: popIn 0.6s .1s cubic-bezier(.34,1.56,.64,1) both;
}
.role-sub {
color: var(‚Äìtext2); font-size: 15px; text-align: center; line-height: 1.5;
margin-bottom: 36px;
animation: popIn 0.6s .2s cubic-bezier(.34,1.56,.64,1) both;
}

/* Profile preview card */
.profile-preview {
width: 100%; max-width: 360px; margin-bottom: 24px;
animation: popIn 0.6s .25s cubic-bezier(.34,1.56,.64,1) both;
}
.profile-tabs {
display: flex; background: rgba(255,255,255,0.06); border-radius: 14px;
border: 1px solid var(‚Äìgb); padding: 3px; margin-bottom: 12px;
}
.ptab {
flex: 1; padding: 9px; border-radius: 11px; font-size: 13px; font-weight: 800;
color: var(‚Äìtext2); cursor: pointer; text-align: center; transition: all 0.25s;
}
.ptab.on {
background: rgba(0,122,255,0.4); color: #fff;
box-shadow: 0 2px 12px rgba(0,122,255,0.3);
}
.pcard {
border-radius: var(‚Äìr2); padding: 18px 20px;
display: flex; align-items: center; gap: 14px;
}
.pavatar {
width: 54px; height: 54px; border-radius: 50%; font-size: 28px;
display: flex; align-items: center; justify-content: center; flex-shrink: 0;
border: 2px solid rgba(255,255,255,0.2);
}
.pavatar.buyer { background: linear-gradient(135deg,rgba(0,122,255,.5),rgba(94,92,230,.5)); }
.pavatar.emp   { background: linear-gradient(135deg,rgba(48,209,88,.45),rgba(0,199,190,.4)); }
.pname { font-size: 17px; font-weight: 800; margin-bottom: 2px; }
.pdetail { font-size: 12px; color: var(‚Äìtext2); }
.pbadge {
margin-left: auto; padding: 5px 13px; border-radius: 20px;
font-size: 11px; font-weight: 800; flex-shrink: 0;
}
.pbadge.buyer { background: rgba(0,122,255,0.25); border:1px solid rgba(0,122,255,0.4); color:#007AFF; }
.pbadge.emp   { background: rgba(48,209,88,0.2);  border:1px solid rgba(48,209,88,0.35); color:#30D158; }

/* Role buttons */
.role-btns { display: flex; flex-direction: column; gap: 14px; width:100%; max-width:360px;
animation: popIn 0.6s .35s cubic-bezier(.34,1.56,.64,1) both; }
.rbtn {
width: 100%; padding: 22px 22px; border-radius: var(‚Äìr2); border: none;
cursor: pointer; display: flex; align-items: center; gap: 18px; text-align: left;
transition: transform 0.25s cubic-bezier(.34,1.56,.64,1), box-shadow 0.25s;
position: relative; overflow: hidden;
}
.rbtn::after {
content:‚Äô‚Äô; position:absolute; inset:0; opacity:0; transition:opacity 0.2s;
background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.15), transparent 70%);
}
.rbtn:hover::after { opacity:1; }
.rbtn:active { transform: scale(0.95) !important; }
.rbtn.buyer {
background: linear-gradient(135deg, rgba(0,122,255,.28), rgba(94,92,230,.22));
backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid rgba(0,122,255,.38);
box-shadow: 0 8px 32px rgba(0,122,255,.18), var(‚Äìsh);
}
.rbtn.emp {
background: linear-gradient(135deg, rgba(48,209,88,.22), rgba(0,199,190,.18));
backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid rgba(48,209,88,.3);
box-shadow: 0 8px 32px rgba(48,209,88,.12), var(‚Äìsh);
}
.rbtn-icon { font-size: 42px; }
.rbtn-title { font-size: 18px; font-weight: 800; color: var(‚Äìtext); margin-bottom: 3px; }
.rbtn-sub   { font-size: 12px; color: var(‚Äìtext2); }

/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */
.hdr {
position: sticky; top: 0; z-index: 100; padding: 14px 18px;
display: flex; align-items: center; justify-content: space-between;
background: rgba(6,6,15,0.55);
backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border-bottom: 1px solid rgba(255,255,255,0.1);
}
.hdr-l { display: flex; align-items: center; gap: 11px; }
.hdr-logo { font-size: 28px; }
.hdr-title { font-size: 20px; font-weight: 900; letter-spacing: -0.5px; }
.hdr-badge {
padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 800; letter-spacing: 0.3px;
}
.hdr-badge.buyer { background: rgba(0,122,255,.2); border:1px solid rgba(0,122,255,.35); color:#007AFF; }
.hdr-badge.emp   { background: rgba(48,209,88,.18); border:1px solid rgba(48,209,88,.3); color:#30D158; }
.exit-btn {
background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,.15);
color: var(‚Äìtext2); padding: 7px 14px; border-radius: 12px;
font-size: 12px; font-weight: 700; cursor: pointer; font-family: inherit;
transition: all 0.2s;
}
.exit-btn:active { transform: scale(0.93); }

/* ‚îÄ‚îÄ TABS ‚îÄ‚îÄ */
.tabs {
display: flex; overflow-x: auto; padding: 0 14px;
background: rgba(6,6,15,0.4);
backdrop-filter: var(‚Äìblur2); -webkit-backdrop-filter: var(‚Äìblur2);
border-bottom: 1px solid rgba(255,255,255,0.08);
gap: 2px;
}
.tabs::-webkit-scrollbar { display: none; }
.tab {
flex: 1; min-width: 72px; padding: 10px 6px 13px;
text-align: center; font-size: 10px; font-weight: 800; letter-spacing: 0.4px;
color: var(‚Äìtext3); cursor: pointer; white-space: nowrap; text-transform: uppercase;
position: relative; transition: color 0.2s;
user-select: none;
}
.tab .ti { font-size: 21px; display: block; margin-bottom: 3px; }
.tab::after {
content:‚Äô‚Äô; position:absolute; bottom:0; left:15%; right:15%; height:2.5px;
border-radius: 2px 2px 0 0; background: transparent; transition: background 0.25s;
}
.tab.on { color: var(‚Äìtext); }
.tab.on::after { background: var(‚Äìaccent); }
.bdg {
display: inline-flex; align-items: center; justify-content: center;
background: var(‚Äìred); color:#fff; font-size:9px; font-weight:900;
min-width:15px; height:15px; border-radius:8px; padding:0 3px;
margin-left:3px; vertical-align: middle;
}

/* ‚îÄ‚îÄ CONTENT ‚îÄ‚îÄ */
.content { flex:1; overflow-y:auto; padding: 18px 16px 110px; }
.page { display: none; }
.page.on { display: block; animation: pgIn 0.22s ease; }
@keyframes pgIn { from { opacity:0; transform:translateY(6px); } to { opacity:1; transform:translateY(0); } }

.sec { font-size: 11px; font-weight: 900; color: var(‚Äìtext3); letter-spacing: 0.9px;
text-transform: uppercase; margin-bottom: 12px; padding-left: 2px; }

/* ‚îÄ‚îÄ PRODUCT GRID ‚îÄ‚îÄ */
.pgrid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
@media(min-width:560px) { .pgrid { grid-template-columns: repeat(3,1fr); } }
@media(min-width:800px) { .pgrid { grid-template-columns: repeat(4,1fr); } }

.pcard {
border-radius: var(‚Äìr2); overflow: hidden; display: flex; flex-direction: column;
transition: transform 0.25s, box-shadow 0.25s;
}
.pcard:hover { transform: translateY(-3px); box-shadow: var(‚Äìsh2); }
.pcard-img {
background: rgba(255,255,255,0.05); height: 88px;
display: flex; align-items: center; justify-content: center; font-size: 46px;
border-bottom: 1px solid rgba(255,255,255,0.07);
}
.pcard-body { padding: 11px 12px; flex:1; display:flex; flex-direction:column; gap:3px; }
.pcard-name  { font-size: 13px; font-weight: 800; line-height: 1.3; }
.pcard-desc  { font-size: 11px; color: var(‚Äìtext2); line-height: 1.4; flex:1; }
.pcard-price { font-size: 15px; font-weight: 900; color: var(‚Äìorange); margin-top: 5px; }
.pcard-acts  { display:flex; gap:6px; padding:8px 10px; border-top:1px solid rgba(255,255,255,0.07); }

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn {
padding: 8px 10px; border-radius: 11px; font-size: 12px; font-weight: 800;
border: none; cursor: pointer; transition: transform 0.15s, opacity 0.15s; font-family: inherit;
}
.btn:active { transform: scale(0.91); }
.btn.p  { background: var(‚Äìaccent); color: #fff; box-shadow: 0 4px 14px rgba(0,122,255,.35); }
.btn.s  { background: rgba(255,255,255,.1); color: var(‚Äìtext); border:1px solid rgba(255,255,255,.15); }
.btn.d  { background: var(‚Äìred); color: #fff; box-shadow: 0 4px 14px rgba(255,69,58,.3); }
.btn.g  { background: var(‚Äìgreen); color: #fff; box-shadow: 0 4px 14px rgba(48,209,88,.3); }
.btn.grow { flex:1; }

.fullbtn {
width: 100%; padding: 16px; border-radius: var(‚Äìr); font-size: 15px; font-weight: 800;
border: none; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s; font-family: inherit;
margin-top: 10px;
}
.fullbtn:active { transform: scale(0.97); }
.fullbtn.p { background: linear-gradient(135deg,#007AFF,#5E5CE6); color:#fff; box-shadow:0 8px 24px rgba(0,122,255,.35); }
.fullbtn.s { background: rgba(255,255,255,.08); color:var(‚Äìtext2); border:1px solid rgba(255,255,255,.13); }
.fullbtn.d { background: linear-gradient(135deg,#FF453A,#FF6B6B); color:#fff; }
.fullbtn.g { background: linear-gradient(135deg,#30D158,#00C897); color:#fff; box-shadow:0 8px 24px rgba(48,209,88,.3); }

/* FAB */
.fab {
position: fixed; bottom: calc(84px + env(safe-area-inset-bottom,0px)); right: 20px;
width: 60px; height: 60px; border-radius: 50%; border: none; cursor: pointer;
background: linear-gradient(135deg,#007AFF,#5E5CE6);
color: #fff; font-size: 30px; display: flex; align-items: center; justify-content: center;
box-shadow: 0 8px 28px rgba(0,122,255,.5); z-index: 200;
transition: transform 0.3s cubic-bezier(.34,1.56,.64,1);
}
.fab:active { transform: scale(0.86); }

/* ‚îÄ‚îÄ CART ‚îÄ‚îÄ */
.cart-item {
border-radius: var(‚Äìr2); padding: 14px 16px;
display: flex; align-items: center; gap: 14px; margin-bottom: 10px;
}
.ci-emoji { font-size: 36px; }
.ci-info { flex:1; }
.ci-name  { font-size: 14px; font-weight: 800; }
.ci-price { font-size: 12px; color: var(‚Äìtext2); margin-top: 2px; }
.qty-row  { display:flex; align-items:center; gap:10px; margin-top:8px; }
.qbtn {
width:30px; height:30px; border-radius:50%; background:rgba(255,255,255,.1);
border:1px solid rgba(255,255,255,.15); color:var(‚Äìtext); font-size:19px;
cursor:pointer; display:flex; align-items:center; justify-content:center;
transition: all 0.15s; font-family: inherit;
}
.qbtn:active { background:rgba(0,122,255,.35); transform:scale(0.86); }
.qnum { font-size: 16px; font-weight: 900; min-width: 26px; text-align:center; }
.ci-total { font-size: 15px; font-weight: 900; color: var(‚Äìorange); }

.cart-sum {
border-radius: var(‚Äìr2); padding: 20px; margin-top: 16px;
}
.csr { display:flex; justify-content:space-between; align-items:center; padding:6px 0; font-size:14px; }
.csr .lbl { color:var(‚Äìtext2); }
.big-total { font-size: 24px; font-weight: 900; color: var(‚Äìorange); }
.pay-opts  { display:flex; gap:10px; margin-top:16px; }
.pay-opt {
flex:1; padding:14px 10px; border-radius:16px; border:2px solid rgba(255,255,255,.12);
background: rgba(255,255,255,.04); text-align:center; font-size:12px; font-weight:800;
cursor:pointer; transition:all 0.22s; color:var(‚Äìtext2);
}
.pay-opt.on { border-color:var(‚Äìaccent); background:rgba(0,122,255,.18); color:var(‚Äìtext); }
.pay-opt .pi { font-size:26px; display:block; margin-bottom:6px; }

/* ‚îÄ‚îÄ ORDERS ‚îÄ‚îÄ */
.order-card { border-radius:var(‚Äìr2); padding:18px; margin-bottom:12px; }
.oh { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:10px; }
.onum { font-size:16px; font-weight:900; }
.ostatus { font-size:11px; padding:4px 11px; border-radius:20px; font-weight:800; }
.st-wait { background:rgba(255,159,10,.2); color:var(‚Äìorange); border:1px solid rgba(255,159,10,.3); }
.st-done { background:rgba(48,209,88,.2);  color:var(‚Äìgreen);  border:1px solid rgba(48,209,88,.3); }
.ometa { display:flex; flex-wrap:wrap; gap:7px; margin-bottom:12px; }
.ombadge { font-size:12px; color:var(‚Äìtext2); background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.1); border-radius:8px; padding:4px 10px; }
.oprice { font-size:22px; font-weight:900; color:var(‚Äìorange); margin-bottom:14px; }

/* ‚îÄ‚îÄ QR MODAL ‚îÄ‚îÄ */
.qr-wrap {
display:flex; flex-direction:column; align-items:center; text-align:center; padding:8px 0;
}
#qrBox {
padding: 18px; background: #fff; border-radius: 18px; display:inline-block;
margin: 18px auto; box-shadow: 0 8px 40px rgba(0,0,0,.5);
}
#qrBox img, #qrBox canvas { display:block; border-radius: 4px; }
.qr-hint { color:var(‚Äìtext2); font-size:13px; margin-bottom:18px; line-height:1.5; }

/* ‚îÄ‚îÄ SCANNER ‚îÄ‚îÄ */
.scan-card { border-radius:var(‚Äìr2); padding:28px; text-align:center; margin-bottom:16px; }
.scan-big-icon { font-size:70px; margin-bottom:16px; }
.scan-title { font-size:22px; font-weight:900; margin-bottom:8px; }
.scan-sub { font-size:14px; color:var(‚Äìtext2); margin-bottom:26px; line-height:1.5; }

/* Scanner modal internals */
.vid-wrap { position:relative; border-radius:var(‚Äìr2); overflow:hidden; background:#000; border:1px solid rgba(255,255,255,.12); }
#scanVid { width:100%; display:block; max-height:58dvh; object-fit:cover; }
.vid-overlay { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; }
.scan-frame {
width: 190px; height: 190px; position: relative;
}
/* Corner brackets */
.scan-frame::before, .scan-frame::after,
.sf-inner::before, .sf-inner::after {
content:‚Äô‚Äô; position:absolute; width:28px; height:28px;
border-color: #007AFF; border-style: solid; border-radius: 4px;
}
.scan-frame::before { top:0; left:0; border-width:3px 0 0 3px; border-radius:7px 0 0 0; }
.scan-frame::after  { top:0; right:0; border-width:3px 3px 0 0; border-radius:0 7px 0 0; }
.sf-inner::before   { bottom:0; left:0; border-width:0 0 3px 3px; border-radius:0 0 0 7px; }
.sf-inner::after    { bottom:0; right:0; border-width:0 3px 3px 0; border-radius:0 0 7px 0; }
.scan-beam {
position:absolute; left:4px; right:4px; height:2px;
background: linear-gradient(90deg,transparent,#007AFF 40%,#5E5CE6 60%,transparent);
box-shadow: 0 0 10px #007AFF; border-radius:1px;
animation: beam 2s ease-in-out infinite;
}
@keyframes beam { 0%,100%{top:6px;} 50%{top:calc(100% - 6px);} }
.scan-dim {
position:absolute; inset:0;
background: rgba(0,0,0,0.55);
/* punch a hole in the middle */
-webkit-mask: radial-gradient(ellipse 200px 200px at 50% 50%, transparent 95px, black 96px);
mask: radial-gradient(ellipse 200px 200px at 50% 50%, transparent 95px, black 96px);
}
.scan-hint-txt { text-align:center; color:var(‚Äìtext2); font-size:13px; font-weight:600; margin-top:14px; }

/* ‚îÄ‚îÄ EMP ORDER ‚îÄ‚îÄ */
.emp-card { border-radius:var(‚Äìr2); padding:18px; margin-bottom:14px; }
.emp-hdr { display:flex; justify-content:space-between; align-items:center; margin-bottom:12px; }
.emp-title { font-size:18px; font-weight:900; }
.info-row  { display:flex; flex-wrap:wrap; gap:8px; margin-bottom:14px; }
.infobdg {
background:rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.12);
border-radius:8px; padding:5px 12px; font-size:12px; font-weight:700;
}
.items-list { display:flex; flex-direction:column; gap:8px; margin-top:10px; }
.item-row {
display:flex; align-items:center; gap:12px;
background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.09);
border-radius:14px; padding:12px; transition:all 0.3s;
}
.item-row.scanned  { opacity:.45; background:rgba(48,209,88,.08);  border-color:rgba(48,209,88,.2); }
.item-row.returned { opacity:.45; background:rgba(255,69,58,.08);   border-color:rgba(255,69,58,.2); }
.item-emoji { font-size:26px; }
.item-info  { flex:1; }
.item-name  { font-size:13px; font-weight:800; }
.item-price { font-size:11px; color:var(‚Äìtext2); margin-top:2px; }
.item-mark  { font-size:22px; }

/* progress */
.prog-wrap { background:rgba(255,255,255,.1); border-radius:10px; height:5px; overflow:hidden; margin-top:10px; }
.prog-bar  { height:100%; border-radius:10px; background:linear-gradient(90deg,#007AFF,#5E5CE6); transition:width .5s ease; }

/* ‚îÄ‚îÄ PROFILE PAGE ‚îÄ‚îÄ */
.prof-hero {
border-radius:var(‚Äìr2); padding:28px; text-align:center; margin-bottom:14px;
}
.prof-av {
width:88px; height:88px; border-radius:50%; font-size:46px;
display:flex; align-items:center; justify-content:center; margin:0 auto 14px;
border:2.5px solid rgba(255,255,255,.25);
}
.prof-av.buyer { background:linear-gradient(135deg,rgba(0,122,255,.5),rgba(94,92,230,.5)); box-shadow:0 8px 32px rgba(0,122,255,.3); }
.prof-av.emp   { background:linear-gradient(135deg,rgba(48,209,88,.4),rgba(0,199,190,.4)); box-shadow:0 8px 32px rgba(48,209,88,.25); }
.prof-name { font-size:26px; font-weight:900; margin-bottom:4px; }
.prof-role { font-size:13px; color:var(‚Äìtext2); }
.stats-grid { display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px; margin:20px 0; }
.stat-box { background:rgba(255,255,255,.07); border:1px solid rgba(255,255,255,.1); border-radius:16px; padding:14px 10px; text-align:center; }
.stat-n { font-size:24px; font-weight:900; color:var(‚Äìorange); }
.stat-l { font-size:10px; color:var(‚Äìtext2); margin-top:3px; text-transform:uppercase; font-weight:800; letter-spacing:0.3px; }
.info-card { border-radius:var(‚Äìr2); padding:20px; margin-bottom:14px; }
.info-row-item { display:flex; justify-content:space-between; align-items:center; font-size:14px; padding:10px 0; border-bottom:1px solid rgba(255,255,255,.07); }
.info-row-item:last-child { border-bottom:none; }
.info-row-item .lbl { color:var(‚Äìtext2); }
.info-row-item .val { font-weight:800; }

/* ‚îÄ‚îÄ RETURN ‚îÄ‚îÄ */
.ret-item {
display:flex; align-items:center; gap:12px; padding:13px;
background:rgba(255,255,255,.06); border:2px solid transparent;
border-radius:14px; margin-bottom:8px; cursor:pointer; transition:all 0.2s;
}
.ret-item.on { border-color:var(‚Äìred); background:rgba(255,69,58,.1); }
.ret-cb {
width:24px; height:24px; border-radius:7px; border:2px solid rgba(255,255,255,.2);
background:rgba(255,255,255,.07); display:flex; align-items:center; justify-content:center;
font-size:14px; font-weight:900; transition:all 0.2s; flex-shrink:0;
}
.ret-item.on .ret-cb { background:var(‚Äìred); border-color:var(‚Äìred); color:#fff; }

/* ‚îÄ‚îÄ OVERLAY / MODAL ‚îÄ‚îÄ */
.overlay {
display:none; position:fixed; inset:0; z-index:400;
background:rgba(0,0,0,0.7); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);
align-items:flex-end; justify-content:center;
}
.overlay.on { display:flex; animation: ovIn 0.22s ease; }
@keyframes ovIn { from{opacity:0;} to{opacity:1;} }
.modal {
background: rgba(14,14,28,0.88);
backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border:1px solid rgba(255,255,255,.15); border-bottom:none;
border-radius:30px 30px 0 0; width:100%; max-width:520px;
padding:6px 22px 36px; max-height:94dvh; overflow-y:auto;
box-shadow:0 -20px 70px rgba(0,0,0,.6);
animation: modalUp 0.35s cubic-bezier(.34,1.15,.64,1);
}
@keyframes modalUp { from{transform:translateY(100%);} to{transform:translateY(0);} }
.mhandle {
width:42px; height:4px; border-radius:2px; background:rgba(255,255,255,.18);
margin:14px auto 22px;
}
.mtitle { font-size:21px; font-weight:900; margin-bottom:20px; }

/* FORM */
.fg { margin-bottom:16px; }
.fg label { font-size:11px; font-weight:900; color:var(‚Äìtext3); text-transform:uppercase; letter-spacing:.6px; display:block; margin-bottom:8px; }
.fg input, .fg textarea {
width:100%; background:rgba(255,255,255,.09); border:1px solid rgba(255,255,255,.15);
border-radius:14px; color:var(‚Äìtext); padding:13px 16px; font-size:15px;
font-family:inherit; outline:none; resize:vertical; transition:all 0.2s;
}
.fg input:focus, .fg textarea:focus { border-color:rgba(0,122,255,.6); background:rgba(0,122,255,.1); }
.fg textarea { min-height:80px; }
input::placeholder, textarea::placeholder { color:var(‚Äìtext3); }

/* emoji grid */
.egrid { display:grid; grid-template-columns:repeat(7,1fr); gap:6px; margin-bottom:12px; }
.eo {
font-size:27px; text-align:center; padding:6px; border-radius:10px;
cursor:pointer; border:2.5px solid transparent; transition:all 0.15s;
}
.eo.on { border-color:var(‚Äìaccent); background:rgba(0,122,255,.2); }

/* ‚îÄ‚îÄ EMPTY ‚îÄ‚îÄ */
.empty { text-align:center; padding:70px 20px; color:var(‚Äìtext2); }
.empty .ei { font-size:62px; margin-bottom:16px; opacity:.55; }
.empty p { font-size:15px; line-height:1.6; }

/* ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ */
#toast {
position:fixed; top:80px; left:50%; transform:translateX(-50%) translateY(-12px);
background:rgba(14,14,28,0.92); backdrop-filter:var(‚Äìblur); -webkit-backdrop-filter:var(‚Äìblur);
border:1px solid rgba(255,255,255,.15); border-radius:14px;
padding:12px 22px; font-size:14px; font-weight:800; z-index:999;
opacity:0; transition:all 0.3s cubic-bezier(.34,1.15,.64,1);
pointer-events:none; white-space:nowrap;
box-shadow:0 8px 36px rgba(0,0,0,.5);
}
#toast.on { opacity:1; transform:translateX(-50%) translateY(0); }

/* ‚îÄ‚îÄ SCAN HISTORY ‚îÄ‚îÄ */
.scan-hist-item {
display:flex; align-items:center; gap:12px;
background:rgba(255,255,255,.06); border:1px solid rgba(255,255,255,.09);
border-radius:16px; padding:14px; margin-bottom:10px;
}
</style>

</head>
<body>

<div id="bg">
  <div class="orb o1"></div>
  <div class="orb o2"></div>
  <div class="orb o3"></div>
  <div class="orb o4"></div>
</div>

<!-- ‚ïê‚ïê ROLE SCREEN ‚ïê‚ïê -->

<div id="roleScreen">
  <div class="logo-wrap">
    <div class="logo-icon">üì¶</div>
  </div>
  <div class="role-title">–ü–í–ó Pro</div>
  <div class="role-sub">–°–∏–º—É–ª—è—Ç–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–æ–≤<br>–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ø—Ä–æ—Ñ–∏–ª—å</div>

  <div class="profile-preview">
    <div class="profile-tabs">
      <div class="ptab on" onclick="switchPrev('buyer')">üõçÔ∏è –ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
      <div class="ptab"    onclick="switchPrev('emp')">üë∑ –°–æ—Ç—Ä—É–¥–Ω–∏–∫</div>
    </div>
    <div class="pcard glass" id="prevCard">
      <div class="pavatar buyer" id="prevAv">üõçÔ∏è</div>
      <div>
        <div class="pname" id="prevName">–ê–Ω–Ω–∞ –ö.</div>
        <div class="pdetail" id="prevDetail">VIP –∫–ª–∏–µ–Ω—Ç ¬∑ –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
      </div>
      <div class="pbadge buyer" id="prevBadge">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
    </div>
  </div>

  <div class="role-btns">
    <button class="rbtn buyer" onclick="setRole('buyer')">
      <span class="rbtn-icon">üõçÔ∏è</span>
      <div>
        <div class="rbtn-title">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
        <div class="rbtn-sub">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ, –ø–æ–ª—É—á–∞–π—Ç–µ QR‚Äë–∫–æ–¥—ã</div>
      </div>
    </button>
    <button class="rbtn emp" onclick="setRole('emp')">
      <span class="rbtn-icon">üë∑</span>
      <div>
        <div class="rbtn-title">–í–æ–π—Ç–∏ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</div>
        <div class="rbtn-sub">–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR‚Äë–∫–æ–¥—ã –∫–∞–º–µ—Ä–æ–π, –≤—ã–¥–∞–≤–∞–π—Ç–µ –∑–∞–∫–∞–∑—ã</div>
      </div>
    </button>
  </div>
</div>

<!-- ‚ïê‚ïê APP ‚ïê‚ïê -->

<div id="app">
  <div class="hdr">
    <div class="hdr-l">
      <div class="hdr-logo">üì¶</div>
      <div class="hdr-title">–ü–í–ó Pro</div>
      <div class="hdr-badge buyer" id="hdrBadge">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
    </div>
    <button class="exit-btn" onclick="exitRole()">‚Üê –í—ã–π—Ç–∏</button>
  </div>
  <div class="tabs" id="tabBar"></div>
  <div class="content" id="content"></div>
</div>

<!-- ‚ïê‚ïê TOAST ‚ïê‚ïê -->

<div id="toast"></div>

<!-- ‚ïê‚ïê MODAL: Product ‚ïê‚ïê -->

<div class="overlay" id="mProduct">
  <div class="modal">
    <div class="mhandle"></div>
    <div class="mtitle" id="mProductTitle">‚ú® –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä</div>
    <div class="fg">
      <label>–ò–∫–æ–Ω–∫–∞</label>
      <div class="egrid" id="egrid"></div>
    </div>
    <div class="fg"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input id="pName" placeholder="–ù–∞—É—à–Ω–∏–∫–∏ Sony..."></div>
    <div class="fg"><label>–¶–µ–Ω–∞ (–æ—Ç 100 ‚ÇΩ)</label><input id="pPrice" type="number" placeholder="1500" min="100"></div>
    <div class="fg"><label>–û–ø–∏—Å–∞–Ω–∏–µ</label><textarea id="pDesc" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ..."></textarea></div>
    <button class="fullbtn p" onclick="saveProduct()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button class="fullbtn s" onclick="closeM('mProduct')">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<!-- ‚ïê‚ïê MODAL: Checkout ‚ïê‚ïê -->

<div class="overlay" id="mCheckout">
  <div class="modal">
    <div class="mhandle"></div>
    <div class="mtitle">üßæ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</div>
    <div id="coItems"></div>
    <div id="coSum"></div>
    <button class="fullbtn p" onclick="placeOrder()">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
    <button class="fullbtn s" onclick="closeM('mCheckout')">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<!-- ‚ïê‚ïê MODAL: QR ‚ïê‚ïê -->

<div class="overlay" id="mQR">
  <div class="modal">
    <div class="mhandle"></div>
    <div class="mtitle" id="mQRTitle">üî≤ QR‚Äë–∫–æ–¥ –∑–∞–∫–∞–∑–∞</div>
    <div class="qr-wrap">
      <div id="qrBox"></div>
      <div class="qr-hint" id="qrHint"></div>
      <div style="color:var(--text2);font-size:12px;margin-bottom:18px;">–ü–æ–∫–∞–∂–∏—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É –ü–í–ó</div>
    </div>
    <button class="fullbtn s" onclick="closeM('mQR')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- ‚ïê‚ïê MODAL: Scanner ‚ïê‚ïê -->

<div class="overlay" id="mScan">
  <div class="modal">
    <div class="mhandle"></div>
    <div class="mtitle">üì∑ –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ QR‚Äë–∫–æ–¥–∞</div>
    <div class="vid-wrap">
      <video id="scanVid" autoplay playsinline muted></video>
      <div class="scan-dim"></div>
      <div class="vid-overlay">
        <div class="scan-frame">
          <div class="sf-inner"></div>
          <div class="scan-beam"></div>
        </div>
      </div>
    </div>
    <div class="scan-hint-txt">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR‚Äë–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</div>
    <button class="fullbtn s" onclick="stopScan()" style="margin-top:16px;">‚úï –û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<!-- ‚ïê‚ïê MODAL: Return ‚ïê‚ïê -->

<div class="overlay" id="mReturn">
  <div class="modal">
    <div class="mhandle"></div>
    <div class="mtitle">‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç —Ç–æ–≤–∞—Ä–æ–≤</div>
    <div style="color:var(--text2);font-size:13px;margin-bottom:16px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞</div>
    <div id="retItems"></div>
    <button class="fullbtn d" onclick="confirmReturn()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</button>
    <button class="fullbtn s" onclick="closeM('mReturn')">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<script>
/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   AUDIO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let AC = null;
function ac() {
  if (!AC) AC = new (window.AudioContext || window.webkitAudioContext)();
  if (AC.state === 'suspended') AC.resume();
  return AC;
}
function tone(freq, type='sine', dur=0.1, vol=0.12, delay=0) {
  try {
    const c = ac(), o = c.createOscillator(), g = c.createGain();
    o.connect(g); g.connect(c.destination);
    o.type = type; o.frequency.value = freq;
    const t = c.currentTime + delay;
    g.gain.setValueAtTime(0, t);
    g.gain.linearRampToValueAtTime(vol, t + 0.01);
    g.gain.exponentialRampToValueAtTime(0.001, t + dur);
    o.start(t); o.stop(t + dur);
  } catch(e) {}
}
const SFX = {
  tap:      () => tone(440,'sine',.07,.09),
  add:      () => { tone(523,'sine',.09,.1); tone(659,'sine',.09,.1,.09); },
  remove:   () => tone(330,'sine',.1,.1),
  success:  () => { [523,659,784].forEach((f,i) => tone(f,'sine',.13,.12,i*.08)); },
  error:    () => tone(180,'sawtooth',.15,.12),
  scan:     () => { tone(880,'sine',.07,.13); tone(1100,'sine',.1,.13,.07); },
  checkout: () => { [523,659,784,1047].forEach((f,i) => tone(f,'sine',.12,.11,i*.065)); },
  complete: () => { [523,784,1047,880,1319].forEach((f,i) => tone(f,'triangle',.14,.12,i*.055)); }
};
document.addEventListener('click', () => { if (!AC) AC = new (window.AudioContext||window.webkitAudioContext)(); }, {once:true});

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   STATE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let role = 'buyer';
let curPage = 'shop';
let products = [
  {id:1, name:'–ù–∞—É—à–Ω–∏–∫–∏ Sony',    price:3990, desc:'–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ —Å —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º', emoji:'üéß'},
  {id:2, name:'–ß–µ—Ö–æ–ª iPhone',     price:490,  desc:'–°–∏–ª–∏–∫–æ–Ω–æ–≤—ã–π –∑–∞—â–∏—Ç–Ω—ã–π —á–µ—Ö–æ–ª',      emoji:'üì±'},
  {id:3, name:'–ó–∞—Ä—è–¥–∫–∞ 65W',      price:890,  desc:'–ë—ã—Å—Ç—Ä–∞—è –∑–∞—Ä—è–¥–∫–∞ USB-C',           emoji:'üîå'},
];
let cart = [];
let orders = [];
let empOrders = [];
let editId = null;
let selEmoji = 'üì¶';
let selPay = 'delivery';
let retOrderId = null;
let retSel = new Set();
let scanStream = null;
let scanTick = null;
let pidC = 20, oidC = 100;
function pid() { return ++pidC; }
function oid() { return ++oidC; }

const EMOJIS = ['üì¶','üéß','üì±','üëü','üëú','üéÆ','üíª','‚åö','üîå','üì∑','üéÅ','üß¥','üëó','üïπÔ∏è','üìö','üçï','üß∏','üí°','üñ•Ô∏è','üéµ','üéí','üõçÔ∏è','üñ±Ô∏è','üé∏','üèãÔ∏è'];
const FMT = n => n.toLocaleString('ru-RU') + ' ‚ÇΩ';
const CC  = () => cart.reduce((s,i) => s+i.qty, 0);
const CT  = () => cart.reduce((s,i) => s+i.p.price*i.qty, 0);

/* profiles */
const PROF = {
  buyer: {name:'–ê–Ω–Ω–∞ –ö.',        detail:'VIP –∫–ª–∏–µ–Ω—Ç ¬∑ –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å', av:'üõçÔ∏è'},
  emp:   {name:'–î–º–∏—Ç—Ä–∏–π –í.',     detail:'–°—Ç–∞—Ä—à–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –ü–í–ó',             av:'üë∑'}
};

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TOAST
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
let toastT = null;
function toast(msg, dur=2600) {
  const el = document.getElementById('toast');
  el.textContent = msg; el.classList.add('on');
  clearTimeout(toastT);
  toastT = setTimeout(() => el.classList.remove('on'), dur);
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openM(id) { SFX.tap(); document.getElementById(id).classList.add('on'); }
function closeM(id) { document.getElementById(id).classList.remove('on'); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ROLE / PROFILE PREVIEW
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function switchPrev(r) {
  SFX.tap();
  const tabs = document.querySelectorAll('.ptab');
  tabs[0].classList.toggle('on', r==='buyer');
  tabs[1].classList.toggle('on', r==='emp');
  const p = PROF[r];
  document.getElementById('prevAv').textContent    = p.av;
  document.getElementById('prevAv').className      = 'pavatar ' + r;
  document.getElementById('prevName').textContent  = p.name;
  document.getElementById('prevDetail').textContent= p.detail;
  document.getElementById('prevBadge').textContent = r==='buyer'?'–ü–æ–∫—É–ø–∞—Ç–µ–ª—å':'–°–æ—Ç—Ä—É–¥–Ω–∏–∫';
  document.getElementById('prevBadge').className   = 'pbadge ' + r;
}

function setRole(r) {
  SFX.success();
  role = r;
  document.getElementById('roleScreen').style.display = 'none';
  document.getElementById('app').classList.add('on');
  const b = document.getElementById('hdrBadge');
  if (r === 'buyer') { b.textContent='üõçÔ∏è –ü–æ–∫—É–ø–∞—Ç–µ–ª—å'; b.className='hdr-badge buyer'; }
  else               { b.textContent='üë∑ –°–æ—Ç—Ä—É–¥–Ω–∏–∫';   b.className='hdr-badge emp'; }
  curPage = r==='buyer' ? 'shop' : 'scanner';
  renderTabs(); renderPage(curPage);
}

function exitRole() {
  SFX.tap();
  stopScan();
  document.getElementById('app').classList.remove('on');
  document.getElementById('roleScreen').style.display = 'flex';
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   TABS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
const BTABS = [
  {id:'shop',    icon:'üè™', label:'–ú–∞–≥–∞–∑–∏–Ω'},
  {id:'cart',    icon:'üõí', label:'–ö–æ—Ä–∑–∏–Ω–∞',  bdg:'cart'},
  {id:'orders',  icon:'üìã', label:'–ó–∞–∫–∞–∑—ã'},
  {id:'profile', icon:'üë§', label:'–ü—Ä–æ—Ñ–∏–ª—å'},
];
const ETABS = [
  {id:'scanner', icon:'üì∑', label:'–°–∫–∞–Ω–µ—Ä'},
  {id:'eorders', icon:'üìã', label:'–ó–∞–∫–∞–∑—ã', bdg:'emp'},
  {id:'profile', icon:'üë§', label:'–ü—Ä–æ—Ñ–∏–ª—å'},
];

function renderTabs() {
  const tabs = role==='buyer' ? BTABS : ETABS;
  document.getElementById('tabBar').innerHTML = tabs.map(t => {
    let b = '';
    if (t.bdg==='cart' && CC()>0) b = `<span class="bdg">${CC()}</span>`;
    if (t.bdg==='emp') { const n=empOrders.filter(o=>o.status!=='done').length; if(n) b=`<span class="bdg">${n}</span>`; }
    return `<div class="tab${curPage===t.id?' on':''}" onclick="navTo('${t.id}')">
      <span class="ti">${t.icon}</span>${t.label}${b}
    </div>`;
  }).join('');
}

function navTo(id) { SFX.tap(); renderPage(id); }

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PAGES
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderPage(id) {
  curPage = id;
  renderTabs();
  const el = document.getElementById('content');

  if      (id==='shop')    el.innerHTML = renderShop();
  else if (id==='cart')    el.innerHTML = renderCart();
  else if (id==='orders')  el.innerHTML = renderOrders();
  else if (id==='scanner') el.innerHTML = renderScanner();
  else if (id==='eorders') el.innerHTML = renderEOrders();
  else if (id==='profile') el.innerHTML = renderProfile();

  // FAB
  const old = document.getElementById('FAB');
  if (old) old.remove();
  if (id==='shop') {
    const f = document.createElement('button');
    f.className='fab'; f.id='FAB'; f.textContent='+';
    f.onclick = () => { SFX.tap(); openProductModal(null); };
    document.body.appendChild(f);
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SHOP
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderShop() {
  if (!products.length) return `<div class="empty"><div class="ei">üè™</div><p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.<br>–ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å</p></div>`;
  return `<div class="sec">–¢–æ–≤–∞—Ä—ã ¬∑ ${products.length}</div>
  <div class="pgrid">${products.map(pc).join('')}</div>`;
}
function pc(p) {
  return `<div class="pcard glass">
    <div class="pcard-img">${p.emoji}</div>
    <div class="pcard-body">
      <div class="pcard-name">${p.name}</div>
      <div class="pcard-desc">${p.desc}</div>
      <div class="pcard-price">${FMT(p.price)}</div>
    </div>
    <div class="pcard-acts">
      <button class="btn s" onclick="openProductModal(${p.id})">‚úèÔ∏è</button>
      <button class="btn d" onclick="delProduct(${p.id})">üóëÔ∏è</button>
      <button class="btn p grow" onclick="addCart(${p.id})">+ –ö–æ—Ä–∑–∏–Ω–∞</button>
    </div>
  </div>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PRODUCT MODAL
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function openProductModal(id) {
  editId = id;
  const p = id ? products.find(x=>x.id===id) : null;
  document.getElementById('mProductTitle').textContent = id ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '‚ú® –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä';
  document.getElementById('pName').value  = p ? p.name  : '';
  document.getElementById('pPrice').value = p ? p.price : '';
  document.getElementById('pDesc').value  = p ? p.desc  : '';
  selEmoji = p ? p.emoji : 'üì¶';
  renderEGrid();
  openM('mProduct');
}
function renderEGrid() {
  document.getElementById('egrid').innerHTML =
    EMOJIS.map(e=>`<div class="eo${e===selEmoji?' on':''}" onclick="pickEmoji('${e}')">${e}</div>`).join('');
}
function pickEmoji(e) { SFX.tap(); selEmoji=e; renderEGrid(); }
function saveProduct() {
  const name  = document.getElementById('pName').value.trim();
  const price = parseInt(document.getElementById('pPrice').value);
  const desc  = document.getElementById('pDesc').value.trim();
  if (!name)            { SFX.error(); return toast('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); }
  if (!price||price<100){ SFX.error(); return toast('‚ö†Ô∏è –¶–µ–Ω–∞ –æ—Ç 100 ‚ÇΩ'); }
  if (editId) {
    Object.assign(products.find(x=>x.id===editId), {name,price,desc,emoji:selEmoji});
    SFX.success(); toast('‚úÖ –¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω');
  } else {
    products.push({id:pid(),name,price,desc,emoji:selEmoji});
    SFX.add(); toast('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω');
  }
  closeM('mProduct'); renderPage('shop');
}
function delProduct(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä?')) return;
  SFX.remove();
  products = products.filter(p=>p.id!==id);
  cart     = cart.filter(i=>i.p.id!==id);
  renderPage('shop'); toast('üóëÔ∏è –£–¥–∞–ª–µ–Ω–æ');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   CART
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function addCart(id) {
  const p = products.find(x=>x.id===id);
  const e = cart.find(i=>i.p.id===id);
  if (e) e.qty++; else cart.push({p, qty:1});
  SFX.add(); toast(`üõí ${p.name} –¥–æ–±–∞–≤–ª–µ–Ω`); renderTabs();
}
function renderCart() {
  if (!cart.length) return `<div class="empty"><div class="ei">üõí</div><p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</p></div>`;
  return `<div class="sec">–ö–æ—Ä–∑–∏–Ω–∞ ¬∑ ${CC()} –ø–æ–∑.</div>
  ${cart.map(i=>`<div class="cart-item glass">
    <div class="ci-emoji">${i.p.emoji}</div>
    <div class="ci-info">
      <div class="ci-name">${i.p.name}</div>
      <div class="ci-price">${FMT(i.p.price)} –∑–∞ —à—Ç.</div>
      <div class="qty-row">
        <button class="qbtn" onclick="chQty(${i.p.id},-1)">‚àí</button>
        <span class="qnum">${i.qty}</span>
        <button class="qbtn" onclick="chQty(${i.p.id},1)">+</button>
        <button class="qbtn" onclick="remCart(${i.p.id})" style="font-size:14px">üóëÔ∏è</button>
      </div>
    </div>
    <div class="ci-total">${FMT(i.p.price*i.qty)}</div>
  </div>`).join('')}
  <div class="cart-sum glass">
    <div class="csr"><span class="lbl">–ü–æ–∑–∏—Ü–∏–π:</span><span style="font-weight:800">${CC()}</span></div>
    <div style="height:1px;background:rgba(255,255,255,.08);margin:8px 0"></div>
    <div class="csr"><span class="lbl">–ò—Ç–æ–≥–æ:</span><span class="big-total">${FMT(CT())}</span></div>
    <div style="margin-top:18px;font-size:11px;font-weight:900;color:var(--text3);text-transform:uppercase;letter-spacing:.6px;margin-bottom:12px">–û–ø–ª–∞—Ç–∞</div>
    <div class="pay-opts">
      <div class="pay-opt${selPay==='delivery'?' on':''}" onclick="setPay('delivery')">
        <span class="pi">üíµ</span>–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
      </div>
      <div class="pay-opt${selPay==='online'?' on':''}" onclick="setPay('online')">
        <span class="pi">üí≥</span>–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å
      </div>
    </div>
    <button class="fullbtn p" onclick="openCheckout()" style="margin-top:14px">üöÄ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>`;
}
function chQty(id,d) {
  SFX.tap();
  const i = cart.find(x=>x.p.id===id);
  if (!i) return;
  i.qty += d;
  if (i.qty<=0) { cart=cart.filter(x=>x.p.id!==id); SFX.remove(); }
  renderPage('cart');
}
function remCart(id) { SFX.remove(); cart=cart.filter(i=>i.p.id!==id); renderPage('cart'); }
function setPay(p)   { SFX.tap(); selPay=p; renderPage('cart'); }
function openCheckout() {
  if (!cart.length) return;
  SFX.tap();
  document.getElementById('coItems').innerHTML =
    cart.map(i=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,.07);font-size:14px">
      <span>${i.p.emoji} ${i.p.name} <span style="color:var(--text2)">√ó${i.qty}</span></span>
      <span style="font-weight:800;color:var(--orange)">${FMT(i.p.price*i.qty)}</span>
    </div>`).join('');
  document.getElementById('coSum').innerHTML =
    `<div style="background:rgba(0,122,255,.1);border:1px solid rgba(0,122,255,.2);border-radius:16px;padding:16px;margin-top:16px">
      <div class="csr"><span class="lbl">–ü–æ–∑–∏—Ü–∏–π:</span><span style="font-weight:800">${CC()}</span></div>
      <div class="csr"><span class="lbl">–û–ø–ª–∞—Ç–∞:</span><span style="font-weight:800">${selPay==='delivery'?'üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏':'üí≥ –û–ø–ª–∞—á–µ–Ω–æ –æ–Ω–ª–∞–π–Ω'}</span></div>
      <div style="height:1px;background:rgba(255,255,255,.1);margin:8px 0"></div>
      <div class="csr"><span class="lbl" style="font-size:16px">–ò—Ç–æ–≥–æ:</span><span class="big-total">${FMT(CT())}</span></div>
    </div>`;
  openM('mCheckout');
}
function placeOrder() {
  SFX.checkout();
  const cell = Math.floor(Math.random()*89+10).toString();
  orders.push({
    id:oid(), items:cart.map(i=>({...i})), total:CT(),
    payment:selPay, status:'pending', cell,
    scanned:[], returned:[], at: new Date()
  });
  cart=[];
  closeM('mCheckout');
  toast('üéâ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!');
  renderPage('orders');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   ORDERS (buyer)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderOrders() {
  if (!orders.length) return `<div class="empty"><div class="ei">üìã</div><p>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p></div>`;
  return `<div class="sec">–ú–æ–∏ –∑–∞–∫–∞–∑—ã ¬∑ ${orders.length}</div>
  ${orders.slice().reverse().map(o=>{
    const st = o.status==='ready';
    return `<div class="order-card glass">
      <div class="oh">
        <div class="onum">–ó–∞–∫–∞–∑ #${o.id}</div>
        <div class="ostatus ${st?'st-done':'st-wait'}">${st?'‚úÖ –í—ã–¥–∞–Ω':'‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ'}</div>
      </div>
      <div class="ometa">
        <div class="ombadge">üì¶ –Ø—á–µ–π–∫–∞ ${o.cell}</div>
        <div class="ombadge">${o.payment==='delivery'?'üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏':'üí≥ –û–ø–ª–∞—á–µ–Ω–æ'}</div>
        <div class="ombadge">${o.items.reduce((s,i)=>s+i.qty,0)} –ø–æ–∑.</div>
      </div>
      <div class="oprice">${FMT(o.total)}</div>
      <button class="fullbtn p" style="margin-top:0" onclick="showQR(${o.id})">üî≤ –ü–æ–∫–∞–∑–∞—Ç—å QR‚Äë–∫–æ–¥</button>
    </div>`;
  }).join('')}`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   QR CODE  (self-contained generator)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function showQR(orderId) {
  const o = orders.find(x=>x.id===orderId);
  if (!o) return;
  SFX.scan();

  const data = JSON.stringify({
    orderId: o.id, cell: o.cell,
    count: o.items.reduce((s,i)=>s+i.qty,0),
    total: o.total, payment: o.payment,
    items: o.items.map(i=>({
      id: i.p.id, name: i.p.name, price: i.p.price, qty: i.qty, emoji: i.p.emoji
    }))
  });

  document.getElementById('mQRTitle').textContent = `üî≤ –ó–∞–∫–∞–∑ #${o.id}`;
  document.getElementById('qrHint').innerHTML =
    `${o.items.reduce((s,i)=>s+i.qty,0)} –ø–æ–∑–∏—Ü–∏–π ¬∑ –Ø—á–µ–π–∫–∞ <b>${o.cell}</b> ¬∑ ${FMT(o.total)}`;

  openM('mQR');

  // Build QR after modal opens
  requestAnimationFrame(() => {
    const box = document.getElementById('qrBox');
    box.innerHTML = '';
    const canvas = document.createElement('canvas');
    canvas.width  = 230;
    canvas.height = 230;
    box.appendChild(canvas);
    qrDraw(canvas, data);
  });
}

/* ‚îÄ‚îÄ Tiny QR encoder (Mode 4=Byte, ECC=M, mask 0) ‚îÄ‚îÄ */
function qrDraw(canvas, text) {
  const bytes = utf8(text);
  const version = pickVersion(bytes.length);
  if (!version) { canvas.getContext('2d').fillText('–°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç',10,20); return; }

  const N = version * 4 + 17;
  const m = buildMatrix(N, version, bytes);
  applyMask(m, N);
  placeFormat(m, N);

  const ctx = canvas.getContext('2d');
  const sz = canvas.width;
  const cell = sz / N;
  ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,sz,sz);
  ctx.fillStyle = '#000000';
  for (let r=0;r<N;r++)
    for (let c=0;c<N;c++)
      if (m[r][c]===1)
        ctx.fillRect(Math.floor(c*cell), Math.floor(r*cell), Math.ceil(cell)+0.5, Math.ceil(cell)+0.5);
}

function utf8(str) {
  const b=[];
  for (let i=0;i<str.length;i++){
    const c=str.charCodeAt(i);
    if(c<0x80) b.push(c);
    else if(c<0x800){b.push(0xC0|(c>>6));b.push(0x80|(c&0x3F));}
    else{b.push(0xE0|(c>>12));b.push(0x80|((c>>6)&0x3F));b.push(0x80|(c&0x3F));}
  }
  return b;
}

/* Capacities for ECC=M (byte mode) */
const CAP=[0,14,26,42,62,84,106,122,154,180,213,251,287,331,370,411,461,511,535,593,625,658,698,742,790,842,898,958,983,1051,1093,1139,1183,1229,1283,1351,1423,1499,1579,1663,1749];
function pickVersion(n){for(let v=1;v<=40;v++)if(CAP[v]>=n+3)return v;return null;}

/* Total data codewords per version (ECC=M) */
const DC=[0,16,28,44,64,86,108,124,154,182,216,254,290,334,365,415,453,507,563,627,669,714,782,860,914,1000,1062,1128,1193,1267,1373,1455,1541,1631,1725,1812,1914,1992,2102,2216,2334];

function buildMatrix(N, V, bytes) {
  const m = Array.from({length:N},()=>new Int8Array(N).fill(-1)); // -1=unfilled

  /* Finder patterns */
  function finder(r,c){
    for(let dr=-1;dr<=7;dr++)for(let dc=-1;dc<=7;dc++){
      const rr=r+dr,cc=c+dc;
      if(rr<0||rr>=N||cc<0||cc>=N) continue;
      const inside=dr>=0&&dr<=6&&dc>=0&&dc<=6;
      const border=dr===0||dr===6||dc===0||dc===6;
      const inner=dr>=2&&dr<=4&&dc>=2&&dc<=4;
      m[rr][cc]=inside&&(border||inner)?1:0;
    }
  }
  finder(0,0); finder(0,N-7); finder(N-7,0);

  /* Timing */
  for(let i=8;i<N-8;i++){
    if(m[6][i]<0) m[6][i]=i%2===0?1:0;
    if(m[i][6]<0) m[i][6]=i%2===0?1:0;
  }

  /* Dark module */
  m[N-8][8]=1;

  /* Alignment patterns */
  const AL=[null,[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]];
  if(V>=2&&AL[V]){
    const a=AL[V];
    for(const r of a)for(const c of a){
      if(m[r][c]>=0) continue;
      for(let dr=-2;dr<=2;dr++)for(let dc=-2;dc<=2;dc++){
        m[r+dr][c+dc]=(Math.abs(dr)===2||Math.abs(dc)===2||(dr===0&&dc===0))?1:0;
      }
    }
  }

  /* Data bits */
  const dbytes=[];
  // Mode indicator (4=byte) + length
  dbytes.push(0x40|(bytes.length>>4));
  dbytes.push(((bytes.length&0xF)<<4)|(bytes.length>0?bytes[0]>>4:0));
  for(let i=0;i<bytes.length;i++){
    const lo=bytes[i]&0xF;
    const hi=i+1<bytes.length?bytes[i+1]>>4:0;
    dbytes.push((lo<<4)|hi);
  }
  const total=DC[V]||128;
  while(dbytes.length<total) dbytes.push(dbytes.length%2===0?0xEC:0x11);

  /* Convert to bits */
  const bits=[];
  for(const b of dbytes) for(let i=7;i>=0;i--) bits.push((b>>i)&1);

  /* Place in zigzag */
  let bi=0, up=true;
  for(let col=N-1;col>=1;col-=2){
    if(col===6) col--;
    for(let i=0;i<N;i++){
      const row=up?N-1-i:i;
      for(const dc of [0,-1]){
        const c=col+dc;
        if(m[row][c]<0) m[row][c]=bi<bits.length?bits[bi++]:0;
      }
    }
    up=!up;
  }

  return m;
}

function applyMask(m,N){
  // mask pattern 0: (r+c)%2===0
  const skip=(r,c)=>{
    const rf=(r<9&&c<9)||(r<9&&c>=N-8)||(r>=N-8&&c<9);
    if(rf) return true;
    // timing
    if(r===6||c===6) return true;
    return false;
  };
  for(let r=0;r<N;r++)for(let c=0;c<N;c++){
    if(!skip(r,c)&&m[r][c]>=0&&(r+c)%2===0) m[r][c]^=1;
  }
}

function placeFormat(m,N){
  // Format string for ECC=M, mask=0 (pre-calculated): 101010000010010
  const fs=[1,0,1,0,1,0,0,0,0,0,1,0,0,1,0];
  // Positions around top-left finder
  const p=[[8,0],[8,1],[8,2],[8,3],[8,4],[8,5],[8,7],[8,8],[7,8],[5,8],[4,8],[3,8],[2,8],[1,8],[0,8]];
  for(let i=0;i<15;i++){
    m[p[i][0]][p[i][1]]=fs[i];
    // top-right / bottom-left copies
    if(i<7)  m[N-1-i][8]=fs[i];
    else     m[8][N-15+i]=fs[i];
  }
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SCANNER (employee)
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderScanner() {
  const hist = empOrders.slice(-3).reverse();
  return `<div class="scan-card glass">
    <div class="scan-big-icon">üì∑</div>
    <div class="scan-title">–°–∫–∞–Ω–µ—Ä QR‚Äë–∫–æ–¥–æ–≤</div>
    <div class="scan-sub">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É, –ø–æ–¥–Ω–µ—Å–∏—Ç–µ QR‚Äë–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ –∫ –∫–∞–º–µ—Ä–µ</div>
    <button class="fullbtn p" onclick="startScan()" style="margin:0 auto;max-width:300px;font-size:17px;padding:17px">
      üì∑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É
    </button>
  </div>
  <div style="margin-top:4px">
    <div class="sec">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>
    ${!hist.length ? '<div class="empty" style="padding:24px 20px"><div class="ei" style="font-size:40px">üî≤</div><p style="font-size:13px">–ù–µ—Ç –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p></div>'
    : hist.map(o=>`<div class="scan-hist-item glass-sm">
        <span style="font-size:28px">üì¶</span>
        <div style="flex:1">
          <div style="font-weight:800">–ó–∞–∫–∞–∑ #${o.id}</div>
          <div style="color:var(--text2);font-size:12px">–Ø—á–µ–π–∫–∞ ${o.cell} ¬∑ ${FMT(o.total)}</div>
        </div>
        <div style="font-size:12px;font-weight:800;color:${o.status==='done'?'var(--green)':'var(--orange)'}">
          ${o.status==='done'?'–í—ã–¥–∞–Ω':'–ê–∫—Ç–∏–≤–µ–Ω'}
        </div>
      </div>`).join('')}
  </div>`;
}

let scanCanvas = null;
let scanCtx    = null;

function startScan() {
  SFX.tap();
  openM('mScan');
  const vid = document.getElementById('scanVid');

  if (!scanCanvas) {
    scanCanvas = document.createElement('canvas');
    scanCtx    = scanCanvas.getContext('2d', {willReadFrequently:true});
  }

  const constraints = {
    video: {
      facingMode: {ideal:'environment'},
      width:  {ideal:1280},
      height: {ideal:720}
    }
  };

  navigator.mediaDevices.getUserMedia(constraints)
    .then(stream => {
      scanStream = stream;
      vid.srcObject = stream;

      vid.onloadedmetadata = () => {
        vid.play().catch(()=>{});
      };

      // Give video time to start then begin scanning
      setTimeout(() => {
        clearInterval(scanTick);
        scanTick = setInterval(() => {
          if (vid.readyState < vid.HAVE_ENOUGH_DATA) return;
          if (!vid.videoWidth) return;

          scanCanvas.width  = vid.videoWidth;
          scanCanvas.height = vid.videoHeight;
          scanCtx.drawImage(vid, 0, 0);

          let img;
          try { img = scanCtx.getImageData(0,0,scanCanvas.width,scanCanvas.height); }
          catch(e) { return; }

          const code = jsQR(img.data, img.width, img.height, {inversionAttempts:'dontInvert'});
          if (code && code.data) {
            clearInterval(scanTick);
            stopScan();
            processQR(code.data);
          }
        }, 120);
      }, 800);
    })
    .catch(err => {
      closeM('mScan');
      SFX.error();
      if (err.name === 'NotAllowedError') toast('‚ö†Ô∏è –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ');
      else if (err.name === 'NotFoundError') toast('‚ö†Ô∏è –ö–∞–º–µ—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
      else toast('‚ö†Ô∏è –û—à–∏–±–∫–∞ –∫–∞–º–µ—Ä—ã: ' + err.message);
    });
}

function stopScan() {
  clearInterval(scanTick);
  if (scanStream) {
    scanStream.getTracks().forEach(t=>t.stop());
    scanStream = null;
  }
  closeM('mScan');
}

function processQR(raw) {
  let data;
  try { data = JSON.parse(raw); }
  catch(e) { SFX.error(); toast('‚ö†Ô∏è –ù–µ—á–∏—Ç–∞–µ–º—ã–π QR‚Äë–∫–æ–¥'); return; }

  const id = data.orderId || data.id;
  if (!id) { SFX.error(); toast('‚ö†Ô∏è QR –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞'); return; }

  const exists = empOrders.find(o=>o.id===id);
  if (!exists) {
    const o = {
      id, cell: data.cell, total: data.total,
      payment: data.payment, status: 'pending',
      items: data.items||[], scanned:[], returned:[]
    };
    empOrders.push(o);
  }

  SFX.scan();
  const n = data.count || (data.items||[]).reduce((s,i)=>s+i.qty,0);
  speak(`–Ø—á–µ–π–∫–∞ ${data.cell}. ${n} ${n===1?'—Ç–æ–≤–∞—Ä':n<5?'—Ç–æ–≤–∞—Ä–∞':'—Ç–æ–≤–∞—Ä–æ–≤'}. ${data.payment==='delivery'?'–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏':'–æ–ø–ª–∞—á–µ–Ω–æ –æ–Ω–ª–∞–π–Ω'}.`);
  toast(`üì¶ –ó–∞–∫–∞–∑ #${id} –∑–∞–≥—Ä—É–∂–µ–Ω`);
  renderPage('eorders');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   EMP ORDERS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderEOrders() {
  const active = empOrders.filter(o=>o.status!=='done');
  const done   = empOrders.filter(o=>o.status==='done');
  if (!empOrders.length)
    return `<div class="empty"><div class="ei">üìã</div><p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.<br>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR‚Äë–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</p></div>`;

  let html='';
  if(active.length){ html+=`<div class="sec">–ê–∫—Ç–∏–≤–Ω—ã–µ ¬∑ ${active.length}</div>`; html+=active.map(empCard).join(''); }
  if(done.length)  { html+=`<div class="sec" style="margin-top:22px">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ ¬∑ ${done.length}</div>`; html+=done.map(o=>`<div style="opacity:.5">${empCard(o)}</div>`).join(''); }
  return html;
}

function empCard(o) {
  const sc = o.scanned||[], rt = o.returned||[];
  const total = o.items.reduce((s,i)=>s+i.price*i.qty,0);
  const done  = o.items.every(i=>sc.includes(i.id)||rt.includes(i.id));
  const prog  = Math.round((sc.length+rt.length)/Math.max(o.items.length,1)*100);

  let acts='';
  if(o.status==='done'){
    acts=`<div style="text-align:center;color:var(--green);font-weight:800;padding:10px">‚úÖ –ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à—ë–Ω</div>`;
  } else if(done){
    acts=`<div style="display:flex;gap:8px;margin-top:12px">
      ${rt.length===0?`<button class="btn d" onclick="openReturn(${o.id})">‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç</button>`:''}
      <button class="btn g grow" onclick="completeOrder(${o.id})">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å</button>
    </div>`;
  } else {
    acts=`<div style="margin-top:12px"><button class="btn d" onclick="openReturn(${o.id})">‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç</button></div>`;
  }

  return `<div class="emp-card glass">
    <div class="emp-hdr">
      <div class="emp-title">–ó–∞–∫–∞–∑ #${o.id}</div>
      <div class="ostatus ${o.status==='done'?'st-done':'st-wait'}">${o.status==='done'?'–í—ã–¥–∞–Ω':'–ê–∫—Ç–∏–≤–µ–Ω'}</div>
    </div>
    <div class="info-row">
      <div class="infobdg">üì¶ –Ø—á–µ–π–∫–∞ ${o.cell}</div>
      <div class="infobdg">${o.payment==='delivery'?'üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏':'üí≥ –û–ø–ª–∞—á–µ–Ω–æ'}</div>
      <div class="infobdg">üí∞ ${FMT(total)}</div>
    </div>
    ${o.items.length?`
    <div style="margin-bottom:8px">
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text3);margin-bottom:4px">
        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span><span>${sc.length+rt.length}/${o.items.length}</span>
      </div>
      <div class="prog-wrap"><div class="prog-bar" style="width:${prog}%"></div></div>
    </div>`:''}
    <div class="sec" style="margin-bottom:8px">–¢–æ–≤–∞—Ä—ã</div>
    <div class="items-list">
      ${o.items.map(i=>{
        const isS=sc.includes(i.id), isR=rt.includes(i.id);
        const cls=isS?'item-row scanned':isR?'item-row returned':'item-row';
        const mark=isS?'‚úÖ':isR?'‚Ü©Ô∏è':'';
        const btn=(!isS&&!isR&&o.status!=='done')
          ?`<button class="btn p" style="font-size:11px;padding:7px 11px" onclick="scanItem(${o.id},${i.id})">–í—ã–¥–∞—Ç—å</button>`:'';
        return `<div class="${cls}">
          <div class="item-emoji">${i.emoji}</div>
          <div class="item-info">
            <div class="item-name">${i.name}</div>
            <div class="item-price">${FMT(i.price)} √ó ${i.qty}</div>
          </div>
          <span class="item-mark">${mark}</span>${btn}
        </div>`;
      }).join('')}
    </div>
    ${acts}
  </div>`;
}

function scanItem(oid, iid) {
  const o=empOrders.find(x=>x.id===oid); if(!o) return;
  if (!o.scanned) o.scanned=[];
  if (o.scanned.includes(iid)) return;
  o.scanned.push(iid);
  SFX.scan();
  const done=o.items.every(i=>o.scanned.includes(i.id)||(o.returned||[]).includes(i.id));
  if(done){SFX.success();toast('üéâ –í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤—ã–¥–∞–Ω—ã!');}
  else toast('‚úÖ –¢–æ–≤–∞—Ä –æ—Ç–º–µ—á–µ–Ω');
  renderPage('eorders');
}

function openReturn(oid) {
  SFX.tap();
  retOrderId=oid; retSel=new Set();
  const o=empOrders.find(x=>x.id===oid);
  const items=o.items.filter(i=>!(o.returned||[]).includes(i.id));
  document.getElementById('retItems').innerHTML = !items.length
    ? '<div style="text-align:center;color:var(--text2);padding:20px">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞</div>'
    : items.map(i=>`<div class="ret-item" id="ri${i.id}" onclick="togRet(${i.id})">
        <div class="ret-cb" id="rc${i.id}"></div>
        <div style="font-size:26px">${i.emoji}</div>
        <div style="flex:1">
          <div style="font-weight:800;font-size:14px">${i.name}</div>
          <div style="color:var(--text2);font-size:12px">${FMT(i.price)} √ó ${i.qty}</div>
        </div>
      </div>`).join('');
  openM('mReturn');
}
function togRet(id){
  SFX.tap();
  retSel.has(id)?retSel.delete(id):retSel.add(id);
  document.getElementById(`ri${id}`).classList.toggle('on',retSel.has(id));
  document.getElementById(`rc${id}`).textContent=retSel.has(id)?'‚úì':'';
}
function confirmReturn(){
  if(!retSel.size){SFX.error();return toast('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã');}
  const o=empOrders.find(x=>x.id===retOrderId);
  if(!o.returned)o.returned=[];
  retSel.forEach(id=>{
    if(!o.returned.includes(id))o.returned.push(id);
    if(o.scanned)o.scanned=o.scanned.filter(s=>s!==id);
  });
  SFX.success(); closeM('mReturn'); toast('‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω'); renderPage('eorders');
}
function completeOrder(oid){
  const o=empOrders.find(x=>x.id===oid); o.status='done';
  SFX.complete(); toast('üéâ –ó–∞–∫–∞–∑ –≤—ã–¥–∞–Ω!'); renderPage('eorders');
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   PROFILE
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function renderProfile() {
  const isBuyer = role==='buyer';
  const p = PROF[isBuyer?'buyer':'emp'];
  const myList = isBuyer?orders:empOrders;
  const spent = isBuyer?orders.reduce((s,o)=>s+o.total,0):0;
  const compl = isBuyer?orders.filter(o=>o.status==='ready').length:empOrders.filter(o=>o.status==='done').length;

  return `<div class="prof-hero glass">
    <div class="prof-av ${isBuyer?'buyer':'emp'}">${p.av}</div>
    <div class="prof-name">${p.name}</div>
    <div class="prof-role">${p.detail}</div>
    <div class="stats-grid">
      <div class="stat-box"><div class="stat-n">${myList.length}</div><div class="stat-l">${isBuyer?'–ó–∞–∫–∞–∑–æ–≤':'–ü—Ä–∏–Ω—è—Ç–æ'}</div></div>
      <div class="stat-box"><div class="stat-n">${compl}</div><div class="stat-l">${isBuyer?'–ü–æ–ª—É—á–µ–Ω–æ':'–í—ã–¥–∞–Ω–æ'}</div></div>
      <div class="stat-box"><div class="stat-n">${isBuyer?(spent>0?Math.round(spent/1000)+'–∫':'0'):products.length}</div><div class="stat-l">${isBuyer?'–¢—Ä–∞—Ç (‚ÇΩ)':'–¢–æ–≤–∞—Ä–æ–≤'}</div></div>
    </div>
  </div>
  <div class="info-card glass">
    <div class="sec" style="margin-bottom:14px">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
    ${isBuyer?`
      <div class="info-row-item"><span class="lbl">–°—Ç–∞—Ç—É—Å</span><span class="val" style="color:var(--green)">VIP –ö–ª–∏–µ–Ω—Ç ‚≠ê</span></div>
      <div class="info-row-item"><span class="lbl">–ó–∞–∫–∞–∑–æ–≤</span><span class="val">${orders.length}</span></div>
      <div class="info-row-item"><span class="lbl">–°—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫</span><span class="val" style="color:var(--orange)">${FMT(spent)}</span></div>
    `:`
      <div class="info-row-item"><span class="lbl">–î–æ–ª–∂–Ω–æ—Å—Ç—å</span><span class="val">–°—Ç–∞—Ä—à–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä</span></div>
      <div class="info-row-item"><span class="lbl">–°–º–µ–Ω–∞</span><span class="val" style="color:var(--green)">‚óè –û–Ω–ª–∞–π–Ω</span></div>
      <div class="info-row-item"><span class="lbl">–í—ã–¥–∞–Ω–æ</span><span class="val">${compl} –∑–∞–∫–∞–∑–æ–≤</span></div>
    `}
  </div>
  <button class="fullbtn s" onclick="exitRole()">‚Üê –°–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button>`;
}

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
   SPEECH
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
function speak(txt){
  if(!window.speechSynthesis) return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(txt);
  u.lang='ru-RU'; u.rate=0.95;
  speechSynthesis.speak(u);
}
</script>

</body>
</html>