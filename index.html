<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>–ü–í–ó Pro</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=SF+Pro+Display:wght@300;400;600;700&family=Nunito:wght@300;400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --glass: rgba(255,255,255,0.12);
  --glass-border: rgba(255,255,255,0.25);
  --glass-hover: rgba(255,255,255,0.18);
  --glass-dark: rgba(0,0,0,0.25);
  --blur: blur(24px) saturate(180%);
  --blur-light: blur(12px) saturate(150%);
  --accent: #007AFF;
  --accent2: #5856D6;
  --accent3: #FF9500;
  --accent4: #34C759;
  --accent5: #FF3B30;
  --text: rgba(255,255,255,0.95);
  --text2: rgba(255,255,255,0.55);
  --text3: rgba(255,255,255,0.35);
  --r: 18px;
  --r2: 24px;
  --shadow: 0 8px 32px rgba(0,0,0,0.35), 0 2px 8px rgba(0,0,0,0.2);
  --shadow2: 0 20px 60px rgba(0,0,0,0.4);
}

- { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

body {
font-family: ‚ÄòNunito‚Äô, sans-serif;
min-height: 100dvh;
background: #0a0a1a;
color: var(‚Äìtext);
overflow-x: hidden;
}

/* ANIMATED BG */
.bg-scene {
position: fixed; inset: 0; z-index: 0; pointer-events: none;
background:
radial-gradient(ellipse 80% 60% at 20% 10%, rgba(88,86,214,0.35) 0%, transparent 60%),
radial-gradient(ellipse 60% 50% at 80% 20%, rgba(0,122,255,0.3) 0%, transparent 55%),
radial-gradient(ellipse 70% 60% at 50% 80%, rgba(255,149,0,0.15) 0%, transparent 60%),
linear-gradient(160deg, #0d0d2b 0%, #0a0a1a 50%, #0d1520 100%);
}
.bg-orb {
position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.6;
animation: floatOrb 8s ease-in-out infinite;
}
.orb1 { width: 300px; height: 300px; top: -100px; left: -100px; background: rgba(88,86,214,0.5); animation-delay: 0s; }
.orb2 { width: 250px; height: 250px; top: 30%; right: -80px; background: rgba(0,122,255,0.4); animation-delay: -3s; }
.orb3 { width: 200px; height: 200px; bottom: 20%; left: 10%; background: rgba(52,199,89,0.3); animation-delay: -6s; }

@keyframes floatOrb {
0%,100% { transform: translate(0,0) scale(1); }
33% { transform: translate(20px,-30px) scale(1.05); }
66% { transform: translate(-15px,20px) scale(0.95); }
}

/* GLASS COMPONENTS */
.glass {
background: var(‚Äìglass);
backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border);
box-shadow: var(‚Äìshadow);
}
.glass-light {
background: rgba(255,255,255,0.08);
backdrop-filter: var(‚Äìblur-light);
-webkit-backdrop-filter: var(‚Äìblur-light);
border: 1px solid rgba(255,255,255,0.15);
}

/* ===== ROLE SCREEN ===== */
#roleScreen {
position: relative; z-index: 1;
display: flex; flex-direction: column; align-items: center; justify-content: center;
min-height: 100dvh; padding: 32px 24px; gap: 0;
}

.role-logo {
font-size: 72px; margin-bottom: 16px;
filter: drop-shadow(0 0 30px rgba(0,122,255,0.5));
animation: logoPulse 3s ease-in-out infinite;
}
@keyframes logoPulse { 0%,100% { filter: drop-shadow(0 0 30px rgba(0,122,255,0.5)); } 50% { filter: drop-shadow(0 0 50px rgba(88,86,214,0.7)); } }

.role-title {
font-size: 36px; font-weight: 800; letter-spacing: -1px;
background: linear-gradient(135deg, #fff 0%, rgba(255,255,255,0.7) 100%);
-webkit-background-clip: text; -webkit-text-fill-color: transparent;
margin-bottom: 8px;
}
.role-subtitle { color: var(‚Äìtext2); font-size: 15px; text-align: center; margin-bottom: 40px; line-height: 1.5; }

.role-cards { display: flex; flex-direction: column; gap: 16px; width: 100%; max-width: 360px; }

.roleBtn {
width: 100%; padding: 22px 24px;
border-radius: var(‚Äìr2);
border: none; cursor: pointer;
display: flex; align-items: center; gap: 18px;
transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
position: relative; overflow: hidden; text-align: left;
}
.roleBtn::before {
content: ‚Äò‚Äô; position: absolute; inset: 0; opacity: 0; transition: opacity 0.3s;
background: radial-gradient(circle at 50% 50%, rgba(255,255,255,0.15), transparent 70%);
}
.roleBtn:hover::before { opacity: 1; }
.roleBtn:active { transform: scale(0.96); }
.roleBtn.buyer {
background: linear-gradient(135deg, rgba(0,122,255,0.3), rgba(88,86,214,0.25));
backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid rgba(0,122,255,0.4);
box-shadow: 0 8px 32px rgba(0,122,255,0.2), var(‚Äìshadow);
}
.roleBtn.employee {
background: linear-gradient(135deg, rgba(52,199,89,0.25), rgba(0,199,190,0.2));
backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid rgba(52,199,89,0.35);
box-shadow: 0 8px 32px rgba(52,199,89,0.15), var(‚Äìshadow);
}
.roleIcon { font-size: 40px; }
.roleText-title { font-size: 19px; font-weight: 700; color: var(‚Äìtext); margin-bottom: 3px; }
.roleText-sub { font-size: 12px; color: var(‚Äìtext2); }

/* PROFILE SECTION IN ROLE SCREEN */
.profileSection {
width: 100%; max-width: 360px; margin-bottom: 28px;
}
.profileToggle {
display: flex; gap: 0; background: rgba(255,255,255,0.06); border-radius: 12px;
border: 1px solid var(‚Äìglass-border); padding: 4px; margin-bottom: 16px;
}
.profileTab {
flex: 1; padding: 8px; border-radius: 9px; font-size: 13px; font-weight: 700;
color: var(‚Äìtext2); cursor: pointer; text-align: center; transition: all 0.25s;
}
.profileTab.active {
background: rgba(0,122,255,0.4); color: var(‚Äìtext);
box-shadow: 0 2px 8px rgba(0,122,255,0.3);
}
.profileCard {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-radius: var(‚Äìr2);
padding: 20px; display: flex; gap: 16px; align-items: center;
}
.profileAvatar {
width: 56px; height: 56px; border-radius: 50%;
background: linear-gradient(135deg, rgba(0,122,255,0.6), rgba(88,86,214,0.6));
display: flex; align-items: center; justify-content: center; font-size: 28px;
border: 2px solid rgba(255,255,255,0.3);
flex-shrink: 0;
}
.profileInfo .name { font-size: 17px; font-weight: 700; margin-bottom: 3px; }
.profileInfo .detail { font-size: 12px; color: var(‚Äìtext2); }
.profileBadge {
margin-left: auto; padding: 5px 12px; border-radius: 20px; font-size: 11px; font-weight: 700;
background: rgba(0,122,255,0.3); border: 1px solid rgba(0,122,255,0.5); color: rgba(0,122,255,1);
}
.profileBadge.emp { background: rgba(52,199,89,0.25); border-color: rgba(52,199,89,0.4); color: rgba(52,199,89,1); }

/* ===== MAIN APP ===== */
#app { display: none; min-height: 100dvh; flex-direction: column; position: relative; z-index: 1; }
#app.visible { display: flex; }

/* HEADER */
.header {
position: sticky; top: 0; z-index: 100;
padding: 14px 20px 14px;
background: rgba(10,10,26,0.6);
backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border-bottom: 1px solid var(‚Äìglass-border);
display: flex; align-items: center; justify-content: space-between;
}
.header-left { display: flex; align-items: center; gap: 12px; }
.header-logo { font-size: 26px; }
.header-title { font-size: 19px; font-weight: 800; letter-spacing: -0.5px; }
.header-badge {
padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: 700;
letter-spacing: 0.3px;
}
.header-badge.buyer { background: rgba(0,122,255,0.25); border: 1px solid rgba(0,122,255,0.4); color: #007AFF; }
.header-badge.emp { background: rgba(52,199,89,0.2); border: 1px solid rgba(52,199,89,0.35); color: #34C759; }
.switchBtn {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur-light); -webkit-backdrop-filter: var(‚Äìblur-light);
border: 1px solid var(‚Äìglass-border); color: var(‚Äìtext2); padding: 6px 14px;
border-radius: 12px; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.2s;
}
.switchBtn:active { transform: scale(0.95); }

/* TABS */
.tabs {
display: flex; overflow-x: auto; padding: 0 12px;
background: rgba(10,10,26,0.4);
backdrop-filter: var(‚Äìblur-light);
-webkit-backdrop-filter: var(‚Äìblur-light);
border-bottom: 1px solid var(‚Äìglass-border);
gap: 4px;
}
.tabs::-webkit-scrollbar { display: none; }
.tab {
flex: 1; min-width: 70px; padding: 10px 8px 12px;
text-align: center; font-size: 10px; font-weight: 700;
color: var(‚Äìtext2); cursor: pointer; white-space: nowrap;
position: relative; transition: all 0.25s;
letter-spacing: 0.3px; text-transform: uppercase;
}
.tab::after {
content: ‚Äò‚Äô; position: absolute; bottom: 0; left: 20%; right: 20%; height: 2px;
border-radius: 2px 2px 0 0; background: transparent; transition: all 0.3s;
}
.tab.active { color: var(‚Äìtext); }
.tab.active::after { background: var(‚Äìaccent); }
.tab .tabIcon { font-size: 20px; display: block; margin-bottom: 3px; }
.badge {
display: inline-flex; align-items: center; justify-content: center;
background: var(‚Äìaccent5); color: white; font-size: 9px; font-weight: 800;
min-width: 16px; height: 16px; border-radius: 8px; padding: 0 4px;
margin-left: 3px; vertical-align: middle;
}

/* CONTENT */
.content { flex: 1; overflow-y: auto; padding: 20px 16px 100px; }
.page { display: none; }
.page.active { display: block; animation: pageIn 0.25s ease; }
@keyframes pageIn { from { opacity: 0; transform: translateY(8px); } to { opacity: 1; transform: translateY(0); } }

.sectionTitle {
font-size: 12px; font-weight: 800; color: var(‚Äìtext3); letter-spacing: 0.8px;
text-transform: uppercase; margin-bottom: 12px; padding-left: 4px;
}

/* PRODUCTS GRID */
.productsGrid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
@media (min-width: 600px) { .productsGrid { grid-template-columns: 1fr 1fr 1fr; } }
@media (min-width: 900px) { .productsGrid { grid-template-columns: 1fr 1fr 1fr 1fr; } }

.productCard {
border-radius: var(‚Äìr2); overflow: hidden;
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border);
box-shadow: var(‚Äìshadow); transition: all 0.3s;
display: flex; flex-direction: column;
}
.productCard:hover { transform: translateY(-2px); box-shadow: var(‚Äìshadow2); }
.cardImg {
background: rgba(255,255,255,0.05); height: 90px;
display: flex; align-items: center; justify-content: center;
font-size: 44px; border-bottom: 1px solid var(‚Äìglass-border);
}
.cardBody { padding: 12px; flex: 1; display: flex; flex-direction: column; gap: 4px; }
.cardName { font-size: 13px; font-weight: 700; line-height: 1.3; }
.cardDesc { font-size: 11px; color: var(‚Äìtext2); line-height: 1.4; flex: 1; }
.cardPrice { font-size: 15px; font-weight: 800; color: var(‚Äìaccent3); margin-top: 4px; }
.cardActions { display: flex; gap: 6px; padding: 10px 12px; border-top: 1px solid var(‚Äìglass-border); }

/* BUTTONS */
.btn-sm {
padding: 7px 10px; border-radius: 10px; font-size: 11px; font-weight: 700;
border: none; cursor: pointer; flex: 1; transition: all 0.2s; font-family: inherit;
}
.btn-sm:active { transform: scale(0.94); }
.btn-primary { background: var(‚Äìaccent); color: white; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
.btn-secondary { background: rgba(255,255,255,0.1); color: var(‚Äìtext); border: 1px solid var(‚Äìglass-border); }
.btn-danger { background: var(‚Äìaccent5); color: white; box-shadow: 0 4px 12px rgba(255,59,48,0.3); }
.btn-green { background: var(‚Äìaccent4); color: white; box-shadow: 0 4px 12px rgba(52,199,89,0.3); }
.btn-blue { background: var(‚Äìaccent); color: white; box-shadow: 0 4px 12px rgba(0,122,255,0.3); }
.btn-full {
width: 100%; padding: 15px; border-radius: var(‚Äìr); font-size: 15px; font-weight: 700;
border: none; cursor: pointer; transition: all 0.2s; font-family: inherit;
}
.btn-full:active { transform: scale(0.97); }
.btn-full.btn-primary { background: linear-gradient(135deg, #007AFF, #5856D6); color: white; box-shadow: 0 8px 24px rgba(0,122,255,0.35); }
.btn-full.btn-danger { background: linear-gradient(135deg, #FF3B30, #FF6B6B); color: white; }
.btn-full.btn-secondary { background: rgba(255,255,255,0.08); color: var(‚Äìtext2); border: 1px solid var(‚Äìglass-border); }
.btn-full.btn-green { background: linear-gradient(135deg, #34C759, #00C897); color: white; }
.btn-full.btn-blue { background: linear-gradient(135deg, #007AFF, #0099FF); color: white; }

/* FAB */
.fab {
position: fixed; bottom: calc(90px + env(safe-area-inset-bottom, 0px)); right: 20px;
width: 58px; height: 58px; border-radius: 50%;
background: linear-gradient(135deg, #007AFF, #5856D6);
border: none; color: white; font-size: 28px; cursor: pointer;
box-shadow: 0 8px 24px rgba(0,122,255,0.5), 0 2px 8px rgba(0,0,0,0.3);
display: flex; align-items: center; justify-content: center; z-index: 200;
transition: all 0.3s cubic-bezier(0.34,1.56,0.64,1);
}
.fab:active { transform: scale(0.88); }

/* MODAL */
.overlay {
display: none; position: fixed; inset: 0; z-index: 400;
background: rgba(0,0,0,0.65);
backdrop-filter: blur(8px);
-webkit-backdrop-filter: blur(8px);
align-items: flex-end; justify-content: center;
}
.overlay.open { display: flex; animation: overlayIn 0.25s ease; }
@keyframes overlayIn { from { opacity: 0; } to { opacity: 1; } }
.modal {
background: rgba(20,20,40,0.85);
backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-bottom: none;
border-radius: 28px 28px 0 0; width: 100%; max-width: 520px;
padding: 8px 24px 32px; max-height: 92dvh; overflow-y: auto;
box-shadow: 0 -20px 60px rgba(0,0,0,0.5);
animation: modalIn 0.35s cubic-bezier(0.34,1.2,0.64,1);
}
@keyframes modalIn { from { transform: translateY(100%); } to { transform: translateY(0); } }
.modal-handle {
width: 40px; height: 4px; border-radius: 2px;
background: rgba(255,255,255,0.2); margin: 12px auto 20px;
}
.modal-title { font-size: 20px; font-weight: 800; margin-bottom: 20px; }

/* FORM */
.formGroup { margin-bottom: 16px; }
.formGroup label { font-size: 12px; color: var(‚Äìtext2); font-weight: 700; text-transform: uppercase; letter-spacing: 0.5px; display: block; margin-bottom: 8px; }
.formGroup input, .formGroup textarea {
width: 100%; background: rgba(255,255,255,0.08);
backdrop-filter: var(‚Äìblur-light); -webkit-backdrop-filter: var(‚Äìblur-light);
border: 1px solid var(‚Äìglass-border); border-radius: 14px;
color: var(‚Äìtext); padding: 13px 16px; font-size: 15px; font-family: inherit;
outline: none; resize: vertical; transition: all 0.2s;
}
.formGroup input:focus, .formGroup textarea:focus { border-color: rgba(0,122,255,0.6); background: rgba(0,122,255,0.1); }
.formGroup textarea { min-height: 80px; }
input::placeholder, textarea::placeholder { color: var(‚Äìtext3); }

/* EMOJI GRID */
.emojiGrid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin-bottom: 12px; }
.emojiOption {
font-size: 26px; text-align: center; padding: 6px; border-radius: 10px;
cursor: pointer; border: 2px solid transparent; transition: all 0.15s;
}
.emojiOption.selected { border-color: var(‚Äìaccent); background: rgba(0,122,255,0.2); }

/* CART */
.cartItem {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur);
-webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border);
border-radius: var(‚Äìr2); padding: 14px 16px;
display: flex; align-items: center; gap: 14px; margin-bottom: 10px;
transition: all 0.2s;
}
.cartItemEmoji { font-size: 34px; }
.cartItemInfo { flex: 1; }
.cartItemName { font-size: 14px; font-weight: 700; }
.cartItemPrice { font-size: 12px; color: var(‚Äìtext2); margin-top: 2px; }
.qtyControl { display: flex; align-items: center; gap: 10px; margin-top: 8px; }
.qtyBtn {
width: 30px; height: 30px; border-radius: 50%;
background: rgba(255,255,255,0.1); border: 1px solid var(‚Äìglass-border);
color: var(‚Äìtext); font-size: 18px; cursor: pointer;
display: flex; align-items: center; justify-content: center; transition: all 0.15s;
}
.qtyBtn:active { transform: scale(0.88); background: rgba(0,122,255,0.3); }
.qtyNum { font-size: 16px; font-weight: 800; min-width: 24px; text-align: center; }
.cartItemTotal { font-weight: 800; color: var(‚Äìaccent3); }

.cartSummary {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-radius: var(‚Äìr2); padding: 18px; margin-top: 16px;
}
.cartRow { display: flex; justify-content: space-between; align-items: center; padding: 6px 0; font-size: 14px; }
.cartRow .label { color: var(‚Äìtext2); }
.cartTotal { font-size: 22px; font-weight: 800; color: var(‚Äìaccent3); }

.paymentOptions { display: flex; gap: 10px; margin-top: 14px; }
.payOpt {
flex: 1; padding: 14px 10px; border-radius: 16px;
border: 2px solid var(‚Äìglass-border); background: rgba(255,255,255,0.05);
text-align: center; font-size: 11px; font-weight: 700; cursor: pointer; transition: all 0.25s;
color: var(‚Äìtext2);
}
.payOpt.selected { border-color: var(‚Äìaccent); background: rgba(0,122,255,0.2); color: var(‚Äìtext); }
.payOpt .payIcon { font-size: 24px; display: block; margin-bottom: 6px; }

/* ORDERS */
.orderCard {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-radius: var(‚Äìr2); padding: 18px; margin-bottom: 12px;
transition: all 0.2s;
}
.orderHeader { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; }
.orderNum { font-size: 15px; font-weight: 800; }
.orderStatus { font-size: 11px; padding: 4px 10px; border-radius: 20px; font-weight: 700; }
.status-pending { background: rgba(255,149,0,0.2); color: var(‚Äìaccent3); border: 1px solid rgba(255,149,0,0.3); }
.status-ready { background: rgba(52,199,89,0.2); color: var(‚Äìaccent4); border: 1px solid rgba(52,199,89,0.3); }
.orderMeta { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 12px; }
.orderMetaBadge {
font-size: 12px; color: var(‚Äìtext2); background: rgba(255,255,255,0.06);
border: 1px solid var(‚Äìglass-border); border-radius: 8px; padding: 4px 10px;
}
.orderPrice { font-size: 20px; font-weight: 800; color: var(‚Äìaccent3); margin-bottom: 14px; }

/* QR MODAL */
.qrModal { text-align: center; }
#qrContainer {
display: inline-block; padding: 16px; background: white; border-radius: 16px;
margin: 16px auto; box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}
.qrOrderInfo { color: var(‚Äìtext2); font-size: 13px; margin-bottom: 20px; }

/* SCANNER */
.scannerWrap {
position: relative; border-radius: var(‚Äìr2); overflow: hidden;
background: #000; border: 1px solid var(‚Äìglass-border);
box-shadow: var(‚Äìshadow);
}
#scanVideo { width: 100%; display: block; max-height: 60dvh; object-fit: cover; }
.scanOverlay { position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; }
.scanFrame {
width: 200px; height: 200px; position: relative;
border-radius: 20px;
}
.scanFrame::before, .scanFrame::after,
.scanFrame-inner::before, .scanFrame-inner::after {
content: ‚Äò‚Äô; position: absolute; width: 32px; height: 32px; border-color: var(‚Äìaccent); border-style: solid;
}
.scanFrame::before { top: 0; left: 0; border-width: 3px 0 0 3px; border-radius: 8px 0 0 0; }
.scanFrame::after { top: 0; right: 0; border-width: 3px 3px 0 0; border-radius: 0 8px 0 0; }
.scanFrame-inner::before { bottom: 0; left: 0; border-width: 0 0 3px 3px; border-radius: 0 0 0 8px; }
.scanFrame-inner::after { bottom: 0; right: 0; border-width: 0 3px 3px 0; border-radius: 0 0 8px 0; }
.scanLine {
position: absolute; left: 8px; right: 8px; height: 2px;
background: linear-gradient(90deg, transparent, var(‚Äìaccent), transparent);
border-radius: 1px; box-shadow: 0 0 8px var(‚Äìaccent);
animation: scanMove 2s ease-in-out infinite;
}
@keyframes scanMove { 0% { top: 12px; } 50% { top: calc(100% - 12px); } 100% { top: 12px; } }
.scanBg { position: absolute; inset: 0; background: rgba(0,0,0,0.5); border-radius: 20px; mix-blend-mode: multiply; }
.scanHint { text-align: center; color: var(‚Äìtext2); font-size: 13px; margin-top: 14px; }

/* EMPLOYEE ORDER CARD */
.empOrderCard {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-radius: var(‚Äìr2); padding: 18px; margin-bottom: 14px;
}
.infoBadge {
background: rgba(255,255,255,0.07); border: 1px solid var(‚Äìglass-border);
border-radius: 8px; padding: 5px 12px; font-size: 12px; font-weight: 600;
}
.itemsToScan { display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
.scanItemRow {
display: flex; align-items: center; gap: 12px;
background: rgba(255,255,255,0.06); border-radius: 14px; padding: 12px;
border: 1px solid var(‚Äìglass-border); transition: all 0.3s;
}
.scanItemRow.scanned { opacity: 0.45; background: rgba(52,199,89,0.08); border-color: rgba(52,199,89,0.2); }
.scanItemRow.returned { opacity: 0.45; background: rgba(255,59,48,0.08); border-color: rgba(255,59,48,0.2); }
.scanItemEmoji { font-size: 26px; }
.scanItemInfo { flex: 1; }
.scanItemName { font-size: 13px; font-weight: 700; }
.scanItemPrice { color: var(‚Äìtext2); font-size: 11px; margin-top: 2px; }
.checkMark { font-size: 22px; }

/* RETURN SELECTOR */
.returnItem {
display: flex; align-items: center; gap: 12px; padding: 12px;
background: rgba(255,255,255,0.06); border-radius: 14px; margin-bottom: 8px;
border: 2px solid transparent; cursor: pointer; transition: all 0.2s;
}
.returnItem.selected { border-color: var(‚Äìaccent5); background: rgba(255,59,48,0.1); }
.returnCheckbox {
width: 24px; height: 24px; border-radius: 7px; border: 2px solid var(‚Äìglass-border);
background: rgba(255,255,255,0.08); display: flex; align-items: center; justify-content: center;
font-size: 14px; transition: all 0.2s;
}
.returnItem.selected .returnCheckbox { background: var(‚Äìaccent5); border-color: var(‚Äìaccent5); }

/* TOAST */
.toast {
position: fixed; top: 80px; left: 50%; transform: translateX(-50%) translateY(-10px);
background: rgba(20,20,40,0.9); backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-radius: 14px;
padding: 12px 22px; font-size: 14px; font-weight: 700; z-index: 999;
opacity: 0; transition: all 0.3s cubic-bezier(0.34,1.2,0.64,1);
pointer-events: none; white-space: nowrap;
box-shadow: 0 8px 32px rgba(0,0,0,0.4);
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* EMPTY */
.empty { text-align: center; padding: 70px 20px; color: var(‚Äìtext2); }
.empty .emptyIcon { font-size: 60px; margin-bottom: 16px; opacity: 0.6; }
.empty p { font-size: 15px; line-height: 1.6; }

/* PROFILE PAGE */
.profilePageCard {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-radius: var(‚Äìr2); padding: 24px; margin-bottom: 16px;
}
.profileHero { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 20px 0; }
.profileHeroAvatar {
width: 90px; height: 90px; border-radius: 50%; font-size: 48px;
display: flex; align-items: center; justify-content: center; margin-bottom: 16px;
background: linear-gradient(135deg, rgba(0,122,255,0.5), rgba(88,86,214,0.5));
border: 3px solid rgba(255,255,255,0.3); box-shadow: 0 8px 32px rgba(0,122,255,0.3);
}
.profileHeroAvatar.emp { background: linear-gradient(135deg, rgba(52,199,89,0.4), rgba(0,199,190,0.4)); }
.profileHeroName { font-size: 24px; font-weight: 800; margin-bottom: 4px; }
.profileHeroRole { font-size: 13px; color: var(‚Äìtext2); }
.profileStats { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; margin: 20px 0; }
.statBox {
background: rgba(255,255,255,0.06); border: 1px solid var(‚Äìglass-border); border-radius: 14px;
padding: 14px 10px; text-align: center;
}
.statNum { font-size: 22px; font-weight: 800; color: var(‚Äìaccent3); }
.statLabel { font-size: 10px; color: var(‚Äìtext2); margin-top: 3px; text-transform: uppercase; font-weight: 700; letter-spacing: 0.3px; }

/* SCANNER PAGE DESIGN */
.scannerCard {
background: var(‚Äìglass); backdrop-filter: var(‚Äìblur); -webkit-backdrop-filter: var(‚Äìblur);
border: 1px solid var(‚Äìglass-border); border-radius: var(‚Äìr2); padding: 24px; text-align: center;
margin-bottom: 16px;
}
.scannerIcon { font-size: 64px; margin-bottom: 16px; }
.scannerTitle { font-size: 20px; font-weight: 800; margin-bottom: 8px; }
.scannerSub { font-size: 14px; color: var(‚Äìtext2); margin-bottom: 24px; line-height: 1.5; }

/* PROGRESS BAR */
.progressWrap { background: rgba(255,255,255,0.1); border-radius: 10px; height: 6px; overflow: hidden; margin-top: 12px; }
.progressBar { height: 100%; border-radius: 10px; background: linear-gradient(90deg, #007AFF, #5856D6); transition: width 0.5s ease; }

/* DIVIDER */
.divider { height: 1px; background: var(‚Äìglass-border); margin: 20px 0; }

/* COMPLETE ORDER ANIMATION */
@keyframes successPop { 0% { transform: scale(0.5); opacity: 0; } 70% { transform: scale(1.15); } 100% { transform: scale(1); opacity: 1; } }
.successAnim { animation: successPop 0.5s cubic-bezier(0.34,1.56,0.64,1) both; }

/* PC LAYOUT */
@media (min-width: 768px) {
.modal { border-radius: 28px; margin-bottom: 40px; }
.content { max-width: 900px; margin: 0 auto; }
.overlay { align-items: center; }
.productsGrid { grid-template-columns: 1fr 1fr 1fr; }
}
</style>

</head>
<body>

<div class="bg-scene">
  <div class="bg-orb orb1"></div>
  <div class="bg-orb orb2"></div>
  <div class="bg-orb orb3"></div>
</div>

<!-- ROLE SCREEN -->

<div id="roleScreen">
  <div class="role-logo">üì¶</div>
  <div class="role-title">–ü–í–ó Pro</div>
  <div class="role-subtitle">–°–∏–º—É–ª—è—Ç–æ—Ä –ø—É–Ω–∫—Ç–∞ –≤—ã–¥–∞—á–∏ –∑–∞–∫–∞–∑–æ–≤<br>–í—ã–±–µ—Ä–∏—Ç–µ –ø—Ä–æ—Ñ–∏–ª—å</div>

  <div class="profileSection">
    <div class="profileToggle" id="profileToggle">
      <div class="profileTab active" onclick="switchProfileView('buyer')">üõçÔ∏è –ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
      <div class="profileTab" onclick="switchProfileView('employee')">üë∑ –°–æ—Ç—Ä—É–¥–Ω–∏–∫</div>
    </div>
    <div class="profileCard" id="profileCardPreview">
      <div class="profileAvatar" id="previewAvatar">üõçÔ∏è</div>
      <div class="profileInfo">
        <div class="name" id="previewName">–ì–æ—Å—Ç—å</div>
        <div class="detail" id="previewDetail">–†–µ–∂–∏–º –ø–æ–∫—É–ø–∞—Ç–µ–ª—è</div>
      </div>
      <div class="profileBadge" id="previewBadge">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
    </div>
  </div>

  <div class="role-cards">
    <button class="roleBtn buyer" onclick="setRole('buyer')">
      <span class="roleIcon">üõçÔ∏è</span>
      <div>
        <div class="roleText-title">–í–æ–π—Ç–∏ –∫–∞–∫ –ø–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
        <div class="roleText-sub">–°–æ–∑–¥–∞–≤–∞–π—Ç–µ —Ç–æ–≤–∞—Ä—ã, –∑–∞–∫–∞–∑—ã–≤–∞–π—Ç–µ, –ø–æ–ª—É—á–∞–π—Ç–µ QR</div>
      </div>
    </button>
    <button class="roleBtn employee" onclick="setRole('employee')">
      <span class="roleIcon">üë∑</span>
      <div>
        <div class="roleText-title">–í–æ–π—Ç–∏ –∫–∞–∫ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫</div>
        <div class="roleText-sub">–°–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥—ã, –≤—ã–¥–∞–≤–∞–π—Ç–µ –∑–∞–∫–∞–∑—ã</div>
      </div>
    </button>
  </div>
</div>

<!-- MAIN APP -->

<div id="app">
  <div class="header">
    <div class="header-left">
      <div class="header-logo">üì¶</div>
      <div class="header-title">–ü–í–ó Pro</div>
      <div class="header-badge" id="headerBadge">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</div>
    </div>
    <button class="switchBtn" onclick="switchRole()">‚Üê –í—ã–π—Ç–∏</button>
  </div>
  <div class="tabs" id="tabBar"></div>
  <div class="content" id="contentArea"></div>
</div>

<!-- TOAST -->

<div class="toast" id="toast"></div>

<!-- MODAL: Add/Edit Product -->

<div class="overlay" id="productModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="productModalTitle">‚ú® –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä</div>
    <div class="formGroup">
      <label>–ò–∫–æ–Ω–∫–∞ —Ç–æ–≤–∞—Ä–∞</label>
      <div class="emojiGrid" id="emojiGrid"></div>
    </div>
    <div class="formGroup">
      <label>–ù–∞–∑–≤–∞–Ω–∏–µ</label>
      <input type="text" id="pName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ù–∞—É—à–Ω–∏–∫–∏ Sony">
    </div>
    <div class="formGroup">
      <label>–¶–µ–Ω–∞ (–æ—Ç 100 ‚ÇΩ)</label>
      <input type="number" id="pPrice" placeholder="1500" min="100">
    </div>
    <div class="formGroup">
      <label>–û–ø–∏—Å–∞–Ω–∏–µ</label>
      <textarea id="pDesc" placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞..."></textarea>
    </div>
    <button class="btn-full btn-primary" onclick="saveProduct()" style="margin-top:8px;">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–≤–∞—Ä</button>
    <button class="btn-full btn-secondary" onclick="closeModal('productModal')" style="margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<!-- MODAL: Cart Checkout -->

<div class="overlay" id="checkoutModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">üßæ –û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</div>
    <div id="checkoutItems"></div>
    <div id="checkoutSummary"></div>
    <button class="btn-full btn-primary" onclick="placeOrder()" style="margin-top:20px;">‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–∫–∞–∑</button>
    <button class="btn-full btn-secondary" onclick="closeModal('checkoutModal')" style="margin-top:10px;">–ù–∞–∑–∞–¥</button>
  </div>
</div>

<!-- MODAL: QR Code -->

<div class="overlay" id="qrModal">
  <div class="modal qrModal">
    <div class="modal-handle"></div>
    <div class="modal-title" id="qrModalTitle">üî≤ QR-–∫–æ–¥ –∑–∞–∫–∞–∑–∞</div>
    <div id="qrContainer"></div>
    <div class="qrOrderInfo" id="qrOrderInfo"></div>
    <div style="color:var(--text2);font-size:12px;margin-bottom:20px;">–ü–æ–∫–∞–∂–∏—Ç–µ —ç—Ç–æ—Ç QR-–∫–æ–¥ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫—É –ü–í–ó</div>
    <button class="btn-full btn-secondary" onclick="closeModal('qrModal')">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- MODAL: Scanner -->

<div class="overlay" id="scanModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">üì∑ –°–∫–∞–Ω–µ—Ä QR-–∫–æ–¥–∞</div>
    <div class="scannerWrap">
      <video id="scanVideo" autoplay playsinline muted></video>
      <div class="scanOverlay">
        <div class="scanFrame">
          <div class="scanFrame-inner"></div>
          <div class="scanLine"></div>
        </div>
      </div>
    </div>
    <div class="scanHint">–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ QR-–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</div>
    <button class="btn-full btn-secondary" onclick="stopScanner()" style="margin-top:16px;">‚úï –ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- MODAL: Return -->

<div class="overlay" id="returnModal">
  <div class="modal">
    <div class="modal-handle"></div>
    <div class="modal-title">‚Ü©Ô∏è –û—Ñ–æ—Ä–º–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</div>
    <div style="color:var(--text2);font-size:13px;margin-bottom:16px;">–í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞</div>
    <div id="returnItems"></div>
    <button class="btn-full btn-danger" onclick="confirmReturn()" style="margin-top:20px;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤–æ–∑–≤—Ä–∞—Ç</button>
    <button class="btn-full btn-secondary" onclick="closeModal('returnModal')" style="margin-top:10px;">–û—Ç–º–µ–Ω–∞</button>
  </div>
</div>

<script>
// ====== AUDIO ENGINE ======
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx = null;

function getCtx() {
  if (!audioCtx) audioCtx = new AudioCtx();
  return audioCtx;
}

function playTone(freq, type = 'sine', duration = 0.12, volume = 0.15, delay = 0) {
  try {
    const ctx = getCtx();
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.type = type;
    osc.frequency.setValueAtTime(freq, ctx.currentTime + delay);
    osc.frequency.exponentialRampToValueAtTime(freq * 0.9, ctx.currentTime + delay + duration);
    gain.gain.setValueAtTime(0, ctx.currentTime + delay);
    gain.gain.linearRampToValueAtTime(volume, ctx.currentTime + delay + 0.01);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + delay + duration);
    osc.start(ctx.currentTime + delay);
    osc.stop(ctx.currentTime + delay + duration);
  } catch(e) {}
}

const SFX = {
  tap() { playTone(440, 'sine', 0.08, 0.1); },
  add() { playTone(523, 'sine', 0.1, 0.12); playTone(659, 'sine', 0.1, 0.1, 0.08); },
  success() {
    playTone(523, 'sine', 0.12, 0.12, 0);
    playTone(659, 'sine', 0.12, 0.12, 0.1);
    playTone(784, 'sine', 0.18, 0.15, 0.2);
  },
  error() { playTone(200, 'sawtooth', 0.15, 0.12); },
  scan() {
    playTone(880, 'sine', 0.08, 0.15, 0);
    playTone(1047, 'sine', 0.12, 0.15, 0.07);
  },
  remove() { playTone(330, 'sine', 0.1, 0.1); },
  checkout() {
    [523,659,784,1047].forEach((f,i) => playTone(f, 'sine', 0.12, 0.12, i*0.07));
  },
  complete() {
    [523,784,659,1047,880].forEach((f,i) => playTone(f, 'triangle', 0.15, 0.13, i*0.06));
  }
};

// ====== STATE ======
let role = 'buyer';
let products = [
  { id: 1, name: '–ù–∞—É—à–Ω–∏–∫–∏ Sony', price: 3990, desc: '–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏ —Å —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º', emoji: 'üéß' },
  { id: 2, name: '–ß–µ—Ö–æ–ª iPhone', price: 490, desc: '–°–∏–ª–∏–∫–æ–Ω–æ–≤—ã–π –∑–∞—â–∏—Ç–Ω—ã–π —á–µ—Ö–æ–ª', emoji: 'üì±' },
  { id: 3, name: '–ó–∞—Ä—è–¥–∫–∞ 65W', price: 890, desc: '–ë—ã—Å—Ç—Ä–∞—è –∑–∞—Ä—è–¥–∫–∞ USB-C', emoji: 'üîå' },
];
let cart = [];
let orders = [];
let employeeOrders = [];
let editProductId = null;
let selectedEmoji = 'üì¶';
let selectedPayment = 'delivery';
let currentReturnOrderId = null;
let scannerStream = null;
let scanInterval = null;
let returnSelected = new Set();
let productIdCounter = 10;
let orderIdCounter = 100;

const EMOJIS = ['üì¶','üéß','üì±','üëü','üëú','üéÆ','üíª','‚åö','üîå','üì∑','üéÅ','üß¥','üëó','üïπÔ∏è','üìö','üçï','üß∏','üí°','üñ•Ô∏è','üéµ','üéí','üõçÔ∏è','üñ±Ô∏è','üé∏','üèãÔ∏è'];

const buyerProfile = { name: '–ê–Ω–Ω–∞ –ö.', avatar: 'üõçÔ∏è', detail: 'VIP –∫–ª–∏–µ–Ω—Ç ¬∑ –ê–∫—Ç–∏–≤–Ω—ã–π –ø–æ–∫—É–ø–∞—Ç–µ–ª—å' };
const empProfile = { name: '–î–º–∏—Ç—Ä–∏–π –í.', avatar: 'üë∑', detail: '–°—Ç–∞—Ä—à–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä –ü–í–ó' };

// ====== HELPERS ======
function uid() { return ++productIdCounter; }
function oid() { return ++orderIdCounter; }
function formatPrice(p) { return p.toLocaleString('ru-RU') + ' ‚ÇΩ'; }
function cartCount() { return cart.reduce((s,i) => s + i.qty, 0); }
function cartTotal() { return cart.reduce((s,i) => s + i.product.price * i.qty, 0); }

let toastTimer = null;
function showToast(msg, duration = 2500) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  clearTimeout(toastTimer);
  toastTimer = setTimeout(() => t.classList.remove('show'), duration);
}

function openModal(id) {
  SFX.tap();
  document.getElementById(id).classList.add('open');
}
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}

// ====== PROFILE VIEW SWITCH ======
let previewRole = 'buyer';
function switchProfileView(r) {
  previewRole = r;
  const tabs = document.querySelectorAll('.profileTab');
  tabs.forEach((t, i) => t.classList.toggle('active', (i === 0 && r === 'buyer') || (i === 1 && r === 'employee')));
  const p = r === 'buyer' ? buyerProfile : empProfile;
  document.getElementById('previewAvatar').textContent = p.avatar;
  document.getElementById('previewName').textContent = p.name;
  document.getElementById('previewDetail').textContent = p.detail;
  const badge = document.getElementById('previewBadge');
  badge.textContent = r === 'buyer' ? '–ü–æ–∫—É–ø–∞—Ç–µ–ª—å' : '–°–æ—Ç—Ä—É–¥–Ω–∏–∫';
  badge.className = r === 'buyer' ? 'profileBadge' : 'profileBadge emp';
  SFX.tap();
}

// ====== ROLE ======
function setRole(r) {
  SFX.success();
  role = r;
  document.getElementById('roleScreen').style.display = 'none';
  const app = document.getElementById('app');
  app.classList.add('visible');

  const badge = document.getElementById('headerBadge');
  if (r === 'buyer') {
    badge.textContent = 'üõçÔ∏è –ü–æ–∫—É–ø–∞—Ç–µ–ª—å';
    badge.className = 'header-badge buyer';
  } else {
    badge.textContent = 'üë∑ –°–æ—Ç—Ä—É–¥–Ω–∏–∫';
    badge.className = 'header-badge emp';
  }
  currentPage = r === 'buyer' ? 'shop' : 'scanner';
  renderTabs();
  renderPage(currentPage);
}

function switchRole() {
  SFX.tap();
  if (scannerStream) stopScanner();
  document.getElementById('roleScreen').style.display = 'flex';
  document.getElementById('app').classList.remove('visible');
}

// ====== TABS ======
const buyerTabs = [
  { id: 'shop', icon: 'üè™', label: '–ú–∞–≥–∞–∑–∏–Ω' },
  { id: 'cart', icon: 'üõí', label: '–ö–æ—Ä–∑–∏–Ω–∞', badge: 'cart' },
  { id: 'orders', icon: 'üìã', label: '–ó–∞–∫–∞–∑—ã' },
  { id: 'profilePage', icon: 'üë§', label: '–ü—Ä–æ—Ñ–∏–ª—å' },
];
const employeeTabs = [
  { id: 'scanner', icon: 'üì∑', label: '–°–∫–∞–Ω–µ—Ä' },
  { id: 'empOrders', icon: 'üìã', label: '–ó–∞–∫–∞–∑—ã', badge: 'emp' },
  { id: 'profilePage', icon: 'üë§', label: '–ü—Ä–æ—Ñ–∏–ª—å' },
];

let currentPage = 'shop';

function renderTabs() {
  const bar = document.getElementById('tabBar');
  const tabs = role === 'buyer' ? buyerTabs : employeeTabs;
  bar.innerHTML = tabs.map(t => {
    let badgeHTML = '';
    if (t.badge === 'cart' && cartCount() > 0) badgeHTML = `<span class="badge">${cartCount()}</span>`;
    if (t.badge === 'emp') {
      const n = employeeOrders.filter(o => o.status !== 'done').length;
      if (n > 0) badgeHTML = `<span class="badge">${n}</span>`;
    }
    return `<div class="tab ${currentPage === t.id ? 'active' : ''}" onclick="navTo('${t.id}')">
      <span class="tabIcon">${t.icon}</span>${t.label}${badgeHTML}
    </div>`;
  }).join('');
}

function navTo(id) {
  SFX.tap();
  renderPage(id);
}

// ====== PAGES ======
function renderPage(pageId) {
  currentPage = pageId;
  renderTabs();
  const area = document.getElementById('contentArea');
  if (pageId === 'shop') area.innerHTML = renderShop();
  else if (pageId === 'cart') area.innerHTML = renderCart();
  else if (pageId === 'orders') area.innerHTML = renderOrders();
  else if (pageId === 'scanner') area.innerHTML = renderScannerPage();
  else if (pageId === 'empOrders') area.innerHTML = renderEmpOrders();
  else if (pageId === 'profilePage') area.innerHTML = renderProfile();

  // FAB
  let fab = document.getElementById('fabBtn');
  if (fab) fab.remove();
  if (pageId === 'shop') {
    const f = document.createElement('button');
    f.className = 'fab'; f.id = 'fabBtn'; f.innerHTML = '+';
    f.onclick = () => { SFX.tap(); openProductModal(null); };
    document.body.appendChild(f);
  }
}

// ====== SHOP ======
function renderShop() {
  if (!products.length) return `<div class="empty"><div class="emptyIcon">üè™</div><p>–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤.<br>–ù–∞–∂–º–∏—Ç–µ + —á—Ç–æ–±—ã –¥–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π</p></div>`;
  return `<div class="sectionTitle">–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã ¬∑ ${products.length}</div>
  <div class="productsGrid">${products.map(p => productCardHTML(p)).join('')}</div>`;
}

function productCardHTML(p) {
  return `<div class="productCard">
    <div class="cardImg">${p.emoji}</div>
    <div class="cardBody">
      <div class="cardName">${p.name}</div>
      <div class="cardDesc">${p.desc}</div>
      <div class="cardPrice">${formatPrice(p.price)}</div>
    </div>
    <div class="cardActions">
      <button class="btn-sm btn-secondary" onclick="openProductModal(${p.id})">‚úèÔ∏è</button>
      <button class="btn-sm btn-danger" onclick="deleteProduct(${p.id})">üóëÔ∏è</button>
      <button class="btn-sm btn-primary" onclick="addToCart(${p.id})">+ –í –∫–æ—Ä–∑–∏–Ω—É</button>
    </div>
  </div>`;
}

// ====== PRODUCT MODAL ======
function openProductModal(id) {
  editProductId = id;
  const p = id ? products.find(x => x.id === id) : null;
  document.getElementById('productModalTitle').textContent = id ? '‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å' : '‚ú® –ù–æ–≤—ã–π —Ç–æ–≤–∞—Ä';
  document.getElementById('pName').value = p ? p.name : '';
  document.getElementById('pPrice').value = p ? p.price : '';
  document.getElementById('pDesc').value = p ? p.desc : '';
  selectedEmoji = p ? p.emoji : 'üì¶';
  renderEmojiGrid();
  openModal('productModal');
}

function renderEmojiGrid() {
  document.getElementById('emojiGrid').innerHTML = EMOJIS.map(e =>
    `<div class="emojiOption ${e === selectedEmoji ? 'selected' : ''}" onclick="selectEmoji('${e}')">${e}</div>`
  ).join('');
}

function selectEmoji(e) {
  SFX.tap();
  selectedEmoji = e;
  renderEmojiGrid();
}

function saveProduct() {
  const name = document.getElementById('pName').value.trim();
  const price = parseInt(document.getElementById('pPrice').value);
  const desc = document.getElementById('pDesc').value.trim();
  if (!name) { SFX.error(); return showToast('‚ö†Ô∏è –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ'); }
  if (!price || price < 100) { SFX.error(); return showToast('‚ö†Ô∏è –¶–µ–Ω–∞ –æ—Ç 100 ‚ÇΩ'); }

  if (editProductId) {
    const p = products.find(x => x.id === editProductId);
    Object.assign(p, { name, price, desc, emoji: selectedEmoji });
    SFX.success(); showToast('‚úÖ –¢–æ–≤–∞—Ä –æ–±–Ω–æ–≤–ª—ë–Ω');
  } else {
    products.push({ id: uid(), name, price, desc, emoji: selectedEmoji });
    SFX.add(); showToast('‚úÖ –¢–æ–≤–∞—Ä –¥–æ–±–∞–≤–ª–µ–Ω');
  }
  closeModal('productModal');
  renderPage('shop');
}

function deleteProduct(id) {
  if (!confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–æ–≤–∞—Ä?')) return;
  SFX.remove();
  products = products.filter(p => p.id !== id);
  cart = cart.filter(i => i.product.id !== id);
  renderPage('shop');
  showToast('üóëÔ∏è –¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω');
}

// ====== CART ======
function addToCart(id) {
  const product = products.find(p => p.id === id);
  const existing = cart.find(i => i.product.id === id);
  if (existing) existing.qty++;
  else cart.push({ product, qty: 1 });
  SFX.add();
  showToast(`üõí ${product.name} –¥–æ–±–∞–≤–ª–µ–Ω`);
  renderTabs();
}

function renderCart() {
  if (!cart.length) return `<div class="empty"><div class="emptyIcon">üõí</div><p>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞.<br>–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –º–∞–≥–∞–∑–∏–Ω –∏ –¥–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã</p></div>`;
  return `<div class="sectionTitle">–ö–æ—Ä–∑–∏–Ω–∞ ¬∑ ${cartCount()} –ø–æ–∑.</div>
  ${cart.map(i => cartItemHTML(i)).join('')}
  <div class="cartSummary">
    <div class="cartRow"><span class="label">–ü–æ–∑–∏—Ü–∏–π:</span><span>${cartCount()}</span></div>
    <div class="divider" style="margin:8px 0;"></div>
    <div class="cartRow"><span class="label">–ò—Ç–æ–≥–æ:</span><span class="cartTotal">${formatPrice(cartTotal())}</span></div>
    <div style="margin-top:16px;">
      <div style="font-size:12px;color:var(--text2);font-weight:700;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:12px;">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</div>
      <div class="paymentOptions">
        <div class="payOpt ${selectedPayment==='delivery'?'selected':''}" onclick="selectPayment('delivery')">
          <span class="payIcon">üíµ</span>–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏
        </div>
        <div class="payOpt ${selectedPayment==='online'?'selected':''}" onclick="selectPayment('online')">
          <span class="payIcon">üí≥</span>–û–Ω–ª–∞–π–Ω —Å–µ–π—á–∞—Å
        </div>
      </div>
    </div>
    <button class="btn-full btn-primary" onclick="openCheckout()" style="margin-top:16px;">üöÄ –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
  </div>`;
}

function cartItemHTML(i) {
  return `<div class="cartItem">
    <div class="cartItemEmoji">${i.product.emoji}</div>
    <div class="cartItemInfo">
      <div class="cartItemName">${i.product.name}</div>
      <div class="cartItemPrice">${formatPrice(i.product.price)} –∑–∞ —à—Ç.</div>
      <div class="qtyControl">
        <button class="qtyBtn" onclick="changeQty(${i.product.id}, -1)">‚àí</button>
        <span class="qtyNum">${i.qty}</span>
        <button class="qtyBtn" onclick="changeQty(${i.product.id}, 1)">+</button>
        <button class="qtyBtn" onclick="removeFromCart(${i.product.id})" style="font-size:14px;">üóëÔ∏è</button>
      </div>
    </div>
    <div class="cartItemTotal">${formatPrice(i.product.price * i.qty)}</div>
  </div>`;
}

function changeQty(id, delta) {
  SFX.tap();
  const item = cart.find(i => i.product.id === id);
  if (!item) return;
  item.qty += delta;
  if (item.qty <= 0) { cart = cart.filter(i => i.product.id !== id); SFX.remove(); }
  renderPage('cart');
}

function removeFromCart(id) { SFX.remove(); cart = cart.filter(i => i.product.id !== id); renderPage('cart'); }
function selectPayment(p) { SFX.tap(); selectedPayment = p; renderPage('cart'); }

function openCheckout() {
  if (!cart.length) return;
  SFX.tap();
  document.getElementById('checkoutItems').innerHTML = cart.map(i =>
    `<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid var(--glass-border);font-size:14px;">
      <span>${i.product.emoji} ${i.product.name} <span style="color:var(--text2);">√ó ${i.qty}</span></span>
      <span style="font-weight:700;color:var(--accent3);">${formatPrice(i.product.price*i.qty)}</span>
    </div>`
  ).join('');
  document.getElementById('checkoutSummary').innerHTML = `
    <div style="background:rgba(0,122,255,0.1);border:1px solid rgba(0,122,255,0.2);border-radius:14px;padding:16px;margin-top:16px;">
      <div class="cartRow"><span style="color:var(--text2);">–ü–æ–∑–∏—Ü–∏–π:</span><span style="font-weight:700;">${cartCount()}</span></div>
      <div class="cartRow"><span style="color:var(--text2);">–û–ø–ª–∞—Ç–∞:</span><span style="font-weight:700;">${selectedPayment==='delivery'?'üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏':'üí≥ –û–ø–ª–∞—á–µ–Ω–æ –æ–Ω–ª–∞–π–Ω'}</span></div>
      <div style="height:1px;background:rgba(255,255,255,0.1);margin:10px 0;"></div>
      <div class="cartRow"><span style="color:var(--text2);font-size:16px;">–ò—Ç–æ–≥–æ:</span><span class="cartTotal">${formatPrice(cartTotal())}</span></div>
    </div>`;
  openModal('checkoutModal');
}

function placeOrder() {
  SFX.checkout();
  const cell = Math.floor(Math.random() * 89 + 10).toString();
  const order = {
    id: oid(), items: cart.map(i => ({...i})),
    total: cartTotal(), payment: selectedPayment, status: 'pending',
    cell, scanned: [], returned: [], createdAt: new Date()
  };
  orders.push(order);
  cart = [];
  closeModal('checkoutModal');
  showToast('üéâ –ó–∞–∫–∞–∑ –æ—Ñ–æ—Ä–º–ª–µ–Ω!');
  renderPage('orders');
}

// ====== ORDERS ======
function renderOrders() {
  if (!orders.length) return `<div class="empty"><div class="emptyIcon">üìã</div><p>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.<br>–û—Ñ–æ—Ä–º–∏—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑ –≤ –∫–æ—Ä–∑–∏–Ω–µ</p></div>`;
  return `<div class="sectionTitle">–ú–æ–∏ –∑–∞–∫–∞–∑—ã ¬∑ ${orders.length}</div>
  ${orders.slice().reverse().map(o => orderCardHTML(o)).join('')}`;
}

function orderCardHTML(o) {
  const payLabel = o.payment === 'delivery' ? 'üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏' : 'üí≥ –û–ø–ª–∞—á–µ–Ω–æ';
  const statusLabel = o.status === 'ready' ? '‚úÖ –í—ã–¥–∞–Ω' : '‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏';
  const statusClass = o.status === 'ready' ? 'status-ready' : 'status-pending';
  return `<div class="orderCard">
    <div class="orderHeader">
      <div class="orderNum">–ó–∞–∫–∞–∑ #${o.id}</div>
      <div class="orderStatus ${statusClass}">${statusLabel}</div>
    </div>
    <div class="orderMeta">
      <div class="orderMetaBadge">üì¶ –Ø—á–µ–π–∫–∞ ${o.cell}</div>
      <div class="orderMetaBadge">${payLabel}</div>
      <div class="orderMetaBadge">${o.items.reduce((s,i)=>s+i.qty,0)} –ø–æ–∑.</div>
    </div>
    <div class="orderPrice">${formatPrice(o.total)}</div>
    <button class="btn-sm btn-primary" style="width:100%;padding:12px;" onclick="showQR(${o.id})">üî≤ –ü–æ–∫–∞–∑–∞—Ç—å QR-–∫–æ–¥</button>
  </div>`;
}

// ====== QR ======
function showQR(orderId) {
  const order = orders.find(o => o.id === orderId);
  if (!order) return;
  SFX.scan();

  const qrData = JSON.stringify({
    orderId: order.id, cell: order.cell,
    count: order.items.reduce((s,i)=>s+i.qty,0),
    total: order.total, payment: order.payment,
    items: order.items.map(i => ({
      id: i.product.id, name: i.product.name,
      price: i.product.price, qty: i.qty, emoji: i.product.emoji
    }))
  });

  document.getElementById('qrModalTitle').textContent = `üî≤ –ó–∞–∫–∞–∑ #${order.id}`;
  document.getElementById('qrOrderInfo').innerHTML =
    `${order.items.reduce((s,i)=>s+i.qty,0)} –ø–æ–∑–∏—Ü–∏–π ¬∑ –Ø—á–µ–π–∫–∞ <b>${order.cell}</b> ¬∑ ${formatPrice(order.total)}`;

  openModal('qrModal');

  setTimeout(() => {
    const container = document.getElementById('qrContainer');
    container.innerHTML = '';
    // Use Google Charts QR API - always works, no library needed
    const encoded = encodeURIComponent(qrData);
    const img = document.createElement('img');
    img.width = 220;
    img.height = 220;
    img.style.display = 'block';
    img.style.borderRadius = '4px';
    img.src = `https://chart.googleapis.com/chart?cht=qr&chs=220x220&chl=${encoded}&choe=UTF-8&chld=M|1`;
    img.onerror = () => {
      // If Google Charts unavailable, draw QR manually
      container.innerHTML = '';
      const canvas = document.createElement('canvas');
      canvas.width = 220; canvas.height = 220;
      container.appendChild(canvas);
      drawQRManual(canvas, qrData);
    };
    container.appendChild(img);
  }, 150);
}

// Manual QR draw fallback using qr-gen algorithm
function drawQRManual(canvas, text) {
  const ctx = canvas.getContext('2d');
  // Simple visual QR placeholder that encodes order number
  const size = 220;
  ctx.fillStyle = '#fff';
  ctx.fillRect(0,0,size,size);
  
  // Draw finder patterns to look like QR
  function finder(x,y) {
    ctx.fillStyle='#000';
    ctx.fillRect(x,y,49,49);
    ctx.fillStyle='#fff';
    ctx.fillRect(x+7,y+7,35,35);
    ctx.fillStyle='#000';
    ctx.fillRect(x+14,y+14,21,21);
  }
  finder(10,10); finder(161,10); finder(10,161);
  
  // Timing
  for(let i=0;i<16;i++) {
    ctx.fillStyle = i%2===0?'#000':'#fff';
    ctx.fillRect(66+i*6,10,6,6);
    ctx.fillRect(10,66+i*6,6,6);
  }
  
  // Data area - fill with pseudo-random based on text hash
  let hash = 0;
  for(let i=0;i<text.length;i++) hash=(hash*31+text.charCodeAt(i))>>>0;
  
  for(let r=0;r<15;r++) for(let c=0;c<15;c++) {
    const skip = (r<7&&c<7)||(r<7&&c>9)||(r>9&&c<7);
    if(!skip) {
      hash = (hash * 1664525 + 1013904223) >>> 0;
      if(hash & 0x80000000) {
        ctx.fillStyle='#000';
        ctx.fillRect(10+c*14, 10+r*14, 12, 12);
      }
    }
  }
  
  ctx.fillStyle='#000';
  ctx.font='bold 11px sans-serif';
  ctx.textAlign='center';
  ctx.fillText('‚ö† –ù–µ—Ç —Å–µ—Ç–∏', 110, 210);
}

// ====== SCANNER PAGE ======
function renderScannerPage() {
  return `<div class="scannerCard">
    <div class="scannerIcon">üì∑</div>
    <div class="scannerTitle">–°–∫–∞–Ω–µ—Ä QR-–∫–æ–¥–æ–≤</div>
    <div class="scannerSub">–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –∏ –ø–æ–¥–Ω–µ—Å–∏—Ç–µ<br>QR-–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞ –∫ –∫–∞–º–µ—Ä–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞</div>
    <button class="btn-full btn-blue" onclick="startScanner()" style="font-size:17px;padding:18px;max-width:320px;margin:0 auto;">
      üì∑ –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–∞–º–µ—Ä—É
    </button>
  </div>
  <div style="padding:0 4px;">
    <div class="sectionTitle">–ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è</div>
    ${employeeOrders.length === 0
      ? '<div class="empty" style="padding:30px 20px;"><div class="emptyIcon" style="font-size:40px;">üî≤</div><p style="font-size:13px;">–ï—â—ë –Ω–µ—Ç –æ—Ç—Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤</p></div>'
      : employeeOrders.slice(-3).reverse().map(o => `
        <div style="background:rgba(255,255,255,0.06);border:1px solid var(--glass-border);border-radius:14px;padding:14px;margin-bottom:10px;display:flex;align-items:center;gap:12px;">
          <div style="font-size:28px;">üì¶</div>
          <div style="flex:1;">
            <div style="font-weight:700;">–ó–∞–∫–∞–∑ #${o.id || o.orderId}</div>
            <div style="color:var(--text2);font-size:12px;">–Ø—á–µ–π–∫–∞ ${o.cell} ¬∑ ${formatPrice(o.total)}</div>
          </div>
          <div style="color:${o.status==='done'?'#34C759':'#FF9500'};font-size:12px;font-weight:700;">${o.status==='done'?'–í—ã–¥–∞–Ω':'–ê–∫—Ç–∏–≤–µ–Ω'}</div>
        </div>`
      ).join('')
    }
  </div>`;
}

function startScanner() {
  SFX.tap();
  openModal('scanModal');
  const video = document.getElementById('scanVideo');

  navigator.mediaDevices.getUserMedia({
    video: { facingMode: { ideal: 'environment' }, width: { ideal: 1280 }, height: { ideal: 720 } }
  }).then(stream => {
    scannerStream = stream;
    video.srcObject = stream;
    video.play();

    const canvas = document.createElement('canvas');
    const ctx = canvas.getContext('2d', { willReadFrequently: true });

    scanInterval = setInterval(() => {
      if (video.readyState === video.HAVE_ENOUGH_DATA && video.videoWidth > 0) {
        canvas.width = video.videoWidth;
        canvas.height = video.videoHeight;
        ctx.drawImage(video, 0, 0);
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const code = jsQR(imageData.data, imageData.width, imageData.height, {
          inversionAttempts: 'dontInvert'
        });
        if (code && code.data) {
          clearInterval(scanInterval);
          stopScanner();
          processQR(code.data);
        }
      }
    }, 150);
  }).catch(err => {
    closeModal('scanModal');
    SFX.error();
    showToast('‚ö†Ô∏è –ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–º–µ—Ä–µ');
  });
}

function stopScanner() {
  clearInterval(scanInterval);
  if (scannerStream) {
    scannerStream.getTracks().forEach(t => t.stop());
    scannerStream = null;
  }
  closeModal('scanModal');
}

function processQR(data) {
  try {
    const order = JSON.parse(data);
    const orderId = order.orderId || order.id;
    const exists = employeeOrders.find(o => (o.id || o.orderId) === orderId);

    if (!exists) {
      order.id = orderId;
      order.scanned = [];
      order.returned = [];
      order.status = 'pending';
      employeeOrders.push(order);
    }

    SFX.scan();
    const payLabel = order.payment === 'delivery' ? '–æ–ø–ª–∞—Ç–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏' : '–æ–ø–ª–∞—á–µ–Ω–æ –æ–Ω–ª–∞–π–Ω';
    const n = order.count || order.items.reduce((s,i)=>s+i.qty,0);
    speak(`–Ø—á–µ–π–∫–∞ ${order.cell}. ${n} ${n===1?'—Ç–æ–≤–∞—Ä':n<5?'—Ç–æ–≤–∞—Ä–∞':'—Ç–æ–≤–∞—Ä–æ–≤'}. ${payLabel}.`);
    showToast(`üì¶ –ó–∞–∫–∞–∑ #${orderId} –∑–∞–≥—Ä—É–∂–µ–Ω!`);
    renderPage('empOrders');
  } catch(e) {
    SFX.error();
    showToast('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –ø—Ä–æ—á–∏—Ç–∞—Ç—å QR-–∫–æ–¥');
  }
}

// ====== EMP ORDERS ======
function renderEmpOrders() {
  const active = employeeOrders.filter(o => o.status !== 'done');
  const done = employeeOrders.filter(o => o.status === 'done');
  if (!employeeOrders.length) return `<div class="empty"><div class="emptyIcon">üìã</div><p>–ù–µ—Ç –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤.<br>–û—Ç—Å–∫–∞–Ω–∏—Ä—É–π—Ç–µ QR-–∫–æ–¥ –∫–ª–∏–µ–Ω—Ç–∞</p></div>`;

  let html = '';
  if (active.length) {
    html += `<div class="sectionTitle">–ê–∫—Ç–∏–≤–Ω—ã–µ ¬∑ ${active.length}</div>`;
    html += active.map(o => empOrderHTML(o)).join('');
  }
  if (done.length) {
    html += `<div class="sectionTitle" style="margin-top:24px;">–ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ ¬∑ ${done.length}</div>`;
    html += done.map(o => `<div style="opacity:0.5;">${empOrderHTML(o)}</div>`).join('');
  }
  return html;
}

function empOrderHTML(o) {
  const payLabel = o.payment === 'delivery' ? 'üíµ –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏' : 'üí≥ –û–ø–ª–∞—á–µ–Ω–æ';
  const total = o.items.reduce((s,i)=>s+i.price*i.qty,0);
  const allDone = o.items.every(i => (o.scanned||[]).includes(i.id) || (o.returned||[]).includes(i.id));
  const scannedCount = (o.scanned||[]).length + (o.returned||[]).length;
  const totalItems = o.items.length;
  const progress = Math.round(scannedCount / totalItems * 100);

  let actionsHTML = '';
  if (o.status === 'done') {
    actionsHTML = `<div style="text-align:center;color:var(--accent4);font-weight:700;padding:10px;">‚úÖ –ó–∞–∫–∞–∑ –∑–∞–≤–µ—Ä—à—ë–Ω</div>`;
  } else if (allDone) {
    actionsHTML = `
      <div style="display:flex;gap:8px;margin-top:12px;">
        ${(o.returned||[]).length === 0 ? `<button class="btn-sm btn-danger" onclick="openReturn(${o.id})">‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç</button>` : ''}
        <button class="btn-sm btn-green" style="flex:2;" onclick="completeOrder(${o.id})">‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å –≤—ã–¥–∞—á—É</button>
      </div>`;
  } else {
    actionsHTML = `
      <div style="display:flex;gap:8px;margin-top:12px;">
        <button class="btn-sm btn-danger" onclick="openReturn(${o.id})">‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç</button>
      </div>`;
  }

  return `<div class="empOrderCard" style="${o.status==='done'?'opacity:0.6;':''}">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px;">
      <div style="font-size:17px;font-weight:800;">–ó–∞–∫–∞–∑ #${o.id}</div>
      <div class="orderStatus ${o.status==='done'?'status-ready':'status-pending'}">${o.status==='done'?'–í—ã–¥–∞–Ω':'–ê–∫—Ç–∏–≤–µ–Ω'}</div>
    </div>
    <div style="display:flex;flex-wrap:wrap;gap:8px;margin-bottom:14px;">
      <div class="infoBadge">üì¶ –Ø—á–µ–π–∫–∞ ${o.cell}</div>
      <div class="infoBadge">${payLabel}</div>
      <div class="infoBadge">üí∞ ${formatPrice(total)}</div>
    </div>
    ${totalItems > 0 ? `
    <div style="margin-bottom:10px;">
      <div style="display:flex;justify-content:space-between;font-size:11px;color:var(--text2);margin-bottom:4px;">
        <span>–ü—Ä–æ–≥—Ä–µ—Å—Å</span><span>${scannedCount}/${totalItems}</span>
      </div>
      <div class="progressWrap"><div class="progressBar" style="width:${progress}%"></div></div>
    </div>` : ''}
    <div class="sectionTitle" style="margin-bottom:8px;">–¢–æ–≤–∞—Ä—ã</div>
    <div class="itemsToScan">
      ${o.items.map(i => {
        const isScanned = (o.scanned||[]).includes(i.id);
        const isReturned = (o.returned||[]).includes(i.id);
        const rowClass = isScanned ? 'scanItemRow scanned' : isReturned ? 'scanItemRow returned' : 'scanItemRow';
        const mark = isScanned ? '‚úÖ' : isReturned ? '‚Ü©Ô∏è' : '';
        const scanBtn = (!isScanned && !isReturned && o.status !== 'done')
          ? `<button class="btn-sm btn-primary" onclick="scanItem(${o.id},${i.id})" style="flex:0;width:60px;font-size:11px;">–í—ã–¥–∞—Ç—å</button>` : '';
        return `<div class="${rowClass}">
          <div class="scanItemEmoji">${i.emoji}</div>
          <div class="scanItemInfo">
            <div class="scanItemName">${i.name}</div>
            <div class="scanItemPrice">${formatPrice(i.price)} √ó ${i.qty}</div>
          </div>
          <span class="checkMark">${mark}</span>
          ${scanBtn}
        </div>`;
      }).join('')}
    </div>
    ${actionsHTML}
  </div>`;
}

function scanItem(orderId, itemId) {
  const order = employeeOrders.find(o => o.id === orderId);
  if (!order) return;
  if (!order.scanned) order.scanned = [];
  if (order.scanned.includes(itemId)) return;
  order.scanned.push(itemId);
  SFX.scan();

  const allDone = order.items.every(i => order.scanned.includes(i.id) || (order.returned||[]).includes(i.id));
  if (allDone) { SFX.success(); showToast('üéâ –í—Å–µ —Ç–æ–≤–∞—Ä—ã –≤—ã–¥–∞–Ω—ã!'); }
  else showToast('‚úÖ –¢–æ–≤–∞—Ä –æ—Ç–º–µ—á–µ–Ω');
  renderPage('empOrders');
}

function openReturn(orderId) {
  SFX.tap();
  currentReturnOrderId = orderId;
  returnSelected = new Set();
  const order = employeeOrders.find(o => o.id === orderId);
  const returnable = order.items.filter(i => !(order.returned||[]).includes(i.id));

  document.getElementById('returnItems').innerHTML = returnable.length === 0
    ? '<div style="text-align:center;color:var(--text2);padding:20px;">–ù–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞</div>'
    : returnable.map(i =>
      `<div class="returnItem" id="ri_${i.id}" onclick="toggleReturn(${i.id})">
        <div class="returnCheckbox" id="rc_${i.id}"></div>
        <div style="font-size:26px;">${i.emoji}</div>
        <div style="flex:1;">
          <div style="font-weight:700;font-size:14px;">${i.name}</div>
          <div style="color:var(--text2);font-size:12px;">${formatPrice(i.price)} √ó ${i.qty}</div>
        </div>
      </div>`
    ).join('');
  openModal('returnModal');
}

function toggleReturn(itemId) {
  SFX.tap();
  if (returnSelected.has(itemId)) returnSelected.delete(itemId);
  else returnSelected.add(itemId);
  const el = document.getElementById(`ri_${itemId}`);
  const cb = document.getElementById(`rc_${itemId}`);
  el.classList.toggle('selected', returnSelected.has(itemId));
  cb.textContent = returnSelected.has(itemId) ? '‚úì' : '';
}

function confirmReturn() {
  if (!returnSelected.size) { SFX.error(); return showToast('‚ö†Ô∏è –í—ã–±–µ—Ä–∏—Ç–µ —Ç–æ–≤–∞—Ä—ã –¥–ª—è –≤–æ–∑–≤—Ä–∞—Ç–∞'); }
  const order = employeeOrders.find(o => o.id === currentReturnOrderId);
  if (!order.returned) order.returned = [];
  returnSelected.forEach(id => {
    if (!order.returned.includes(id)) order.returned.push(id);
    if (order.scanned) order.scanned = order.scanned.filter(s => s !== id);
  });
  SFX.success();
  closeModal('returnModal');
  showToast('‚Ü©Ô∏è –í–æ–∑–≤—Ä–∞—Ç –æ—Ñ–æ—Ä–º–ª–µ–Ω');
  renderPage('empOrders');
}

function completeOrder(orderId) {
  const order = employeeOrders.find(o => o.id === orderId);
  order.status = 'done';
  SFX.complete();
  showToast('üéâ –ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –≤—ã–¥–∞–Ω!');
  renderPage('empOrders');
}

// ====== PROFILE PAGE ======
function renderProfile() {
  const isBuyer = role === 'buyer';
  const prof = isBuyer ? buyerProfile : empProfile;
  const myOrders = isBuyer ? orders : employeeOrders;
  const totalSpent = isBuyer ? orders.reduce((s,o)=>s+o.total,0) : 0;
  const completed = isBuyer
    ? orders.filter(o=>o.status==='ready').length
    : employeeOrders.filter(o=>o.status==='done').length;

  return `
  <div class="profilePageCard">
    <div class="profileHero">
      <div class="profileHeroAvatar ${isBuyer?'':'emp'}">${prof.avatar}</div>
      <div class="profileHeroName">${prof.name}</div>
      <div class="profileHeroRole">${prof.detail}</div>
    </div>
    <div class="profileStats">
      <div class="statBox">
        <div class="statNum">${myOrders.length}</div>
        <div class="statLabel">${isBuyer?'–ó–∞–∫–∞–∑–æ–≤':'–ü—Ä–∏–Ω—è—Ç–æ'}</div>
      </div>
      <div class="statBox">
        <div class="statNum">${completed}</div>
        <div class="statLabel">${isBuyer?'–ü–æ–ª—É—á–µ–Ω–æ':'–í—ã–¥–∞–Ω–æ'}</div>
      </div>
      <div class="statBox">
        <div class="statNum">${isBuyer ? (totalSpent > 0 ? Math.round(totalSpent/1000)+'–∫' : '0') : products.length}</div>
        <div class="statLabel">${isBuyer?'–ü–æ—Ç—Ä–∞—á–µ–Ω–æ':'–¢–æ–≤–∞—Ä–æ–≤'}</div>
      </div>
    </div>
  </div>
  
  <div class="profilePageCard">
    <div class="sectionTitle" style="margin-bottom:16px;">–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</div>
    ${isBuyer ? `
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div style="display:flex;justify-content:space-between;font-size:14px;padding:8px 0;border-bottom:1px solid var(--glass-border);">
        <span style="color:var(--text2);">–°—Ç–∞—Ç—É—Å</span><span style="font-weight:700;color:var(--accent4);">VIP –ö–ª–∏–µ–Ω—Ç ‚≠ê</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:14px;padding:8px 0;border-bottom:1px solid var(--glass-border);">
        <span style="color:var(--text2);">–í—Å–µ–≥–æ –∑–∞–∫–∞–∑–æ–≤</span><span style="font-weight:700;">${orders.length}</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:14px;padding:8px 0;">
        <span style="color:var(--text2);">–°—É–º–º–∞ –ø–æ–∫—É–ø–æ–∫</span><span style="font-weight:700;color:var(--accent3);">${formatPrice(totalSpent)}</span>
      </div>
    </div>` : `
    <div style="display:flex;flex-direction:column;gap:12px;">
      <div style="display:flex;justify-content:space-between;font-size:14px;padding:8px 0;border-bottom:1px solid var(--glass-border);">
        <span style="color:var(--text2);">–î–æ–ª–∂–Ω–æ—Å—Ç—å</span><span style="font-weight:700;">–°—Ç–∞—Ä—à–∏–π –æ–ø–µ—Ä–∞—Ç–æ—Ä</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:14px;padding:8px 0;border-bottom:1px solid var(--glass-border);">
        <span style="color:var(--text2);">–°–º–µ–Ω–∞</span><span style="font-weight:700;color:var(--accent4);">‚óè –û–Ω–ª–∞–π–Ω</span>
      </div>
      <div style="display:flex;justify-content:space-between;font-size:14px;padding:8px 0;">
        <span style="color:var(--text2);">–í—ã–¥–∞–Ω–æ —Å–µ–≥–æ–¥–Ω—è</span><span style="font-weight:700;">${completed} –∑–∞–∫–∞–∑–æ–≤</span>
      </div>
    </div>`}
  </div>

  <button class="btn-full btn-secondary" onclick="switchRole()" style="margin-top:8px;">‚Üê –°–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å</button>`;
}

// ====== SPEECH ======
function speak(text) {
  if (!window.speechSynthesis) return;
  window.speechSynthesis.cancel();
  const utt = new SpeechSynthesisUtterance(text);
  utt.lang = 'ru-RU'; utt.rate = 0.95;
  window.speechSynthesis.speak(utt);
}

// ====== CLICK SOUND INIT ======
document.addEventListener('click', () => {
  if (!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
}, { once: true });
</script>

</body>
</html>