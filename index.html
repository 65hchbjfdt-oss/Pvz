<!DOCTYPE html>

<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
<title>ĞŸĞ’Ğ—</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jsQR/1.4.0/jsQR.min.js"></script>
<style>
*,::before,::after{box-sizing:border-box;margin:0;padding:0;-webkit-tap-highlight-color:transparent}
html,body{height:100%;overflow:hidden;background:#000}
body{
  font-family:-apple-system,"SF Pro Text","Helvetica Neue",sans-serif;
  -webkit-font-smoothing:antialiased;
  color:#fff;
  position:relative;
}

/* â•â•â• WALLPAPER â•â•â• */
#wall{
position:fixed;inset:0;z-index:0;
background:radial-gradient(ellipse 120% 80% at 15% 5%, #1a0533 0%,transparent 55%),
radial-gradient(ellipse 100% 70% at 85% 10%, #001a3d 0%,transparent 50%),
radial-gradient(ellipse 80% 60% at 50% 95%, #001a0d 0%,transparent 50%),
#000;
overflow:hidden;
}
#wall::before{
content:â€™â€™;position:absolute;inset:0;
background:
radial-gradient(circle 400px at 10% 20%, rgba(120,50,255,0.35) 0%,transparent 70%),
radial-gradient(circle 350px at 90% 15%, rgba(0,100,255,0.3) 0%,transparent 70%),
radial-gradient(circle 300px at 60% 80%, rgba(0,180,80,0.2) 0%,transparent 70%),
radial-gradient(circle 250px at 20% 70%, rgba(255,80,0,0.15) 0%,transparent 70%);
animation:wallShift 20s ease-in-out infinite alternate;
}
@keyframes wallShift{
0%{transform:scale(1) translate(0,0)}
50%{transform:scale(1.05) translate(-15px,10px)}
100%{transform:scale(1.02) translate(10px,-8px)}
}

/* â•â•â• LIQUID GLASS MIXIN â•â•â• */
.glass{
background:rgba(255,255,255,0.07);
backdrop-filter:blur(40px) saturate(180%) brightness(1.15);
-webkit-backdrop-filter:blur(40px) saturate(180%) brightness(1.15);
border:1px solid rgba(255,255,255,0.18);
box-shadow:
inset 0 1px 0 rgba(255,255,255,0.22),
inset 0 -1px 0 rgba(0,0,0,0.15),
0 8px 32px rgba(0,0,0,0.4),
0 2px 8px rgba(0,0,0,0.3);
}
.glass-card{
background:rgba(255,255,255,0.06);
backdrop-filter:blur(60px) saturate(200%) brightness(1.1);
-webkit-backdrop-filter:blur(60px) saturate(200%) brightness(1.1);
border:1px solid rgba(255,255,255,0.15);
box-shadow:
inset 0 1.5px 0 rgba(255,255,255,0.2),
inset 0 -1px 0 rgba(0,0,0,0.2),
0 20px 60px rgba(0,0,0,0.5);
}
.glass-btn{
background:rgba(255,255,255,0.1);
backdrop-filter:blur(20px) saturate(150%);
-webkit-backdrop-filter:blur(20px) saturate(150%);
border:1px solid rgba(255,255,255,0.2);
box-shadow:
inset 0 1px 0 rgba(255,255,255,0.25),
0 4px 12px rgba(0,0,0,0.3);
}

/* â•â•â• ROOT LAYOUT â•â•â• */
#root{
position:relative;z-index:1;
height:100dvh;
display:flex;flex-direction:column;
overflow:hidden;
}

/* â•â•â• SCREENS â•â•â• */
.screen{display:none;flex:1;flex-direction:column;overflow:hidden}
.screen.active{display:flex}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ROLE SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#roleScreen{
align-items:center;justify-content:center;
padding:0 24px;gap:0;
padding-top:env(safe-area-inset-top,0);
padding-bottom:env(safe-area-inset-bottom,0);
}

.rs-logo{
width:100px;height:100px;border-radius:28px;
background:linear-gradient(145deg,rgba(120,50,255,0.6),rgba(0,122,255,0.5));
display:flex;align-items:center;justify-content:center;
font-size:52px;margin-bottom:24px;
box-shadow:
inset 0 2px 0 rgba(255,255,255,0.3),
0 0 60px rgba(88,0,255,0.4),
0 20px 40px rgba(0,0,0,0.5);
border:1px solid rgba(255,255,255,0.25);
animation:logoPop 0.6s cubic-bezier(.34,1.56,.64,1);
}
@keyframes logoPop{from{transform:scale(0.5);opacity:0}to{transform:scale(1);opacity:1}}

.rs-title{
font-size:34px;font-weight:700;letter-spacing:-0.8px;
margin-bottom:6px;text-align:center;
animation:fadeUp 0.5s 0.1s both;
}
.rs-sub{
font-size:15px;color:rgba(255,255,255,0.5);
text-align:center;margin-bottom:40px;line-height:1.5;
animation:fadeUp 0.5s 0.15s both;
}
@keyframes fadeUp{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

/* Profile preview */
.rs-profile{
width:100%;max-width:360px;margin-bottom:28px;
animation:fadeUp 0.5s 0.2s both;
}
.rs-ptabs{
display:flex;gap:0;padding:3px;border-radius:12px;margin-bottom:12px;
}
.rs-ptab{
flex:1;padding:8px;border-radius:9px;font-size:13px;font-weight:600;
color:rgba(255,255,255,0.45);cursor:pointer;text-align:center;
transition:all 0.2s;
}
.rs-ptab.on{
background:rgba(255,255,255,0.12);
color:#fff;
box-shadow:inset 0 1px 0 rgba(255,255,255,0.2),0 2px 8px rgba(0,0,0,0.3);
}
.rs-pcard{
border-radius:18px;padding:16px 18px;
display:flex;align-items:center;gap:14px;
}
.rs-pav{
width:52px;height:52px;border-radius:50%;
display:flex;align-items:center;justify-content:center;font-size:26px;
border:2px solid rgba(255,255,255,0.2);flex-shrink:0;
}
.rs-pav.buyer{background:linear-gradient(135deg,rgba(0,122,255,0.6),rgba(88,86,214,0.5))}
.rs-pav.emp{background:linear-gradient(135deg,rgba(52,199,89,0.5),rgba(0,199,190,0.4))}
.rs-pname{font-size:16px;font-weight:600;margin-bottom:2px}
.rs-pdetail{font-size:12px;color:rgba(255,255,255,0.45)}
.rs-pbadge{
margin-left:auto;padding:4px 12px;border-radius:20px;
font-size:11px;font-weight:600;flex-shrink:0;
}
.rs-pbadge.buyer{background:rgba(0,122,255,0.2);border:1px solid rgba(0,122,255,0.35);color:#007AFF}
.rs-pbadge.emp{background:rgba(52,199,89,0.18);border:1px solid rgba(52,199,89,0.3);color:#34C759}

/* Role buttons */
.rs-btns{
display:flex;flex-direction:column;gap:14px;
width:100%;max-width:360px;
animation:fadeUp 0.5s 0.25s both;
}
.rs-btn{
width:100%;padding:20px 22px;border-radius:22px;border:none;cursor:pointer;
display:flex;align-items:center;gap:18px;text-align:left;
transition:transform 0.2s cubic-bezier(.34,1.56,.64,1),box-shadow 0.2s;
position:relative;overflow:hidden;
}
.rs-btn::after{
content:â€™â€™;position:absolute;inset:0;opacity:0;transition:opacity 0.15s;
background:radial-gradient(circle at 50% 0%,rgba(255,255,255,0.15),transparent 70%);
}
.rs-btn:active{transform:scale(0.96)}
.rs-btn:active::after{opacity:1}
.rs-btn.buyer{
background:linear-gradient(145deg,rgba(0,100,255,0.25),rgba(88,86,214,0.18));
backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);
border:1px solid rgba(0,122,255,0.35);
box-shadow:inset 0 1.5px 0 rgba(255,255,255,0.2),0 8px 32px rgba(0,100,255,0.2),0 2px 8px rgba(0,0,0,0.4);
}
.rs-btn.emp{
background:linear-gradient(145deg,rgba(52,199,89,0.2),rgba(0,199,190,0.15));
backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);
border:1px solid rgba(52,199,89,0.3);
box-shadow:inset 0 1.5px 0 rgba(255,255,255,0.2),0 8px 32px rgba(52,199,89,0.15),0 2px 8px rgba(0,0,0,0.4);
}
.rs-bicon{font-size:40px}
.rs-btitle{font-size:17px;font-weight:700;color:#fff;margin-bottom:3px}
.rs-bsub{font-size:12px;color:rgba(255,255,255,0.45)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
APP SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#appScreen{
padding-top:env(safe-area-inset-top,0);
}

/* â”€â”€â”€ Nav bar (top) â”€â”€â”€ */
.navbar{
padding:14px 20px 12px;
display:flex;align-items:center;justify-content:space-between;
flex-shrink:0;
border-bottom:1px solid rgba(255,255,255,0.08);
background:rgba(0,0,0,0.2);
backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);
}
.nb-l{display:flex;align-items:center;gap:10px}
.nb-logo{font-size:24px}
.nb-title{font-size:18px;font-weight:700;letter-spacing:-0.3px}
.nb-badge{
padding:3px 10px;border-radius:20px;font-size:11px;font-weight:600;
}
.nb-badge.buyer{background:rgba(0,122,255,0.2);border:1px solid rgba(0,122,255,0.3);color:#007AFF}
.nb-badge.emp{background:rgba(52,199,89,0.18);border:1px solid rgba(52,199,89,0.25);color:#34C759}
.nb-exit{
background:rgba(255,255,255,0.08);border:1px solid rgba(255,255,255,0.12);
color:rgba(255,255,255,0.5);padding:6px 14px;border-radius:10px;
font-size:12px;font-weight:600;cursor:pointer;font-family:inherit;
transition:all 0.15s;
}
.nb-exit:active{transform:scale(0.94);background:rgba(255,255,255,0.13)}

/* â”€â”€â”€ Tab bar â”€â”€â”€ */
.tabbar{
display:flex;
padding:8px 10px calc(8px + env(safe-area-inset-bottom,16px));
gap:4px;
flex-shrink:0;
border-top:1px solid rgba(255,255,255,0.08);
background:rgba(0,0,0,0.35);
backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);
}
.tb-item{
flex:1;display:flex;flex-direction:column;align-items:center;
gap:3px;padding:6px 4px;border-radius:12px;cursor:pointer;
transition:all 0.2s;position:relative;
}
.tb-item:active{transform:scale(0.9)}
.tb-item.on{background:rgba(255,255,255,0.08)}
.tb-icon{font-size:22px;line-height:1}
.tb-label{font-size:10px;font-weight:500;color:rgba(255,255,255,0.35);letter-spacing:0.1px}
.tb-item.on .tb-label{color:rgba(255,255,255,0.85);font-weight:600}
.tb-badge{
position:absolute;top:2px;right:calc(50% - 18px);
background:#FF3B30;color:#fff;font-size:9px;font-weight:700;
min-width:15px;height:15px;border-radius:8px;padding:0 3px;
display:flex;align-items:center;justify-content:center;
}

/* â”€â”€â”€ Page content â”€â”€â”€ */
.pages{flex:1;overflow:hidden;position:relative}
.page{
position:absolute;inset:0;overflow-y:auto;overflow-x:hidden;
padding:16px 16px 20px;
display:none;
-webkit-overflow-scrolling:touch;
}
.page.active{display:block;animation:pgIn 0.22s ease}
@keyframes pgIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:translateY(0)}}

/* Scrollbar hide */
.page::-webkit-scrollbar{display:none}

/* â”€â”€â”€ Section label â”€â”€â”€ */
.sec-label{
font-size:13px;font-weight:600;color:rgba(255,255,255,0.35);
letter-spacing:0.5px;text-transform:uppercase;
margin-bottom:12px;padding-left:4px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PRODUCT CARDS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.pgrid{
display:grid;grid-template-columns:1fr 1fr;gap:12px;
}
@media(min-width:500px){.pgrid{grid-template-columns:repeat(3,1fr)}}
@media(min-width:700px){.pgrid{grid-template-columns:repeat(4,1fr)}}

.pcard{
border-radius:22px;overflow:hidden;
display:flex;flex-direction:column;
transition:transform 0.2s cubic-bezier(.34,1.56,.64,1);
}
.pcard:active{transform:scale(0.97)}
.pcard-img{
background:rgba(255,255,255,0.04);
height:90px;display:flex;align-items:center;justify-content:center;
font-size:44px;
border-bottom:1px solid rgba(255,255,255,0.07);
}
.pcard-body{padding:12px;flex:1;display:flex;flex-direction:column;gap:4px}
.pcard-name{font-size:13px;font-weight:600;line-height:1.3}
.pcard-desc{font-size:11px;color:rgba(255,255,255,0.4);flex:1;line-height:1.4}
.pcard-price{font-size:15px;font-weight:700;color:#FF9500;margin-top:4px}
.pcard-acts{
display:flex;gap:6px;padding:9px 10px;
border-top:1px solid rgba(255,255,255,0.07);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
BUTTONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.btn{
padding:8px 10px;border-radius:12px;font-size:12px;font-weight:600;
border:none;cursor:pointer;font-family:inherit;
transition:transform 0.15s,opacity 0.15s;
display:flex;align-items:center;justify-content:center;gap:4px;
}
.btn:active{transform:scale(0.9);opacity:0.8}
.btn.flex{flex:1}
.btn-blue{
background:linear-gradient(135deg,#007AFF,#5856D6);color:#fff;
box-shadow:0 4px 12px rgba(0,122,255,0.35);
}
.btn-red{
background:linear-gradient(135deg,#FF3B30,#FF6B6B);color:#fff;
box-shadow:0 4px 12px rgba(255,59,48,0.3);
}
.btn-green{
background:linear-gradient(135deg,#34C759,#30D158);color:#fff;
box-shadow:0 4px 12px rgba(52,199,89,0.3);
}
.btn-glass{
background:rgba(255,255,255,0.09);
border:1px solid rgba(255,255,255,0.14);
color:rgba(255,255,255,0.7);
}
.btn-glass:active{background:rgba(255,255,255,0.15)}

.fullbtn{
width:100%;padding:15px;border-radius:14px;font-size:15px;font-weight:600;
border:none;cursor:pointer;font-family:inherit;margin-top:10px;
transition:transform 0.15s,box-shadow 0.15s;
}
.fullbtn:active{transform:scale(0.97)}
.fullbtn.blue{
background:linear-gradient(135deg,#007AFF,#5856D6);color:#fff;
box-shadow:0 8px 24px rgba(0,122,255,0.4);
}
.fullbtn.red{background:linear-gradient(135deg,#FF3B30,#FF6B6B);color:#fff}
.fullbtn.green{
background:linear-gradient(135deg,#34C759,#30D158);color:#fff;
box-shadow:0 8px 20px rgba(52,199,89,0.35);
}
.fullbtn.glass{
background:rgba(255,255,255,0.08);
border:1px solid rgba(255,255,255,0.13);color:rgba(255,255,255,0.6);
}

/* FAB */
.fab{
position:fixed;bottom:calc(90px + env(safe-area-inset-bottom,16px));right:20px;
width:58px;height:58px;border-radius:50%;border:none;cursor:pointer;
background:linear-gradient(145deg,#007AFF,#5856D6);color:#fff;
font-size:28px;display:flex;align-items:center;justify-content:center;
box-shadow:0 8px 28px rgba(0,122,255,0.5),inset 0 1px 0 rgba(255,255,255,0.3);
z-index:100;transition:transform 0.25s cubic-bezier(.34,1.56,.64,1);
}
.fab:active{transform:scale(0.88)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
CART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.cart-item{
border-radius:18px;padding:14px 16px;
display:flex;align-items:center;gap:14px;margin-bottom:10px;
}
.ci-em{font-size:36px}
.ci-info{flex:1}
.ci-name{font-size:14px;font-weight:600}
.ci-price{font-size:12px;color:rgba(255,255,255,0.4);margin-top:2px}
.qty-row{display:flex;align-items:center;gap:10px;margin-top:8px}
.qbtn{
width:28px;height:28px;border-radius:50%;border:none;
background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);
color:#fff;font-size:17px;cursor:pointer;font-family:inherit;
display:flex;align-items:center;justify-content:center;
transition:all 0.15s;
}
.qbtn:active{background:rgba(0,122,255,0.4);transform:scale(0.85)}
.qnum{font-size:16px;font-weight:700;min-width:24px;text-align:center}
.ci-total{font-size:15px;font-weight:700;color:#FF9500;white-space:nowrap}

.cart-summary{border-radius:18px;padding:18px;margin-top:14px}
.cs-row{display:flex;justify-content:space-between;align-items:center;padding:7px 0;font-size:14px}
.cs-row .l{color:rgba(255,255,255,0.45)}
.cs-total{font-size:22px;font-weight:700;color:#FF9500}
.pay-opts{display:flex;gap:10px;margin-top:14px}
.pay-opt{
flex:1;padding:13px 10px;border-radius:14px;border:2px solid rgba(255,255,255,0.1);
background:rgba(255,255,255,0.04);text-align:center;font-size:12px;font-weight:600;
cursor:pointer;transition:all 0.2s;color:rgba(255,255,255,0.45);font-family:inherit;
}
.pay-opt.on{
border-color:#007AFF;background:rgba(0,122,255,0.15);color:#fff;
box-shadow:0 0 0 1px rgba(0,122,255,0.3) inset;
}
.pay-opt .pi{font-size:24px;display:block;margin-bottom:5px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ORDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.order-card{border-radius:20px;padding:18px;margin-bottom:12px}
.oc-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:10px}
.oc-num{font-size:16px;font-weight:700}
.oc-status{font-size:11px;padding:4px 11px;border-radius:20px;font-weight:600}
.st-wait{background:rgba(255,149,0,0.18);color:#FF9500;border:1px solid rgba(255,149,0,0.28)}
.st-done{background:rgba(52,199,89,0.18);color:#34C759;border:1px solid rgba(52,199,89,0.28)}
.oc-meta{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:12px}
.oc-badge{
font-size:12px;color:rgba(255,255,255,0.5);
background:rgba(255,255,255,0.06);border:1px solid rgba(255,255,255,0.1);
border-radius:8px;padding:4px 10px;
}
.oc-price{font-size:20px;font-weight:700;color:#FF9500;margin-bottom:14px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
QR MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.qr-center{display:flex;flex-direction:column;align-items:center;text-align:center}
#qrBox{
padding:16px;background:#fff;border-radius:16px;
display:inline-block;margin:16px 0;
box-shadow:0 8px 40px rgba(0,0,0,0.5);
}
#qrBox canvas{display:block}
.qr-info{color:rgba(255,255,255,0.45);font-size:13px;margin-bottom:6px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SCANNER PAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.scan-hero{
border-radius:26px;padding:32px 24px;text-align:center;margin-bottom:16px;
}
.scan-icon{font-size:64px;margin-bottom:16px}
.scan-title{font-size:22px;font-weight:700;margin-bottom:8px}
.scan-sub{font-size:14px;color:rgba(255,255,255,0.45);line-height:1.6;margin-bottom:24px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
SCANNER OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#scanOverlay{
display:none;position:fixed;inset:0;z-index:500;
background:rgba(0,0,0,0.85);
backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);
flex-direction:column;align-items:center;justify-content:center;
padding:24px;
}
#scanOverlay.active{display:flex}

.scan-modal{
width:100%;max-width:420px;border-radius:28px;padding:0;overflow:hidden;
}
.scan-modal-head{
padding:20px 22px 16px;
border-bottom:1px solid rgba(255,255,255,0.08);
}
.scan-modal-title{font-size:18px;font-weight:700;margin-bottom:2px}
.scan-modal-sub{font-size:13px;color:rgba(255,255,255,0.4)}

.vid-container{
position:relative;background:#000;
aspect-ratio:1;width:100%;max-height:50dvh;overflow:hidden;
}
#scanVid{width:100%;height:100%;object-fit:cover;display:block}

/* Dimming with transparent centre */
.vid-dim{
position:absolute;inset:0;pointer-events:none;
background:rgba(0,0,0,0.5);
-webkit-mask:radial-gradient(ellipse 55% 55% at 50% 50%,transparent 60%,black 61%);
mask:radial-gradient(ellipse 55% 55% at 50% 50%,transparent 60%,black 61%);
}

/* QR frame corners */
.vid-frame{
position:absolute;
top:50%;left:50%;
transform:translate(-50%,-50%);
width:58%;height:58%;pointer-events:none;
}
.vid-frame::before,.vid-frame::after,
.vf-inner::before,.vf-inner::after{
content:â€™â€™;position:absolute;
width:26px;height:26px;
border-color:#fff;border-style:solid;
}
.vid-frame::before{top:0;left:0;border-width:3px 0 0 3px;border-radius:6px 0 0 0}
.vid-frame::after{top:0;right:0;border-width:3px 3px 0 0;border-radius:0 6px 0 0}
.vf-inner::before{bottom:0;left:0;border-width:0 0 3px 3px;border-radius:0 0 0 6px}
.vf-inner::after{bottom:0;right:0;border-width:0 3px 3px 0;border-radius:0 0 6px 0}

/* scanning beam */
.vid-beam{
position:absolute;left:21%;right:21%;height:2px;
background:linear-gradient(90deg,transparent,rgba(255,255,255,0.9) 40%,#007AFF 50%,rgba(255,255,255,0.9) 60%,transparent);
box-shadow:0 0 12px rgba(0,122,255,0.8);
animation:beam 2.2s ease-in-out infinite;
}
@keyframes beam{
0%{top:21%;opacity:1}
48%{opacity:1}
50%{top:79%;opacity:0}
52%{opacity:0}
54%{opacity:1}
100%{top:21%;opacity:1}
}

.scan-modal-foot{padding:16px 22px 20px}
.scan-status{
text-align:center;font-size:13px;color:rgba(255,255,255,0.45);
margin-bottom:14px;min-height:20px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EMP ORDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.emp-card{border-radius:22px;padding:18px;margin-bottom:14px}
.ec-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
.ec-title{font-size:17px;font-weight:700}
.ec-meta{display:flex;flex-wrap:wrap;gap:7px;margin-bottom:14px}
.ec-badge{
background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.1);
border-radius:8px;padding:5px 12px;font-size:12px;font-weight:500;
}
.prog-wrap{background:rgba(255,255,255,0.1);border-radius:6px;height:4px;overflow:hidden;margin-bottom:14px}
.prog-bar{height:100%;border-radius:6px;background:linear-gradient(90deg,#007AFF,#5856D6);transition:width .4s}
.items-list{display:flex;flex-direction:column;gap:8px;margin-bottom:14px}
.item-row{
display:flex;align-items:center;gap:12px;
background:rgba(255,255,255,0.05);border:1px solid rgba(255,255,255,0.08);
border-radius:14px;padding:12px;transition:all 0.3s;
}
.item-row.done-s{opacity:0.45;background:rgba(52,199,89,0.07);border-color:rgba(52,199,89,0.18)}
.item-row.done-r{opacity:0.45;background:rgba(255,59,48,0.07);border-color:rgba(255,59,48,0.18)}
.item-em{font-size:26px}
.item-info{flex:1}
.item-name{font-size:13px;font-weight:600}
.item-price{font-size:11px;color:rgba(255,255,255,0.35);margin-top:2px}
.item-mark{font-size:20px}
.ec-acts{display:flex;gap:8px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.prof-hero{border-radius:24px;padding:28px;text-align:center;margin-bottom:14px}
.prof-av{
width:84px;height:84px;border-radius:50%;font-size:44px;
display:flex;align-items:center;justify-content:center;
margin:0 auto 14px;border:2.5px solid rgba(255,255,255,0.2);
}
.prof-av.buyer{
background:linear-gradient(135deg,rgba(0,122,255,0.5),rgba(88,86,214,0.45));
box-shadow:0 8px 32px rgba(0,122,255,0.3);
}
.prof-av.emp{
background:linear-gradient(135deg,rgba(52,199,89,0.45),rgba(0,199,190,0.38));
box-shadow:0 8px 32px rgba(52,199,89,0.25);
}
.prof-name-display{font-size:24px;font-weight:700;margin-bottom:4px;cursor:pointer}
.prof-name-display:hover{opacity:0.75}
.prof-name-input{
font-size:22px;font-weight:700;background:rgba(255,255,255,0.08);
border:1px solid rgba(0,122,255,0.5);border-radius:10px;
color:#fff;text-align:center;padding:6px 14px;font-family:inherit;
outline:none;width:100%;max-width:240px;margin:0 auto 4px;display:block;
}
.prof-role{font-size:13px;color:rgba(255,255,255,0.4);margin-bottom:4px}
.prof-name-hint{font-size:11px;color:rgba(255,255,255,0.3);margin-bottom:14px}
.stats{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px;margin-top:6px}
.stat-box{
background:rgba(255,255,255,0.07);border:1px solid rgba(255,255,255,0.1);
border-radius:14px;padding:14px 10px;text-align:center;
}
.stat-n{font-size:22px;font-weight:700;color:#FF9500}
.stat-l{font-size:10px;color:rgba(255,255,255,0.35);margin-top:2px;text-transform:uppercase;letter-spacing:0.3px}
.info-list{border-radius:20px;overflow:hidden;margin-bottom:14px}
.info-row{
display:flex;justify-content:space-between;align-items:center;
padding:13px 18px;font-size:14px;
border-bottom:1px solid rgba(255,255,255,0.07);
}
.info-row:last-child{border:none}
.info-row .lbl{color:rgba(255,255,255,0.4)}
.info-row .val{font-weight:600}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
MODAL (bottom sheet)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#modalBg{
display:none;position:fixed;inset:0;z-index:300;
background:rgba(0,0,0,0.6);
backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
}
#modalBg.active{display:block}
.bottom-sheet{
display:none;position:fixed;bottom:0;left:0;right:0;z-index:301;
border-radius:28px 28px 0 0;
padding:6px 22px calc(28px + env(safe-area-inset-bottom,0px));
max-height:92dvh;overflow-y:auto;
background:rgba(16,16,24,0.88);
backdrop-filter:blur(60px) saturate(200%);
-webkit-backdrop-filter:blur(60px) saturate(200%);
border-top:1px solid rgba(255,255,255,0.12);
border-left:1px solid rgba(255,255,255,0.06);
border-right:1px solid rgba(255,255,255,0.06);
box-shadow:0 -20px 80px rgba(0,0,0,0.7),inset 0 1px 0 rgba(255,255,255,0.15);
}
.bottom-sheet.active{display:block;animation:sheetUp 0.38s cubic-bezier(.32,0.72,0,.95)}
@keyframes sheetUp{from{transform:translateY(100%)}to{transform:translateY(0)}}
.bs-handle{width:40px;height:4px;background:rgba(255,255,255,0.2);border-radius:2px;margin:12px auto 20px}
.bs-title{font-size:20px;font-weight:700;margin-bottom:20px}

/* Form */
.fg{margin-bottom:16px}
.fg label{font-size:11px;font-weight:600;color:rgba(255,255,255,0.35);
text-transform:uppercase;letter-spacing:0.6px;display:block;margin-bottom:8px}
.fg input,.fg textarea{
width:100%;background:rgba(255,255,255,0.07);
border:1px solid rgba(255,255,255,0.12);border-radius:13px;
color:#fff;padding:13px 15px;font-size:15px;font-family:inherit;
outline:none;resize:vertical;transition:all 0.2s;
}
.fg input:focus,.fg textarea:focus{
border-color:rgba(0,122,255,0.6);background:rgba(0,122,255,0.08);
}
.fg textarea{min-height:75px}
input::placeholder,textarea::placeholder{color:rgba(255,255,255,0.2)}

/* Emoji grid */
.egrid{display:grid;grid-template-columns:repeat(7,1fr);gap:5px;margin-bottom:12px}
.eo{
font-size:26px;text-align:center;padding:5px;border-radius:9px;cursor:pointer;
border:2px solid transparent;transition:all 0.14s;
}
.eo.on{border-color:#007AFF;background:rgba(0,122,255,0.18)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
RETURN MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.ret-item{
display:flex;align-items:center;gap:12px;padding:13px;
background:rgba(255,255,255,0.05);border:2px solid transparent;
border-radius:14px;margin-bottom:8px;cursor:pointer;transition:all 0.18s;
}
.ret-item.on{border-color:#FF3B30;background:rgba(255,59,48,0.1)}
.ret-cb{
width:22px;height:22px;border-radius:6px;border:2px solid rgba(255,255,255,0.18);
background:rgba(255,255,255,0.06);display:flex;align-items:center;justify-content:center;
font-size:13px;font-weight:700;transition:all 0.18s;flex-shrink:0;
}
.ret-item.on .ret-cb{background:#FF3B30;border-color:#FF3B30;color:#fff}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
EMPTY + TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.empty{text-align:center;padding:60px 20px;color:rgba(255,255,255,0.35)}
.empty .ei{font-size:56px;margin-bottom:14px;opacity:0.5}
.empty p{font-size:15px;line-height:1.6}

#toast{
position:fixed;top:80px;left:50%;
transform:translateX(-50%) translateY(-10px) scale(0.95);
background:rgba(18,18,28,0.92);
backdrop-filter:blur(40px);-webkit-backdrop-filter:blur(40px);
border:1px solid rgba(255,255,255,0.14);border-radius:14px;
padding:12px 22px;font-size:14px;font-weight:600;z-index:999;
opacity:0;transition:all 0.28s cubic-bezier(.34,1.3,.64,1);
pointer-events:none;white-space:nowrap;
box-shadow:0 8px 36px rgba(0,0,0,0.5);
}
#toast.on{opacity:1;transform:translateX(-50%) translateY(0) scale(1)}

/* PC tweaks */
@media(min-width:600px){
.bottom-sheet{max-width:520px;left:50%;transform:translateX(-50%);border-radius:28px 28px 0 0}
.bottom-sheet.active{animation:sheetUpPC 0.38s cubic-bezier(.32,.72,0,.95)}
@keyframes sheetUpPC{from{transform:translateX(-50%) translateY(100%)}to{transform:translateX(-50%) translateY(0)}}
#scanOverlay .scan-modal{max-width:400px}
}
</style>

</head>
<body>

<div id="wall"></div>

<div id="root">

<!-- â•â• ROLE SCREEN â•â• -->

<div class="screen active" id="roleScreen">
  <div class="rs-logo">ğŸ“¦</div>
  <div class="rs-title">ĞŸĞ’Ğ— Pro</div>
  <div class="rs-sub">Ğ¡Ğ¸Ğ¼ÑƒĞ»ÑÑ‚Ğ¾Ñ€ Ğ¿ÑƒĞ½ĞºÑ‚Ğ° Ğ²Ñ‹Ğ´Ğ°Ñ‡Ğ¸<br>Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ğ²Ğ°Ñˆ Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ</div>

  <div class="rs-profile">
    <div class="rs-ptabs glass" style="border-radius:12px;display:flex">
      <div class="rs-ptab on" onclick="previewSwitch('buyer')">ğŸ›ï¸ ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ</div>
      <div class="rs-ptab"    onclick="previewSwitch('emp')">ğŸ‘· Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº</div>
    </div>
    <div class="rs-pcard glass-card" style="border-radius:18px">
      <div class="rs-pav buyer" id="pvAv">ğŸ›ï¸</div>
      <div>
        <div class="rs-pname" id="pvName">Ğ—Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ°...</div>
        <div class="rs-pdetail" id="pvDetail">ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¸Ğ¼Ñ Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</div>
      </div>
      <div class="rs-pbadge buyer" id="pvBadge">ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ</div>
    </div>
  </div>

  <div class="rs-btns">
    <button class="rs-btn buyer" onclick="setRole('buyer')">
      <span class="rs-bicon">ğŸ›ï¸</span>
      <div>
        <div class="rs-btitle">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ ĞºĞ°Ğº Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ</div>
        <div class="rs-bsub">ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½, ĞºĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°, QRâ€‘ĞºĞ¾Ğ´Ñ‹ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ²</div>
      </div>
    </button>
    <button class="rs-btn emp" onclick="setRole('emp')">
      <span class="rs-bicon">ğŸ‘·</span>
      <div>
        <div class="rs-btitle">Ğ’Ğ¾Ğ¹Ñ‚Ğ¸ ĞºĞ°Ğº ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº</div>
        <div class="rs-bsub">Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ QR, Ğ²Ñ‹Ğ´Ğ°Ğ²Ğ°Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹</div>
      </div>
    </button>
  </div>
</div>

<!-- â•â• APP SCREEN â•â• -->

<div class="screen" id="appScreen">
  <div class="navbar glass" style="border-radius:0">
    <div class="nb-l">
      <span class="nb-logo">ğŸ“¦</span>
      <span class="nb-title">ĞŸĞ’Ğ— Pro</span>
      <span class="nb-badge buyer" id="nbBadge">ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ</span>
    </div>
    <button class="nb-exit" onclick="exitRole()">Ğ’Ñ‹Ğ¹Ñ‚Ğ¸</button>
  </div>

  <div class="pages" id="pages">
    <div class="page active" id="pg-shop"></div>
    <div class="page" id="pg-cart"></div>
    <div class="page" id="pg-orders"></div>
    <div class="page" id="pg-scanner"></div>
    <div class="page" id="pg-eorders"></div>
    <div class="page" id="pg-profile"></div>
  </div>

  <div class="tabbar glass" style="border-radius:0" id="tabbar"></div>
</div>

</div><!-- #root -->

<!-- â•â• SCANNER OVERLAY â•â• -->

<div id="scanOverlay">
  <div class="scan-modal glass-card">
    <div class="scan-modal-head">
      <div class="scan-modal-title">ğŸ“· Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ QRâ€‘ĞºĞ¾Ğ´Ğ°</div>
      <div class="scan-modal-sub">ĞĞ°Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¼ĞµÑ€Ñƒ Ğ½Ğ° QRâ€‘ĞºĞ¾Ğ´ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ°</div>
    </div>
    <div class="vid-container">
      <video id="scanVid" autoplay playsinline muted></video>
      <div class="vid-dim"></div>
      <div class="vid-frame"><div class="vf-inner"></div></div>
      <div class="vid-beam"></div>
    </div>
    <div class="scan-modal-foot">
      <div class="scan-status" id="scanStatus">Ğ˜Ğ½Ğ¸Ñ†Ğ¸Ğ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ñ ĞºĞ°Ğ¼ĞµÑ€Ñ‹â€¦</div>
      <button class="fullbtn blue" id="snapBtn" onclick="snapDecode()" style="margin-top:0;font-size:17px;display:none">
        ğŸ”² Ğ¡ĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ
      </button>
      <button class="fullbtn glass" onclick="stopScan()" style="margin-top:8px">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
    </div>
  </div>
</div>

<!-- â•â• MODAL BG â•â• -->

<div id="modalBg" onclick="closeAllModals()"></div>

<!-- â•â• MODALS â•â• -->

<div class="bottom-sheet" id="mProduct">
  <div class="bs-handle"></div>
  <div class="bs-title" id="mProductTitle">ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€</div>
  <div class="fg"><label>Ğ˜ĞºĞ¾Ğ½ĞºĞ°</label><div class="egrid" id="egrid"></div></div>
  <div class="fg"><label>ĞĞ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ</label><input id="pName" placeholder="ĞĞ°ÑƒÑˆĞ½Ğ¸ĞºĞ¸ Sony"></div>
  <div class="fg"><label>Ğ¦ĞµĞ½Ğ° (Ğ¾Ñ‚ 100 â‚½)</label><input id="pPrice" type="number" min="100" placeholder="1500"></div>
  <div class="fg"><label>ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ</label><textarea id="pDesc" placeholder="ĞšÑ€Ğ°Ñ‚ĞºĞ¾Ğµ Ğ¾Ğ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ..."></textarea></div>
  <button class="fullbtn blue" onclick="saveProduct()">Ğ¡Ğ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ</button>
  <button class="fullbtn glass" onclick="closeModal('mProduct')">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
</div>

<div class="bottom-sheet" id="mCheckout">
  <div class="bs-handle"></div>
  <div class="bs-title">ĞÑ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºĞ°Ğ·Ğ°</div>
  <div id="coItems"></div>
  <div id="coSum"></div>
  <button class="fullbtn blue" onclick="placeOrder()">âœ… ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ´Ğ¸Ñ‚ÑŒ</button>
  <button class="fullbtn glass" onclick="closeModal('mCheckout')">ĞĞ°Ğ·Ğ°Ğ´</button>
</div>

<div class="bottom-sheet" id="mQR">
  <div class="bs-handle"></div>
  <div class="bs-title" id="mQRtitle">QRâ€‘ĞºĞ¾Ğ´ Ğ·Ğ°ĞºĞ°Ğ·Ğ°</div>
  <div class="qr-center">
    <div id="qrBox"></div>
    <div class="qr-info" id="qrInfo"></div>
    <div style="font-size:12px;color:rgba(255,255,255,0.3);margin-bottom:18px">ĞŸĞ¾ĞºĞ°Ğ¶Ğ¸Ñ‚Ğµ ĞºĞ¾Ğ´ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºÑƒ ĞŸĞ’Ğ—</div>
  </div>
  <button class="fullbtn glass" onclick="closeModal('mQR')">Ğ—Ğ°ĞºÑ€Ñ‹Ñ‚ÑŒ</button>
</div>

<div class="bottom-sheet" id="mReturn">
  <div class="bs-handle"></div>
  <div class="bs-title">Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²</div>
  <div style="font-size:13px;color:rgba(255,255,255,0.4);margin-bottom:16px">ĞÑ‚Ğ¼ĞµÑ‚ÑŒÑ‚Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ´Ğ»Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°</div>
  <div id="retList"></div>
  <button class="fullbtn red" onclick="confirmReturn()">ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚</button>
  <button class="fullbtn glass" onclick="closeModal('mReturn')">ĞÑ‚Ğ¼ĞµĞ½Ğ°</button>
</div>

<!-- â•â• TOAST â•â• -->

<div id="toast"></div>

<script>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   AUDIO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _ac = null;
function ac(){
  if(!_ac) _ac = new (window.AudioContext||window.webkitAudioContext)();
  if(_ac.state==='suspended') _ac.resume();
  return _ac;
}
function beep(freq,type,dur,vol,delay=0){
  try{
    const c=ac(),o=c.createOscillator(),g=c.createGain();
    o.connect(g);g.connect(c.destination);
    o.type=type;o.frequency.value=freq;
    const t=c.currentTime+delay;
    g.gain.setValueAtTime(0,t);
    g.gain.linearRampToValueAtTime(vol,t+0.01);
    g.gain.exponentialRampToValueAtTime(0.001,t+dur);
    o.start(t);o.stop(t+dur);
  }catch(e){}
}
const SFX={
  tap:     ()=>beep(440,'sine',0.06,0.08),
  add:     ()=>{beep(523,'sine',0.08,0.1);beep(659,'sine',0.08,0.1,0.08)},
  del:     ()=>beep(300,'sine',0.1,0.09),
  ok:      ()=>{[523,659,784].forEach((f,i)=>beep(f,'sine',0.12,0.11,i*0.08))},
  err:     ()=>beep(160,'sawtooth',0.15,0.11),
  scan:    ()=>{beep(800,'sine',0.06,0.12);beep(1046,'sine',0.1,0.12,0.07)},
  pay:     ()=>{[523,659,784,1047].forEach((f,i)=>beep(f,'sine',0.11,0.1,i*0.06))},
  done:    ()=>{[523,784,1047,880,1319].forEach((f,i)=>beep(f,'triangle',0.13,0.11,i*0.05))}
};
document.addEventListener('pointerdown',()=>{if(!_ac)_ac=new(window.AudioContext||window.webkitAudioContext)()},{once:true});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ROLE = 'buyer';
let CUR  = 'shop';
let products=[
  {id:1,name:'ĞĞ°ÑƒÑˆĞ½Ğ¸ĞºĞ¸ Sony',price:3990,desc:'Ğ‘ĞµÑĞ¿Ñ€Ğ¾Ğ²Ğ¾Ğ´Ğ½Ñ‹Ğµ, ÑˆÑƒĞ¼Ğ¾Ğ¿Ğ¾Ğ´Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ',emoji:'ğŸ§'},
  {id:2,name:'Ğ§ĞµÑ…Ğ¾Ğ» iPhone',price:490,desc:'Ğ¡Ğ¸Ğ»Ğ¸ĞºĞ¾Ğ½Ğ¾Ğ²Ñ‹Ğ¹ Ğ·Ğ°Ñ‰Ğ¸Ñ‚Ğ½Ñ‹Ğ¹ Ñ‡ĞµÑ…Ğ¾Ğ»',emoji:'ğŸ“±'},
  {id:3,name:'Ğ—Ğ°Ñ€ÑĞ´ĞºĞ° 65W',price:890,desc:'Ğ‘Ñ‹ÑÑ‚Ñ€Ğ°Ñ Ğ·Ğ°Ñ€ÑĞ´ĞºĞ° USB-C',emoji:'ğŸ”Œ'},
];
let cart=[];
let orders=[];
let empOrders=[];
let editId=null;
let selEmoji='ğŸ“¦';
let selPay='delivery';
let retOid=null;
let retSel=new Set();
let scanStream=null;
let scanTimer=null;
let pidC=20,oidC=100;
function pid(){return ++pidC}
function oid(){return ++oidC}

/* profiles â€“ editable */
const profiles={
  buyer:{name:'Ğ˜Ğ¼Ñ Ğ¿Ğ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»Ñ',role:'ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ',av:'ğŸ›ï¸'},
  emp:  {name:'Ğ˜Ğ¼Ñ ÑĞ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸ĞºĞ°',role:'Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº ĞŸĞ’Ğ—',av:'ğŸ‘·'}
};

const FMT=n=>n.toLocaleString('ru-RU')+' â‚½';
const CC =()=>cart.reduce((s,i)=>s+i.qty,0);
const CT =()=>cart.reduce((s,i)=>s+i.p.price*i.qty,0);
const EMOJIS=['ğŸ“¦','ğŸ§','ğŸ“±','ğŸ‘Ÿ','ğŸ‘œ','ğŸ®','ğŸ’»','âŒš','ğŸ”Œ','ğŸ“·','ğŸ','ğŸ§´','ğŸ‘—','ğŸ•¹ï¸','ğŸ“š','ğŸ•','ğŸ§¸','ğŸ’¡','ğŸ–¥ï¸','ğŸµ','ğŸ’','ğŸ›ï¸','ğŸ–±ï¸','ğŸ¸','ğŸ‹ï¸'];

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _tt=null;
function toast(msg,dur=2600){
  const el=document.getElementById('toast');
  el.textContent=msg;el.classList.add('on');
  clearTimeout(_tt);_tt=setTimeout(()=>el.classList.remove('on'),dur);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let _openModal=null;
function openModal(id){
  closeAllModals();
  const el=document.getElementById(id);
  document.getElementById('modalBg').classList.add('active');
  el.classList.add('active');
  _openModal=id;
  SFX.tap();
}
function closeModal(id){
  document.getElementById(id)?.classList.remove('active');
  document.getElementById('modalBg').classList.remove('active');
  _openModal=null;
}
function closeAllModals(){
  ['mProduct','mCheckout','mQR','mReturn'].forEach(id=>document.getElementById(id)?.classList.remove('active'));
  document.getElementById('modalBg').classList.remove('active');
  _openModal=null;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ROLE / PREVIEW
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function previewSwitch(r){
  SFX.tap();
  const tabs=document.querySelectorAll('.rs-ptab');
  tabs[0].classList.toggle('on',r==='buyer');
  tabs[1].classList.toggle('on',r==='emp');
  const p=profiles[r];
  document.getElementById('pvAv').textContent=p.av;
  document.getElementById('pvAv').className='rs-pav '+(r==='buyer'?'buyer':'emp');
  document.getElementById('pvName').textContent=p.name;
  document.getElementById('pvBadge').textContent=r==='buyer'?'ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ':'Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº';
  document.getElementById('pvBadge').className='rs-pbadge '+(r==='buyer'?'buyer':'emp');
}
previewSwitch('buyer');

function setRole(r){
  SFX.ok();
  ROLE=r;
  document.getElementById('roleScreen').classList.remove('active');
  document.getElementById('appScreen').classList.add('active');
  const b=document.getElementById('nbBadge');
  b.textContent=r==='buyer'?'ğŸ›ï¸ ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ':'ğŸ‘· Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº';
  b.className='nb-badge '+(r==='buyer'?'buyer':'emp');
  CUR=r==='buyer'?'shop':'scanner';
  buildTabs();renderPage(CUR);
}

function exitRole(){
  SFX.tap();
  stopScan();
  document.getElementById('appScreen').classList.remove('active');
  document.getElementById('roleScreen').classList.add('active');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TABS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const BTABS=[
  {id:'shop',   icon:'ğŸª',label:'ĞœĞ°Ğ³Ğ°Ğ·Ğ¸Ğ½'},
  {id:'cart',   icon:'ğŸ›’',label:'ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°',  bdg:'cart'},
  {id:'orders', icon:'ğŸ“‹',label:'Ğ—Ğ°ĞºĞ°Ğ·Ñ‹'},
  {id:'profile',icon:'ğŸ‘¤',label:'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'},
];
const ETABS=[
  {id:'scanner', icon:'ğŸ“·',label:'Ğ¡ĞºĞ°Ğ½ĞµÑ€'},
  {id:'eorders', icon:'ğŸ“‹',label:'Ğ—Ğ°ĞºĞ°Ğ·Ñ‹',bdg:'emp'},
  {id:'profile', icon:'ğŸ‘¤',label:'ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ'},
];

function buildTabs(){
  const tabs=ROLE==='buyer'?BTABS:ETABS;
  document.getElementById('tabbar').innerHTML=tabs.map(t=>{
    let bdg='';
    if(t.bdg==='cart'&&CC()>0) bdg=`<div class="tb-badge">${CC()}</div>`;
    if(t.bdg==='emp'){const n=empOrders.filter(o=>o.status!=='done').length;if(n)bdg=`<div class="tb-badge">${n}</div>`;}
    return `<div class="tb-item${CUR===t.id?' on':''}" onclick="navTo('${t.id}')">
      <span class="tb-icon">${t.icon}</span>
      <span class="tb-label">${t.label}</span>
      ${bdg}
    </div>`;
  }).join('');
}

function navTo(id){
  SFX.tap();
  renderPage(id);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PAGE RENDER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function renderPage(id){
  CUR=id;
  buildTabs();
  // clear all pages
  ['shop','cart','orders','scanner','eorders','profile'].forEach(p=>{
    const el=document.getElementById('pg-'+p);
    if(el){el.classList.remove('active');el.innerHTML='';}
  });
  const pg=document.getElementById('pg-'+id);
  if(!pg)return;
  if(id==='shop')    pg.innerHTML=shopHTML();
  if(id==='cart')    pg.innerHTML=cartHTML();
  if(id==='orders')  pg.innerHTML=ordersHTML();
  if(id==='scanner') pg.innerHTML=scannerHTML();
  if(id==='eorders') pg.innerHTML=eordersHTML();
  if(id==='profile') pg.innerHTML=profileHTML();
  pg.classList.add('active');
  pg.scrollTop=0;

  // FAB
  document.getElementById('_fab')?.remove();
  if(id==='shop'){
    const f=document.createElement('button');
    f.className='fab';f.id='_fab';f.innerHTML='+';
    f.onclick=()=>{SFX.tap();openProductModal(null)};
    document.body.appendChild(f);
  }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SHOP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function shopHTML(){
  if(!products.length) return`<div class="empty"><div class="ei">ğŸª</div><p>ĞĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ².<br>ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ + Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ</p></div>`;
  return`<div class="sec-label">Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹ Â· ${products.length}</div>
  <div class="pgrid">${products.map(cardHTML).join('')}</div>`;
}
function cardHTML(p){
  return`<div class="pcard glass-card">
    <div class="pcard-img">${p.emoji}</div>
    <div class="pcard-body">
      <div class="pcard-name">${p.name}</div>
      <div class="pcard-desc">${p.desc}</div>
      <div class="pcard-price">${FMT(p.price)}</div>
    </div>
    <div class="pcard-acts">
      <button class="btn btn-glass" onclick="openProductModal(${p.id})">âœï¸</button>
      <button class="btn btn-red"   onclick="delProduct(${p.id})">ğŸ—‘ï¸</button>
      <button class="btn btn-blue flex" onclick="addCart(${p.id})">+ ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ°</button>
    </div>
  </div>`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PRODUCT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openProductModal(id){
  editId=id;
  const p=id?products.find(x=>x.id===id):null;
  document.getElementById('mProductTitle').textContent=id?'âœï¸ Ğ ĞµĞ´Ğ°ĞºÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ':'âœ¨ ĞĞ¾Ğ²Ñ‹Ğ¹ Ñ‚Ğ¾Ğ²Ğ°Ñ€';
  document.getElementById('pName').value=p?p.name:'';
  document.getElementById('pPrice').value=p?p.price:'';
  document.getElementById('pDesc').value=p?p.desc:'';
  selEmoji=p?p.emoji:'ğŸ“¦';
  buildEGrid();
  openModal('mProduct');
}
function buildEGrid(){
  document.getElementById('egrid').innerHTML=EMOJIS.map(e=>
    `<div class="eo${e===selEmoji?' on':''}" onclick="pickEmoji('${e}')">${e}</div>`
  ).join('');
}
function pickEmoji(e){SFX.tap();selEmoji=e;buildEGrid()}
function saveProduct(){
  const name=document.getElementById('pName').value.trim();
  const price=parseInt(document.getElementById('pPrice').value);
  const desc=document.getElementById('pDesc').value.trim();
  if(!name){SFX.err();return toast('âš ï¸ Ğ’Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğµ')}
  if(!price||price<100){SFX.err();return toast('âš ï¸ Ğ¦ĞµĞ½Ğ° Ğ¾Ñ‚ 100 â‚½')}
  if(editId){
    Object.assign(products.find(x=>x.id===editId),{name,price,desc,emoji:selEmoji});
    SFX.ok();toast('âœ… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¾');
  }else{
    products.push({id:pid(),name,price,desc,emoji:selEmoji});
    SFX.add();toast('âœ… Ğ¢Ğ¾Ğ²Ğ°Ñ€ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½');
  }
  closeModal('mProduct');renderPage('shop');
}
function delProduct(id){
  if(!confirm('Ğ£Ğ´Ğ°Ğ»Ğ¸Ñ‚ÑŒ Ñ‚Ğ¾Ğ²Ğ°Ñ€?'))return;
  SFX.del();
  products=products.filter(p=>p.id!==id);
  cart=cart.filter(i=>i.p.id!==id);
  renderPage('shop');toast('ğŸ—‘ï¸ Ğ£Ğ´Ğ°Ğ»ĞµĞ½Ğ¾');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CART
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function addCart(id){
  const p=products.find(x=>x.id===id);
  const e=cart.find(i=>i.p.id===id);
  if(e)e.qty++;else cart.push({p,qty:1});
  SFX.add();toast(`ğŸ›’ ${p.name}`);buildTabs();
}
function cartHTML(){
  if(!cart.length)return`<div class="empty"><div class="ei">ğŸ›’</div><p>ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Ğ¿ÑƒÑÑ‚Ğ°</p></div>`;
  return`<div class="sec-label">ĞšĞ¾Ñ€Ğ·Ğ¸Ğ½Ğ° Â· ${CC()} Ğ¿Ğ¾Ğ·.</div>
  ${cart.map(i=>`<div class="cart-item glass-card">
    <div class="ci-em">${i.p.emoji}</div>
    <div class="ci-info">
      <div class="ci-name">${i.p.name}</div>
      <div class="ci-price">${FMT(i.p.price)} Ğ·Ğ° ÑˆÑ‚.</div>
      <div class="qty-row">
        <button class="qbtn" onclick="chQty(${i.p.id},-1)">âˆ’</button>
        <span class="qnum">${i.qty}</span>
        <button class="qbtn" onclick="chQty(${i.p.id},1)">+</button>
        <button class="qbtn" onclick="remCart(${i.p.id})" style="font-size:13px">ğŸ—‘ï¸</button>
      </div>
    </div>
    <div class="ci-total">${FMT(i.p.price*i.qty)}</div>
  </div>`).join('')}
  <div class="cart-summary glass-card">
    <div class="cs-row"><span class="l">ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹:</span><span style="font-weight:700">${CC()}</span></div>
    <div style="height:1px;background:rgba(255,255,255,0.07);margin:8px 0"></div>
    <div class="cs-row"><span class="l">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾:</span><span class="cs-total">${FMT(CT())}</span></div>
    <div style="margin-top:16px;font-size:11px;font-weight:600;color:rgba(255,255,255,0.3);text-transform:uppercase;letter-spacing:.5px;margin-bottom:12px">Ğ¡Ğ¿Ğ¾ÑĞ¾Ğ± Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹</div>
    <div class="pay-opts">
      <button class="pay-opt${selPay==='delivery'?' on':''}" onclick="setPay('delivery')">
        <span class="pi">ğŸ’µ</span>ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸
      </button>
      <button class="pay-opt${selPay==='online'?' on':''}" onclick="setPay('online')">
        <span class="pi">ğŸ’³</span>ĞĞ½Ğ»Ğ°Ğ¹Ğ½
      </button>
    </div>
    <button class="fullbtn blue" onclick="openCheckout()">ğŸš€ ĞÑ„Ğ¾Ñ€Ğ¼Ğ¸Ñ‚ÑŒ Ğ·Ğ°ĞºĞ°Ğ·</button>
  </div>`;
}
function chQty(id,d){
  SFX.tap();
  const i=cart.find(x=>x.p.id===id);if(!i)return;
  i.qty+=d;
  if(i.qty<=0){cart=cart.filter(x=>x.p.id!==id);SFX.del();}
  renderPage('cart');
}
function remCart(id){SFX.del();cart=cart.filter(i=>i.p.id!==id);renderPage('cart')}
function setPay(p){SFX.tap();selPay=p;renderPage('cart')}
function openCheckout(){
  if(!cart.length)return;
  document.getElementById('coItems').innerHTML=cart.map(i=>
    `<div style="display:flex;justify-content:space-between;align-items:center;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.07);font-size:14px">
      <span>${i.p.emoji} ${i.p.name} <span style="color:rgba(255,255,255,0.35)">Ã—${i.qty}</span></span>
      <span style="font-weight:700;color:#FF9500">${FMT(i.p.price*i.qty)}</span>
    </div>`).join('');
  document.getElementById('coSum').innerHTML=
    `<div style="background:rgba(0,122,255,0.08);border:1px solid rgba(0,122,255,0.2);border-radius:14px;padding:16px;margin-top:14px">
      <div class="cs-row"><span class="l">ĞŸĞ¾Ğ·Ğ¸Ñ†Ğ¸Ğ¹:</span><span style="font-weight:700">${CC()}</span></div>
      <div class="cs-row"><span class="l">ĞĞ¿Ğ»Ğ°Ñ‚Ğ°:</span><span style="font-weight:700">${selPay==='delivery'?'ğŸ’µ ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸':'ğŸ’³ ĞĞ½Ğ»Ğ°Ğ¹Ğ½'}</span></div>
      <div style="height:1px;background:rgba(255,255,255,0.08);margin:8px 0"></div>
      <div class="cs-row"><span class="l">Ğ˜Ñ‚Ğ¾Ğ³Ğ¾:</span><span class="cs-total">${FMT(CT())}</span></div>
    </div>`;
  openModal('mCheckout');
}
function placeOrder(){
  SFX.pay();
  const cell=String(Math.floor(Math.random()*89+10));
  orders.push({
    id:oid(),items:cart.map(i=>({...i})),
    total:CT(),payment:selPay,status:'pending',
    cell,scanned:[],returned:[]
  });
  cart=[];closeModal('mCheckout');
  toast('ğŸ‰ Ğ—Ğ°ĞºĞ°Ğ· Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½!');renderPage('orders');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ORDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function ordersHTML(){
  if(!orders.length)return`<div class="empty"><div class="ei">ğŸ“‹</div><p>Ğ—Ğ°ĞºĞ°Ğ·Ğ¾Ğ² Ğ¿Ğ¾ĞºĞ° Ğ½ĞµÑ‚</p></div>`;
  return`<div class="sec-label">ĞœĞ¾Ğ¸ Ğ·Ğ°ĞºĞ°Ğ·Ñ‹ Â· ${orders.length}</div>
  ${orders.slice().reverse().map(o=>{
    const done=o.status==='ready';
    return`<div class="order-card glass-card">
      <div class="oc-head">
        <div class="oc-num">Ğ—Ğ°ĞºĞ°Ğ· #${o.id}</div>
        <div class="oc-status ${done?'st-done':'st-wait'}">${done?'âœ… Ğ’Ñ‹Ğ´Ğ°Ğ½':'â³ ĞĞ¶Ğ¸Ğ´Ğ°Ğ½Ğ¸Ğµ'}</div>
      </div>
      <div class="oc-meta">
        <div class="oc-badge">ğŸ“¦ Ğ¯Ñ‡ĞµĞ¹ĞºĞ° ${o.cell}</div>
        <div class="oc-badge">${o.payment==='delivery'?'ğŸ’µ ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸':'ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ¾'}</div>
        <div class="oc-badge">${o.items.reduce((s,i)=>s+i.qty,0)} Ğ¿Ğ¾Ğ·.</div>
      </div>
      <div class="oc-price">${FMT(o.total)}</div>
      <button class="fullbtn blue" style="margin-top:0" onclick="showQR(${o.id})">ğŸ”² ĞŸĞ¾ĞºĞ°Ğ·Ğ°Ñ‚ÑŒ QRâ€‘ĞºĞ¾Ğ´</button>
    </div>`;
  }).join('')}`;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   QR CODE GENERATOR (pure JS)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function showQR(orderId){
  const o=orders.find(x=>x.id===orderId);if(!o)return;
  SFX.scan();
  const data=JSON.stringify({
    orderId:o.id,cell:o.cell,total:o.total,payment:o.payment,
    count:o.items.reduce((s,i)=>s+i.qty,0),
    items:o.items.map(i=>({id:i.p.id,name:i.p.name,price:i.p.price,qty:i.qty,emoji:i.p.emoji}))
  });
  document.getElementById('mQRtitle').textContent=`ğŸ”² Ğ—Ğ°ĞºĞ°Ğ· #${o.id}`;
  document.getElementById('qrInfo').textContent=
    `${o.items.reduce((s,i)=>s+i.qty,0)} Ğ¿Ğ¾Ğ·. Â· Ğ¯Ñ‡ĞµĞ¹ĞºĞ° ${o.cell} Â· ${FMT(o.total)}`;
  openModal('mQR');
  setTimeout(()=>{
    const box=document.getElementById('qrBox');
    box.innerHTML='';
    const c=document.createElement('canvas');
    c.width=c.height=256;
    box.appendChild(c);
    renderQR(c,data);
  },80);
}

/* â”€â”€ Minimal self-contained QR encoder â”€â”€ */
function renderQR(canvas,text){
  const bytes=toUTF8(text);
  const ver=findVersion(bytes.length);
  if(!ver){canvas.getContext('2d').fillText('ĞÑˆĞ¸Ğ±ĞºĞ°',10,20);return;}
  const N=ver*4+17;
  const mat=makeMatrix(N,ver,bytes);
  const ctx=canvas.getContext('2d');
  const sz=canvas.width,cell=sz/N;
  ctx.fillStyle='#fff';ctx.fillRect(0,0,sz,sz);
  ctx.fillStyle='#000';
  for(let r=0;r<N;r++)
    for(let c=0;c<N;c++)
      if(mat[r][c]===1)
        ctx.fillRect(~~(c*cell),~~(r*cell),Math.ceil(cell),Math.ceil(cell));
}
function toUTF8(s){
  const b=[];
  for(let i=0;i<s.length;i++){
    const c=s.charCodeAt(i);
    if(c<128)b.push(c);
    else if(c<2048){b.push(192|(c>>6));b.push(128|(c&63));}
    else{b.push(224|(c>>12));b.push(128|((c>>6)&63));b.push(128|(c&63));}
  }
  return b;
}
/* ECC=M byte-mode capacities */
const QR_CAP=[0,14,26,42,62,84,106,122,154,180,213,251,287,331,365,415,453,507,563,627,669,714,782,860,914,1000,1062,1128,1193,1267,1373,1455,1541,1631,1725,1812,1914,1992,2102,2216,2334];
function findVersion(n){for(let v=1;v<=40;v++)if(QR_CAP[v]>=n+3)return v;return null}
/* Total data codewords ECC=M */
const QR_DC=[0,16,28,44,64,86,108,124,154,182,216,254,290,334,365,415,453,507,563,627,669,714,782,860,914,1000,1062,1128,1193,1267,1373,1455,1541,1631,1725,1812,1914,1992,2102,2216,2334];
/* Alignment pattern centers */
const QR_AL=[null,[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]];
function makeMatrix(N,V,bytes){
  const m=Array.from({length:N},()=>new Int8Array(N).fill(-1));
  /* finder */
  function finder(r,c){
    for(let dr=-1;dr<=7;dr++)for(let dc=-1;dc<=7;dc++){
      const rr=r+dr,cc=c+dc;if(rr<0||rr>=N||cc<0||cc>=N)continue;
      m[rr][cc]=(dr>=0&&dr<=6&&dc>=0&&dc<=6&&(dr===0||dr===6||dc===0||dc===6||(dr>=2&&dr<=4&&dc>=2&&dc<=4)))?1:0;
    }
  }
  finder(0,0);finder(0,N-7);finder(N-7,0);
  /* timing */
  for(let i=8;i<N-8;i++){if(m[6][i]<0)m[6][i]=i%2?0:1;if(m[i][6]<0)m[i][6]=i%2?0:1;}
  m[N-8][8]=1;
  /* alignment */
  if(V>=2&&QR_AL[V]){
    const a=QR_AL[V];
    for(const r of a)for(const c of a){
      if(m[r][c]>=0)continue;
      for(let dr=-2;dr<=2;dr++)for(let dc=-2;dc<=2;dc++)
        m[r+dr][c+dc]=(Math.abs(dr)===2||Math.abs(dc)===2||(dr===0&&dc===0))?1:0;
    }
  }
  /* data bytes */
  const db=[];
  db.push(0x40|(bytes.length>>4));
  db.push(((bytes.length&15)<<4)|(bytes.length?bytes[0]>>4:0));
  for(let i=0;i<bytes.length;i++){
    const lo=bytes[i]&15,hi=i+1<bytes.length?bytes[i+1]>>4:0;
    db.push((lo<<4)|hi);
  }
  const tot=QR_DC[V]||128;
  while(db.length<tot)db.push(db.length%2?0x11:0xEC);
  /* bits */
  const bits=[];for(const b of db)for(let i=7;i>=0;i--)bits.push((b>>i)&1);
  /* zigzag */
  let bi=0,up=true;
  for(let col=N-1;col>=1;col-=2){
    if(col===6)col--;
    for(let i=0;i<N;i++){
      const row=up?N-1-i:i;
      for(const dc of[0,-1]){const c=col+dc;if(m[row][c]<0)m[row][c]=bi<bits.length?bits[bi++]:0;}
    }
    up=!up;
  }
  /* mask 0: (r+c)%2===0 */
  for(let r=0;r<N;r++)for(let c=0;c<N;c++){
    const fixed=(r<9&&c<9)||(r<9&&c>=N-8)||(r>=N-8&&c<9)||r===6||c===6;
    if(!fixed&&m[r][c]>=0&&(r+c)%2===0)m[r][c]^=1;
  }
  /* format string ECC=M mask=0: 101010000010010 */
  const fs=[1,0,1,0,1,0,0,0,0,0,1,0,0,1,0];
  const fp=[[8,0],[8,1],[8,2],[8,3],[8,4],[8,5],[8,7],[8,8],[7,8],[5,8],[4,8],[3,8],[2,8],[1,8],[0,8]];
  for(let i=0;i<15;i++){
    m[fp[i][0]][fp[i][1]]=fs[i];
    if(i<7)m[N-1-i][8]=fs[i];
    if(i>=7)m[8][N-15+i]=fs[i];
  }
  return m;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCANNER
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function scannerHTML(){
  const hist=empOrders.slice(-3).reverse();
  return`<div class="scan-hero glass-card">
    <div class="scan-icon">ğŸ“·</div>
    <div class="scan-title">Ğ¡ĞºĞ°Ğ½ĞµÑ€ QRâ€‘ĞºĞ¾Ğ´Ğ¾Ğ²</div>
    <div class="scan-sub">ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ¸ Ğ¿Ğ¾Ğ´Ğ½ĞµÑĞ¸Ñ‚Ğµ<br>QRâ€‘ĞºĞ¾Ğ´ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ğ° Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ</div>
    <button class="fullbtn blue" onclick="startScan()" style="margin:0;max-width:280px">ğŸ“· ĞÑ‚ĞºÑ€Ñ‹Ñ‚ÑŒ ĞºĞ°Ğ¼ĞµÑ€Ñƒ</button>
  </div>
  ${hist.length?`<div class="sec-label" style="margin-top:16px">ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğµ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ</div>
  ${hist.map(o=>`<div class="glass-card" style="border-radius:16px;padding:14px;display:flex;align-items:center;gap:12px;margin-bottom:10px">
    <span style="font-size:28px">ğŸ“¦</span>
    <div style="flex:1"><div style="font-weight:600">Ğ—Ğ°ĞºĞ°Ğ· #${o.id}</div>
    <div style="font-size:12px;color:rgba(255,255,255,0.35)">Ğ¯Ñ‡ĞµĞ¹ĞºĞ° ${o.cell} Â· ${FMT(o.total)}</div></div>
    <div style="font-size:12px;font-weight:600;color:${o.status==='done'?'#34C759':'#FF9500'}">${o.status==='done'?'Ğ’Ñ‹Ğ´Ğ°Ğ½':'ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½'}</div>
  </div>`).join('')}`:''}`;
}

let _qrCanvas=null,_qrCtx=null;

function startScan(){
  SFX.tap();
  const ov=document.getElementById('scanOverlay');
  ov.classList.add('active');
  setStatus('Ğ—Ğ°Ğ¿Ñ€Ğ¾Ñ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ° Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµâ€¦');
  showSnapBtn(false);

  if(!_qrCanvas){
    _qrCanvas=document.createElement('canvas');
    _qrCtx=_qrCanvas.getContext('2d',{willReadFrequently:true});
  }

  navigator.mediaDevices.getUserMedia({
    video:{
      facingMode:{ideal:'environment'},
      width:{ideal:1920},height:{ideal:1080}
    }
  })
  .then(stream=>{
    scanStream=stream;
    const vid=document.getElementById('scanVid');
    vid.srcObject=stream;
    vid.play().catch(()=>{});

    vid.onloadedmetadata=()=>{
      vid.play().catch(()=>{});
    };

    // Show snap button + start auto-scan after 1s
    setTimeout(()=>{
      setStatus('ĞĞ°Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¼ĞµÑ€Ñƒ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ');
      showSnapBtn(true);
      // Also try auto-scan every 300ms
      clearInterval(scanTimer);
      scanTimer=setInterval(()=>autoTryDecode(vid),300);
    },1200);
  })
  .catch(err=>{
    setStatus('');
    ov.classList.remove('active');
    SFX.err();
    if(err.name==='NotAllowedError') toast('âš ï¸ Ğ Ğ°Ğ·Ñ€ĞµÑˆĞ¸Ñ‚Ğµ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğº ĞºĞ°Ğ¼ĞµÑ€Ğµ Ğ² Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ°Ñ… Ğ±Ñ€Ğ°ÑƒĞ·ĞµÑ€Ğ°');
    else if(err.name==='NotFoundError') toast('âš ï¸ ĞšĞ°Ğ¼ĞµÑ€Ğ° Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½Ğ°');
    else toast('âš ï¸ ĞÑˆĞ¸Ğ±ĞºĞ°: '+err.message);
  });
}

function showSnapBtn(show){
  const btn=document.getElementById('snapBtn');
  if(btn) btn.style.display=show?'block':'none';
}

// Auto-try silently (no feedback if fails)
function autoTryDecode(vid){
  if(!vid||!vid.videoWidth||vid.paused||vid.ended)return;
  const result=grabAndDecode(vid);
  if(result){
    clearInterval(scanTimer);scanTimer=null;
    stopScan();
    processQR(result);
  }
}

// Manual snap button â€” shows feedback
function snapDecode(){
  SFX.tap();
  const vid=document.getElementById('scanVid');
  if(!vid||!vid.videoWidth){
    setStatus('âŒ ĞšĞ°Ğ¼ĞµÑ€Ğ° ĞµÑ‰Ñ‘ Ğ½Ğµ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ°, Ğ¿Ğ¾Ğ´Ğ¾Ğ¶Ğ´Ğ¸Ñ‚Ğµ...');
    return;
  }
  setStatus('â³ ĞĞ½Ğ°Ğ»Ğ¸Ğ·Ğ¸Ñ€ÑƒÑ...');
  // Try multiple times with slight delay for focus
  let attempts=0;
  const tryDecode=()=>{
    attempts++;
    const result=grabAndDecode(vid);
    if(result){
      clearInterval(scanTimer);scanTimer=null;
      stopScan();
      processQR(result);
      return;
    }
    if(attempts<4){
      setStatus(`â³ ĞŸĞ¾Ğ¿Ñ‹Ñ‚ĞºĞ° ${attempts}/4...`);
      setTimeout(tryDecode,300);
    }else{
      setStatus('âŒ QR Ğ½Ğµ Ğ½Ğ°Ğ¹Ğ´ĞµĞ½. ĞŸĞ¾Ğ´Ğ½ĞµÑĞ¸Ñ‚Ğµ Ğ±Ğ»Ğ¸Ğ¶Ğµ Ğ¸ Ğ¿Ğ¾Ğ¿Ñ€Ğ¾Ğ±ÑƒĞ¹Ñ‚Ğµ ÑĞ½Ğ¾Ğ²Ğ°');
      setTimeout(()=>setStatus('ĞĞ°Ğ²ĞµĞ´Ğ¸Ñ‚Ğµ ĞºĞ°Ğ¼ĞµÑ€Ñƒ Ğ¸ Ğ½Ğ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ ĞºĞ½Ğ¾Ğ¿ĞºÑƒ Ğ½Ğ¸Ğ¶Ğµ'),2500);
    }
  };
  tryDecode();
}

function grabAndDecode(vid){
  try{
    _qrCanvas.width=vid.videoWidth;
    _qrCanvas.height=vid.videoHeight;
    _qrCtx.drawImage(vid,0,0);
    const img=_qrCtx.getImageData(0,0,_qrCanvas.width,_qrCanvas.height);
    // Try normal
    let code=jsQR(img.data,img.width,img.height,{inversionAttempts:'dontInvert'});
    if(code&&code.data)return code.data;
    // Try inverted
    code=jsQR(img.data,img.width,img.height,{inversionAttempts:'onlyInvert'});
    if(code&&code.data)return code.data;
    // Try both
    code=jsQR(img.data,img.width,img.height,{inversionAttempts:'attemptBoth'});
    if(code&&code.data)return code.data;
  }catch(e){}
  return null;
}

function stopScan(){
  clearInterval(scanTimer);scanTimer=null;
  if(scanStream){scanStream.getTracks().forEach(t=>t.stop());scanStream=null;}
  const vid=document.getElementById('scanVid');
  vid.srcObject=null;
  showSnapBtn(false);
  document.getElementById('scanOverlay').classList.remove('active');
}

function setStatus(t){
  const el=document.getElementById('scanStatus');
  if(el)el.textContent=t;
}

function processQR(raw){
  let data;
  try{data=JSON.parse(raw);}catch(e){SFX.err();toast('âš ï¸ ĞĞµÑ‡Ğ¸Ñ‚Ğ°ĞµĞ¼Ñ‹Ğ¹ QRâ€‘ĞºĞ¾Ğ´');return;}
  const id=data.orderId||data.id;
  if(!id){SFX.err();toast('âš ï¸ QR Ğ½Ğµ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ñ‚ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ… Ğ·Ğ°ĞºĞ°Ğ·Ğ°');return;}
  if(!empOrders.find(o=>o.id===id)){
    empOrders.push({
      id,cell:data.cell,total:data.total,payment:data.payment,
      status:'pending',items:data.items||[],scanned:[],returned:[]
    });
  }
  SFX.scan();
  const n=data.count||(data.items||[]).reduce((s,i)=>s+i.qty,0);
  speak(`Ğ¯Ñ‡ĞµĞ¹ĞºĞ° ${data.cell}. ${n} ${n===1?'Ñ‚Ğ¾Ğ²Ğ°Ñ€':n<5?'Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ°':'Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²'}. ${data.payment==='delivery'?'ĞĞ¿Ğ»Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸':'ĞĞ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ¾ Ğ¾Ğ½Ğ»Ğ°Ğ¹Ğ½'}.`);
  toast(`ğŸ“¦ Ğ—Ğ°ĞºĞ°Ğ· #${id} Ğ·Ğ°Ğ³Ñ€ÑƒĞ¶ĞµĞ½`);
  renderPage('eorders');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   EMP ORDERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function eordersHTML(){
  const active=empOrders.filter(o=>o.status!=='done');
  const done=empOrders.filter(o=>o.status==='done');
  if(!empOrders.length)return`<div class="empty"><div class="ei">ğŸ“‹</div><p>ĞĞµÑ‚ Ğ·Ğ°ĞºĞ°Ğ·Ğ¾Ğ².<br>ĞÑ‚ÑĞºĞ°Ğ½Ğ¸Ñ€ÑƒĞ¹Ñ‚Ğµ QRâ€‘ĞºĞ¾Ğ´</p></div>`;
  let html='';
  if(active.length){html+=`<div class="sec-label">ĞĞºÑ‚Ğ¸Ğ²Ğ½Ñ‹Ğµ Â· ${active.length}</div>`;html+=active.map(empCardHTML).join('');}
  if(done.length){html+=`<div class="sec-label" style="margin-top:20px">Ğ—Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½Ğ½Ñ‹Ğµ Â· ${done.length}</div>`;html+=done.map(o=>`<div style="opacity:0.5">${empCardHTML(o)}</div>`).join('');}
  return html;
}
function empCardHTML(o){
  const sc=o.scanned||[],rt=o.returned||[];
  const total=o.items.reduce((s,i)=>s+i.price*i.qty,0);
  const allDone=o.items.every(i=>sc.includes(i.id)||rt.includes(i.id));
  const prog=Math.round((sc.length+rt.length)/Math.max(o.items.length,1)*100);
  let acts='';
  if(o.status==='done') acts=`<div style="text-align:center;color:#34C759;font-weight:600;padding:10px">âœ… Ğ—Ğ°Ğ²ĞµÑ€ÑˆÑ‘Ğ½</div>`;
  else if(allDone) acts=`<div class="ec-acts"><button class="btn btn-red" onclick="openReturn(${o.id})">â†©ï¸ Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚</button><button class="btn btn-green flex" onclick="completeOrder(${o.id})">âœ… Ğ—Ğ°Ğ²ĞµÑ€ÑˆĞ¸Ñ‚ÑŒ</button></div>`;
  else acts=`<button class="btn btn-red" onclick="openReturn(${o.id})">â†©ï¸ Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚</button>`;
  return`<div class="emp-card glass-card">
    <div class="ec-head">
      <div class="ec-title">Ğ—Ğ°ĞºĞ°Ğ· #${o.id}</div>
      <div class="oc-status ${o.status==='done'?'st-done':'st-wait'}">${o.status==='done'?'Ğ’Ñ‹Ğ´Ğ°Ğ½':'ĞĞºÑ‚Ğ¸Ğ²ĞµĞ½'}</div>
    </div>
    <div class="ec-meta">
      <div class="ec-badge">ğŸ“¦ Ğ¯Ñ‡ĞµĞ¹ĞºĞ° ${o.cell}</div>
      <div class="ec-badge">${o.payment==='delivery'?'ğŸ’µ ĞŸÑ€Ğ¸ Ğ¿Ğ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğ¸':'ğŸ’³ ĞĞ¿Ğ»Ğ°Ñ‡ĞµĞ½Ğ¾'}</div>
      <div class="ec-badge">ğŸ’° ${FMT(total)}</div>
    </div>
    <div class="prog-wrap"><div class="prog-bar" style="width:${prog}%"></div></div>
    <div class="sec-label" style="margin-bottom:8px">Ğ¢Ğ¾Ğ²Ğ°Ñ€Ñ‹ ${sc.length+rt.length}/${o.items.length}</div>
    <div class="items-list">
      ${o.items.map(i=>{
        const isS=sc.includes(i.id),isR=rt.includes(i.id);
        const cls=isS?'item-row done-s':isR?'item-row done-r':'item-row';
        const mark=isS?'âœ…':isR?'â†©ï¸':'';
        const btn=(!isS&&!isR&&o.status!=='done')?`<button class="btn btn-blue" style="font-size:11px;padding:7px 12px" onclick="markItem(${o.id},${i.id})">Ğ’Ñ‹Ğ´Ğ°Ñ‚ÑŒ</button>`:'';
        return`<div class="${cls}">
          <div class="item-em">${i.emoji}</div>
          <div class="item-info"><div class="item-name">${i.name}</div><div class="item-price">${FMT(i.price)} Ã— ${i.qty}</div></div>
          <span class="item-mark">${mark}</span>${btn}
        </div>`;
      }).join('')}
    </div>
    ${acts}
  </div>`;
}
function markItem(oid,iid){
  const o=empOrders.find(x=>x.id===oid);if(!o)return;
  if(!o.scanned)o.scanned=[];
  if(o.scanned.includes(iid))return;
  o.scanned.push(iid);SFX.scan();
  const done=o.items.every(i=>o.scanned.includes(i.id)||(o.returned||[]).includes(i.id));
  if(done){SFX.ok();toast('ğŸ‰ Ğ’ÑĞµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹ Ğ²Ñ‹Ğ´Ğ°Ğ½Ñ‹!')}else toast('âœ… ĞÑ‚Ğ¼ĞµÑ‡ĞµĞ½Ğ¾');
  renderPage('eorders');
}
function openReturn(oid){
  SFX.tap();retOid=oid;retSel=new Set();
  const o=empOrders.find(x=>x.id===oid);
  const list=o.items.filter(i=>!(o.returned||[]).includes(i.id));
  document.getElementById('retList').innerHTML=!list.length
    ?'<p style="color:rgba(255,255,255,0.4);padding:12px">ĞĞµÑ‚ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ² Ğ´Ğ»Ñ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚Ğ°</p>'
    :list.map(i=>`<div class="ret-item" id="ri${i.id}" onclick="togRet(${i.id})">
        <div class="ret-cb" id="rc${i.id}"></div>
        <div style="font-size:24px">${i.emoji}</div>
        <div style="flex:1"><div style="font-weight:600;font-size:14px">${i.name}</div>
        <div style="font-size:12px;color:rgba(255,255,255,0.35)">${FMT(i.price)} Ã— ${i.qty}</div></div>
      </div>`).join('');
  openModal('mReturn');
}
function togRet(id){
  SFX.tap();retSel.has(id)?retSel.delete(id):retSel.add(id);
  document.getElementById(`ri${id}`)?.classList.toggle('on',retSel.has(id));
  const cb=document.getElementById(`rc${id}`);if(cb)cb.textContent=retSel.has(id)?'âœ“':'';
}
function confirmReturn(){
  if(!retSel.size){SFX.err();return toast('âš ï¸ Ğ’Ñ‹Ğ±ĞµÑ€Ğ¸Ñ‚Ğµ Ñ‚Ğ¾Ğ²Ğ°Ñ€Ñ‹')}
  const o=empOrders.find(x=>x.id===retOid);
  if(!o.returned)o.returned=[];
  retSel.forEach(id=>{
    if(!o.returned.includes(id))o.returned.push(id);
    if(o.scanned)o.scanned=o.scanned.filter(s=>s!==id);
  });
  SFX.ok();closeModal('mReturn');toast('â†©ï¸ Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ Ğ¾Ñ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½');renderPage('eorders');
}
function completeOrder(oid){
  const o=empOrders.find(x=>x.id===oid);o.status='done';
  SFX.done();toast('ğŸ‰ Ğ—Ğ°ĞºĞ°Ğ· Ğ²Ñ‹Ğ´Ğ°Ğ½!');renderPage('eorders');
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   PROFILE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function profileHTML(){
  const p=profiles[ROLE];
  const myOrders=ROLE==='buyer'?orders:empOrders;
  const spent=ROLE==='buyer'?orders.reduce((s,o)=>s+o.total,0):0;
  const done=ROLE==='buyer'?orders.filter(o=>o.status==='ready').length:empOrders.filter(o=>o.status==='done').length;
  return`<div class="prof-hero glass-card">
    <div class="prof-av ${ROLE==='buyer'?'buyer':'emp'}">${p.av}</div>
    <div class="prof-name-display" id="profNameDisplay" onclick="editName()">${p.name} âœ</div>
    <div class="prof-name-hint">ĞĞ°Ğ¶Ğ¼Ğ¸Ñ‚Ğµ Ğ½Ğ° Ğ¸Ğ¼Ñ Ñ‡Ñ‚Ğ¾Ğ±Ñ‹ Ğ¸Ğ·Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ</div>
    <div class="prof-role">${p.role}</div>
    <div class="stats">
      <div class="stat-box"><div class="stat-n">${myOrders.length}</div><div class="stat-l">${ROLE==='buyer'?'Ğ—Ğ°ĞºĞ°Ğ·Ğ¾Ğ²':'ĞŸÑ€Ğ¸Ğ½ÑÑ‚Ğ¾'}</div></div>
      <div class="stat-box"><div class="stat-n">${done}</div><div class="stat-l">${ROLE==='buyer'?'ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¾':'Ğ’Ñ‹Ğ´Ğ°Ğ½Ğ¾'}</div></div>
      <div class="stat-box"><div class="stat-n">${ROLE==='buyer'?(spent>0?Math.round(spent/1000)+'Ğº':'0'):products.length}</div><div class="stat-l">${ROLE==='buyer'?'Ğ¢Ñ€Ğ°Ñ‚ â‚½':'Ğ¢Ğ¾Ğ²Ğ°Ñ€Ğ¾Ğ²'}</div></div>
    </div>
  </div>
  <div class="info-list glass-card">
    <div class="info-row"><span class="lbl">Ğ Ğ¾Ğ»ÑŒ</span><span class="val">${ROLE==='buyer'?'ğŸ›ï¸ ĞŸĞ¾ĞºÑƒĞ¿Ğ°Ñ‚ĞµĞ»ÑŒ':'ğŸ‘· Ğ¡Ğ¾Ñ‚Ñ€ÑƒĞ´Ğ½Ğ¸Ğº'}</span></div>
    ${ROLE==='buyer'?`
    <div class="info-row"><span class="lbl">Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ</span><span class="val" style="color:#34C759">VIP â­</span></div>
    <div class="info-row"><span class="lbl">ĞŸĞ¾Ñ‚Ñ€Ğ°Ñ‡ĞµĞ½Ğ¾</span><span class="val" style="color:#FF9500">${FMT(spent)}</span></div>
    `:`
    <div class="info-row"><span class="lbl">Ğ”Ğ¾Ğ»Ğ¶Ğ½Ğ¾ÑÑ‚ÑŒ</span><span class="val">Ğ¡Ñ‚Ğ°Ñ€ÑˆĞ¸Ğ¹ Ğ¾Ğ¿ĞµÑ€Ğ°Ñ‚Ğ¾Ñ€</span></div>
    <div class="info-row"><span class="lbl">Ğ¡Ñ‚Ğ°Ñ‚ÑƒÑ ÑĞ¼ĞµĞ½Ñ‹</span><span class="val" style="color:#34C759">â— ĞĞ½Ğ»Ğ°Ğ¹Ğ½</span></div>
    `}
  </div>
  <button class="fullbtn glass" onclick="exitRole()">â† Ğ¡Ğ¼ĞµĞ½Ğ¸Ñ‚ÑŒ Ñ€Ğ¾Ğ»ÑŒ</button>`;
}

function editName(){
  SFX.tap();
  const p=profiles[ROLE];
  const display=document.getElementById('profNameDisplay');
  if(!display)return;
  const input=document.createElement('input');
  input.className='prof-name-input';
  input.value=p.name;
  input.maxLength=30;
  display.replaceWith(input);
  input.focus();
  input.select();
  const save=()=>{
    const val=input.value.trim()||p.name;
    profiles[ROLE].name=val;
    SFX.ok();
    renderPage('profile');
    previewSwitch(ROLE);
    toast('âœ… Ğ˜Ğ¼Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¾');
  };
  input.addEventListener('blur',save);
  input.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();input.blur();}});
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPEECH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function speak(txt){
  if(!window.speechSynthesis)return;
  speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(txt);
  u.lang='ru-RU';u.rate=0.95;
  speechSynthesis.speak(u);
}
</script>

</body>
</html>